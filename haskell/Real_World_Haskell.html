<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Real World Haskell Walk</title>
<!-- 2017-03-12 dom 16:47 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Caio Rodrigues" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link href='/theme/style.css' rel='stylesheet'>
<link href="/Functional-Programming/theme/style.css" rel="stylesheet">

<script type="text/javascript" src="/theme/org-info.js">
/**
 *
 * @source: /theme/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in /theme/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in /theme/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "4");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Real World Haskell Walk</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Real World Haskell</a>
<ul>
<li><a href="#sec-1-1">1.1. Overview</a></li>
<li><a href="#sec-1-2">1.2. Chapter 3  - Defining Types, Streamlining Functions</a>
<ul>
<li><a href="#sec-1-2-1">1.2.1. Location</a></li>
<li><a href="#sec-1-2-2">1.2.2. BookStore.hs</a>
<ul>
<li><a href="#sec-1-2-2-1">1.2.2.1. Code</a></li>
<li><a href="#sec-1-2-2-2">1.2.2.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-2-3">1.2.3. BookStore2.hs</a>
<ul>
<li><a href="#sec-1-2-3-1">1.2.3.1. Code</a></li>
<li><a href="#sec-1-2-3-2">1.2.3.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-2-4">1.2.4. AlgebraicVector.hs</a>
<ul>
<li><a href="#sec-1-2-4-1">1.2.4.1. Code</a></li>
<li><a href="#sec-1-2-4-2">1.2.4.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-2-5">1.2.5. ShapeUnion.hs</a></li>
<li><a href="#sec-1-2-6">1.2.6. add.hs</a>
<ul>
<li><a href="#sec-1-2-6-1">1.2.6.1. Code</a></li>
<li><a href="#sec-1-2-6-2">1.2.6.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-2-7">1.2.7. BookStore3.hs</a>
<ul>
<li><a href="#sec-1-2-7-1">1.2.7.1. Code</a></li>
<li><a href="#sec-1-2-7-2">1.2.7.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-2-8">1.2.8. BookStore4.hs</a>
<ul>
<li><a href="#sec-1-2-8-1">1.2.8.1. Code</a></li>
<li><a href="#sec-1-2-8-2">1.2.8.2. Running</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-3">1.3. Chapter 4  - Functional Programming</a>
<ul>
<li><a href="#sec-1-3-1">1.3.1. Location</a></li>
<li><a href="#sec-1-3-2">1.3.2. InteractWith.hs</a>
<ul>
<li><a href="#sec-1-3-2-1">1.3.2.1. Code</a></li>
<li><a href="#sec-1-3-2-2">1.3.2.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-3-3">1.3.3. FixLines.hs</a>
<ul>
<li><a href="#sec-1-3-3-1">1.3.3.1. Code</a></li>
<li><a href="#sec-1-3-3-2">1.3.3.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-3-4">1.3.4. ch4.exercises.hs</a>
<ul>
<li><a href="#sec-1-3-4-1">1.3.4.1. Code</a></li>
<li><a href="#sec-1-3-4-2">1.3.4.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-3-5">1.3.5. IntParser.hs</a>
<ul>
<li><a href="#sec-1-3-5-1">1.3.5.1. Code</a></li>
<li><a href="#sec-1-3-5-2">1.3.5.2. Running</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-4">1.4. Chapter 5  - Writing a Library: Working with JSON Data</a>
<ul>
<li><a href="#sec-1-4-1">1.4.1. Location</a></li>
<li><a href="#sec-1-4-2">1.4.2. SimpleJson1.hs</a>
<ul>
<li><a href="#sec-1-4-2-1">1.4.2.1. Code</a></li>
<li><a href="#sec-1-4-2-2">1.4.2.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-4-3">1.4.3. SimpleJSon2.hs</a>
<ul>
<li><a href="#sec-1-4-3-1">1.4.3.1. Code</a></li>
<li><a href="#sec-1-4-3-2">1.4.3.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-4-4">1.4.4. PutJSON.hs</a>
<ul>
<li><a href="#sec-1-4-4-1">1.4.4.1. Code</a></li>
<li><a href="#sec-1-4-4-2">1.4.4.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-4-5">1.4.5. PrettyJSON.hs</a></li>
</ul>
</li>
<li><a href="#sec-1-5">1.5. Chapter 7  - Classic I/O in Haskell</a>
<ul>
<li><a href="#sec-1-5-1">1.5.1. Location</a></li>
<li><a href="#sec-1-5-2">1.5.2. basicio.hs</a>
<ul>
<li><a href="#sec-1-5-2-1">1.5.2.1. Code</a></li>
<li><a href="#sec-1-5-2-2">1.5.2.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-3">1.5.3. callingpure.hs</a>
<ul>
<li><a href="#sec-1-5-3-1">1.5.3.1. Code</a></li>
<li><a href="#sec-1-5-3-2">1.5.3.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-4">1.5.4. toupper-imp.hs</a>
<ul>
<li><a href="#sec-1-5-4-1">1.5.4.1. Code</a></li>
<li><a href="#sec-1-5-4-2">1.5.4.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-5">1.5.5. tempfile.hs</a>
<ul>
<li><a href="#sec-1-5-5-1">1.5.5.1. Code</a></li>
<li><a href="#sec-1-5-5-2">1.5.5.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-6">1.5.6. actions.hs</a>
<ul>
<li><a href="#sec-1-5-6-1">1.5.6.1. Code</a></li>
<li><a href="#sec-1-5-6-2">1.5.6.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-7">1.5.7. actions2.hs</a>
<ul>
<li><a href="#sec-1-5-7-1">1.5.7.1. Code</a></li>
<li><a href="#sec-1-5-7-2">1.5.7.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-8">1.5.8. basicio-nodo.hs</a>
<ul>
<li><a href="#sec-1-5-8-1">1.5.8.1. Code</a></li>
<li><a href="#sec-1-5-8-2">1.5.8.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-9">1.5.9. return1.hs</a>
<ul>
<li><a href="#sec-1-5-9-1">1.5.9.1. Code</a></li>
<li><a href="#sec-1-5-9-2">1.5.9.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-10">1.5.10. return2.hs</a>
<ul>
<li><a href="#sec-1-5-10-1">1.5.10.1. Code</a></li>
<li><a href="#sec-1-5-10-2">1.5.10.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-5-11">1.5.11. return3.hs</a>
<ul>
<li><a href="#sec-1-5-11-1">1.5.11.1. Code</a></li>
<li><a href="#sec-1-5-11-2">1.5.11.2. Running</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-6">1.6. Chapter 8  - Efficient File Processing, Regular Expressions, and Filename Matching</a>
<ul>
<li><a href="#sec-1-6-1">1.6.1. Location</a></li>
<li><a href="#sec-1-6-2">1.6.2. ElfMagic.hs</a>
<ul>
<li><a href="#sec-1-6-2-1">1.6.2.1. Code</a></li>
<li><a href="#sec-1-6-2-2">1.6.2.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-6-3">1.6.3. HighestClose.hs</a>
<ul>
<li><a href="#sec-1-6-3-1">1.6.3.1. Code</a></li>
<li><a href="#sec-1-6-3-2">1.6.3.2. Running</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-7">1.7. Chapter 10 - Code Case Study: Parsing a Binary Data Format</a>
<ul>
<li><a href="#sec-1-7-1">1.7.1. Location</a></li>
<li><a href="#sec-1-7-2">1.7.2. PNM.hs</a>
<ul>
<li><a href="#sec-1-7-2-1">1.7.2.1. Code</a></li>
<li><a href="#sec-1-7-2-2">1.7.2.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-7-3">1.7.3. Parse.hs</a>
<ul>
<li><a href="#sec-1-7-3-1">1.7.3.1. Code</a></li>
<li><a href="#sec-1-7-3-2">1.7.3.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-7-4">1.7.4. TreeMap.sh</a>
<ul>
<li><a href="#sec-1-7-4-1">1.7.4.1. Code</a></li>
<li><a href="#sec-1-7-4-2">1.7.4.2. Running</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-8">1.8. Chapter 13 - Data Structures</a></li>
<li><a href="#sec-1-9">1.9. Chapter 14 - Monads</a>
<ul>
<li><a href="#sec-1-9-1">1.9.1. Location</a></li>
<li><a href="#sec-1-9-2">1.9.2. Maybe.hs</a></li>
<li><a href="#sec-1-9-3">1.9.3. MultiplyTo.hs</a>
<ul>
<li><a href="#sec-1-9-3-1">1.9.3.1. Code</a></li>
<li><a href="#sec-1-9-3-2">1.9.3.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-9-4">1.9.4. SimpleState.hs</a>
<ul>
<li><a href="#sec-1-9-4-1">1.9.4.1. Code</a></li>
<li><a href="#sec-1-9-4-2">1.9.4.2. Running</a></li>
</ul>
</li>
<li><a href="#sec-1-9-5">1.9.5. State.hs</a>
<ul>
<li><a href="#sec-1-9-5-1">1.9.5.1. Code</a></li>
<li><a href="#sec-1-9-5-2">1.9.5.2. Running</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-10">1.10. <span class="done FAILED">FAILED</span> Chapter 27 - Sockets and Syslog</a>
<ul>
<li><a href="#sec-1-10-1">1.10.1. Location</a></li>
<li><a href="#sec-1-10-2">1.10.2. Requirements</a></li>
<li><a href="#sec-1-10-3">1.10.3. UDP Syslog Server and Client</a>
<ul>
<li><a href="#sec-1-10-3-1">1.10.3.1. Code</a></li>
<li><a href="#sec-1-10-3-2">1.10.3.2. Running:</a></li>
</ul>
</li>
<li><a href="#sec-1-10-4">1.10.4. TCP Syslog Server and Client</a>
<ul>
<li><a href="#sec-1-10-4-1">1.10.4.1. Code</a></li>
<li><a href="#sec-1-10-4-2">1.10.4.2. Running</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<lu> 
  <li><a href="/Functional-Programming/index.html">Index</a></li>
  <li><a href="https://github.com/caiorss/Functional-Programming">Repository</a></li>
</lu>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Real World Haskell</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><a id="ID-3d6223a7-bd77-48a5-a89a-3d211c5c84b3" name="ID-3d6223a7-bd77-48a5-a89a-3d211c5c84b3"></a><span class="section-number-3">1.1</span> Overview</h3>
<div class="outline-text-3" id="text-1-1">

<p>
At the time the book <b>Real World Haskell</b> was written (2008) the current
<span class="underline">Haskell version was 6.8</span> and many <code>libraries</code>, modules and
<i>implementations have changed</i> what makes some codes incompatible with
new Haskell versions. In order to solve this problem this section
provides modified codes from the book and the ghci repl sessions in
Haskell v7.10.2.
</p>


<p>
Reference: 
</p>

<ul class="org-ul">
<li>O'Sullivan, Bryan, John Goerzen, and Donald Bruce Stewart. <b>Real
world haskell: Code you can believe in.</b> " O'Reilly Media,
Inc.", 2008. Available at:
<a href="http://book.realworldhaskell.org/read/">http://book.realworldhaskell.org/read/</a>.
</li>
</ul>

<p>
<b>Install the necessary libraries with stack</b>
</p>

<p>
The necessary libraries to run the codes in this page can be installed
with the following command outside a project directory (Directory
without stack.yaml file):
</p>

<div class="org-src-container">

<pre class="src src-sh">$  stack install mtl turtle aeson regex-posix network random
</pre>
</div>

<p>
Once the package manager is installed you can run: 
</p>

<div class="org-src-container">

<pre class="src src-sh">$ cd rwh

$ ls
ch03/  ch05/  ch07/  ch10/  ch14/  ch16/  ch18/  shell.nix
ch04/  ch06/  ch08/  ch13/  ch15/  ch17/  ch27/

<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Where is ghci ??</span>
$ stack exec -- which ghci
/home/arch/.stack/programs/x86_64-linux/ghc-8.0.1/bin/ghci

<span class="org-comment-delimiter"># </span><span class="org-comment">Where is ghc ??</span>
$ stack exec -- which ghc
/home/arch/.stack/programs/x86_64-linux/ghc-8.0.1/bin/ghc

<span class="org-comment-delimiter"># </span><span class="org-comment">Run ghci </span>
$ stack ghci
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Chapter 3  - Defining Types, Streamlining Functions</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Location</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/defining-types-streamlining-functions.html">Chapter 3. Defining Types, Streamlining Functions</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><a id="ID-fede652f-105d-4313-9779-6b5cb083a8cf" name="ID-fede652f-105d-4313-9779-6b5cb083a8cf"></a><span class="section-number-4">1.2.2</span> BookStore.hs</h4>
<div class="outline-text-4" id="text-1-2-2">
</div>
<div id="outline-container-sec-1-2-2-1" class="outline-5">
<h5 id="sec-1-2-2-1"><a id="ID-25d6e8a5-ee6b-443b-a1b5-77913f931aaf" name="ID-25d6e8a5-ee6b-443b-a1b5-77913f931aaf"></a><span class="section-number-5">1.2.2.1</span> Code</h5>
<div class="outline-text-5" id="text-1-2-2-1">

<ul class="org-ul">
<li><a href="rwh/ch03/BookStore.hs">rwh/ch03/BookStore.hs</a>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BookInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Book</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">String</span> [<span class="org-haskell-constructor">String</span>]
                <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)



<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">MagazineInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Magazine</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">String</span> [<span class="org-haskell-constructor">String</span>]
                    <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)


<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">CustomerID</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">Int</span>        <span class="org-comment-delimiter">--</span><span class="org-comment">- Type synonym </span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">ReviewBody</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">String</span> 

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BookReview</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">BookReview</span> <span class="org-haskell-constructor">BookInfo</span> <span class="org-haskell-constructor">CustomerID</span> <span class="org-haskell-constructor">String</span> 

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BetterReviw</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">BetterReviw</span> <span class="org-haskell-constructor">BookInfo</span> <span class="org-haskell-constructor">CustomerID</span> <span class="org-haskell-constructor">ReviewBody</span> 

<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">BookRecord</span> <span class="org-haskell-operator">=</span> (<span class="org-haskell-type">BookInfo</span>, <span class="org-haskell-type">BookReview</span>) 

<span class="org-haskell-definition">myInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Book</span> 9780135072455 <span class="org-string">"Algebra of Programming"</span>
              [<span class="org-string">"Richard Bird"</span>, <span class="org-string">"Oege de Moor"</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-2-2" class="outline-5">
<h5 id="sec-1-2-2-2"><span class="section-number-5">1.2.2.2</span> Running</h5>
<div class="outline-text-5" id="text-1-2-2-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch03/BookStore.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch03<span class="org-haskell-operator">/</span>BookStore.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> myInfo
<span class="org-haskell-constructor">Book</span> 9780135072455 <span class="org-string">"Algebra of Programming"</span> [<span class="org-string">"Richard Bird"</span>,<span class="org-string">"Oege de Moor"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span><span class="org-haskell-keyword">type</span> myInfo
<span class="org-haskell-definition">myInfo</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">BookInfo</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">Book</span> 0 <span class="org-string">"The Book of Imaginary Beings"</span> [<span class="org-string">"Jorge Luis Borges"</span>]
<span class="org-haskell-constructor">Book</span> 0 <span class="org-string">"The Book of Imaginary Beings"</span> [<span class="org-string">"Jorge Luis Borges"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span><span class="org-haskell-keyword">type</span> <span class="org-haskell-type">Book</span> 1 <span class="org-string">"Cosmicomics"</span> [<span class="org-string">"Italo Calvino"</span>]
<span class="org-haskell-constructor">Book</span> 1 <span class="org-string">"Cosmicomics"</span> [<span class="org-string">"Italo Calvino"</span>] <span class="org-haskell-operator">::</span> <span class="org-haskell-type">BookInfo</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> cities <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Book</span> 173 <span class="org-string">"Use of Weapons"</span> [<span class="org-string">"Iain M. Banks"</span>]

<span class="org-haskell-operator">&gt;&gt;&gt;</span> cities
<span class="org-haskell-constructor">Book</span> 173 <span class="org-string">"Use of Weapons"</span> [<span class="org-string">"Iain M. Banks"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><a id="ID-8526ff6c-bd8a-4279-9827-c61fe5359787" name="ID-8526ff6c-bd8a-4279-9827-c61fe5359787"></a><span class="section-number-4">1.2.3</span> BookStore2.hs</h4>
<div class="outline-text-4" id="text-1-2-3">
</div>
<div id="outline-container-sec-1-2-3-1" class="outline-5">
<h5 id="sec-1-2-3-1"><a id="ID-455912c3-56e1-458c-a7ed-0d3bf02270b5" name="ID-455912c3-56e1-458c-a7ed-0d3bf02270b5"></a><span class="section-number-5">1.2.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-2-3-1">
<p>
<a href="rwh/ch03/BookStore2.hs">rwh/ch03/BookStore2.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">type</span> <span class="org-haskell-type">CardHolder</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">CardNumber</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">Address</span> <span class="org-haskell-operator">=</span> [<span class="org-haskell-type">String</span>]
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">CustomerID</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">Int</span>

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BillingInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">CreditCard</span> <span class="org-haskell-constructor">CardNumber</span> <span class="org-haskell-constructor">CardHolder</span> <span class="org-haskell-constructor">Address</span>
                 <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">CashOnDelivery</span>
                 <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Invoice</span> <span class="org-haskell-constructor">CustomerID</span>
                   <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-3-2" class="outline-5">
<h5 id="sec-1-2-3-2"><span class="section-number-5">1.2.3.2</span> Running</h5>
<div class="outline-text-5" id="text-1-2-3-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">CreditCard</span> <span class="org-string">"2901650221064486"</span> <span class="org-string">"Thomas Gradgrind"</span> [<span class="org-string">"Dickens"</span>, <span class="org-string">"England"</span>]
<span class="org-haskell-constructor">CreditCard</span> <span class="org-string">"2901650221064486"</span> <span class="org-string">"Thomas Gradgrind"</span> [<span class="org-string">"Dickens"</span>,<span class="org-string">"England"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> it
<span class="org-haskell-constructor">CreditCard</span> <span class="org-string">"2901650221064486"</span> <span class="org-string">"Thomas Gradgrind"</span> [<span class="org-string">"Dickens"</span>,<span class="org-string">"England"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span><span class="org-haskell-keyword">type</span> it
<span class="org-haskell-definition">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">BillingInfo</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-type">Invoice</span> 10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">CashOnDelivery</span>
<span class="org-haskell-constructor">CashOnDelivery</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4"><a id="ID-c6cc6bc3-09f6-46bd-89db-5010416c51aa" name="ID-c6cc6bc3-09f6-46bd-89db-5010416c51aa"></a><span class="section-number-4">1.2.4</span> AlgebraicVector.hs</h4>
<div class="outline-text-4" id="text-1-2-4">
</div>
<div id="outline-container-sec-1-2-4-1" class="outline-5">
<h5 id="sec-1-2-4-1"><a id="ID-34e3fe37-ae62-4833-88bc-2362a19600f2" name="ID-34e3fe37-ae62-4833-88bc-2362a19600f2"></a><span class="section-number-5">1.2.4.1</span> Code</h5>
<div class="outline-text-5" id="text-1-2-4-1">

<p>
<a href="rwh/ch03/AlgebraicVector.hs">rwh/ch03/AlgebraicVector.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">x and y coordinates or lengths.</span>
<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Cartesian2D</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Cartesian2D</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-constructor">Double</span> 
                   <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span>, <span class="org-haskell-constructor">Show</span>)

<span class="org-comment-delimiter">--</span><span class="org-comment">- Angle and distance (magnitude)</span>
<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Polar2D</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Polar2D</span> <span class="org-haskell-constructor">Double</span> <span class="org-haskell-constructor">Double</span>  
               <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span>, <span class="org-haskell-constructor">Show</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-4-2" class="outline-5">
<h5 id="sec-1-2-4-2"><span class="section-number-5">1.2.4.2</span> Running</h5>
<div class="outline-text-5" id="text-1-2-4-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">Cartesian2D</span> (sqrt 2) (sqrt 2)
<span class="org-haskell-constructor">Cartesian2D</span> 1.4142135623730951 1.4142135623730951
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">Polar2D</span> (pi <span class="org-haskell-operator">/</span> 4) 2
<span class="org-haskell-constructor">Polar2D</span> 0.7853981633974483 2.0
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">--</span><span class="org-comment">- The (==)  operator requires its arguments </span>
<span class="org-comment-delimiter">--</span><span class="org-comment">- to have the same type</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">Cartesian2D</span> (sqrt 2) (sqrt 2) <span class="org-haskell-operator">==</span> <span class="org-haskell-constructor">Polar2D</span> (pi <span class="org-haskell-operator">/</span> 4) 2

<span class="org-haskell-operator">&lt;</span>interactive<span class="org-haskell-operator">&gt;:</span>58<span class="org-haskell-constructor">:</span>34<span class="org-haskell-constructor">:</span>
    <span class="org-haskell-constructor">Couldn't</span> match expected <span class="org-haskell-keyword">type</span> &#8216;<span class="org-haskell-type">Cartesian2D</span>&#8217;
                with actual <span class="org-haskell-keyword">type</span> &#8216;<span class="org-haskell-type">Polar2D</span>&#8217;
    <span class="org-haskell-constructor">In</span> the second argument <span class="org-haskell-keyword">of</span> &#8216;(<span class="org-haskell-operator">==</span>)&#8217;, namely &#8216;<span class="org-haskell-constructor">Polar2D</span> (pi <span class="org-haskell-operator">/</span> 4) 2&#8217;
    <span class="org-haskell-constructor">In</span> the expression<span class="org-haskell-constructor">:</span>
      <span class="org-haskell-constructor">Cartesian2D</span> (sqrt 2) (sqrt 2) <span class="org-haskell-operator">==</span> <span class="org-haskell-constructor">Polar2D</span> (pi <span class="org-haskell-operator">/</span> 4) 2
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5"><span class="section-number-4">1.2.5</span> ShapeUnion.hs</h4>
<div class="outline-text-4" id="text-1-2-5">
<ul class="org-ul">
<li><a href="rwh/ShapeUnion.hs">rwh/ShapeUnion.hs</a> 
</li>
</ul>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">type</span> <span class="org-haskell-type">Vector</span> <span class="org-haskell-operator">=</span> (<span class="org-haskell-type">Double</span>, <span class="org-haskell-type">Double</span>)

<span class="org-haskell-keyword">data</span>  <span class="org-haskell-type">Shape</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Circle</span> <span class="org-haskell-constructor">Vector</span> <span class="org-haskell-constructor">Double</span> 
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Poly</span> [<span class="org-haskell-constructor">Vector</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-6" class="outline-4">
<h4 id="sec-1-2-6"><a id="ID-a55caa62-6954-40d8-9d85-b801aba8109d" name="ID-a55caa62-6954-40d8-9d85-b801aba8109d"></a><span class="section-number-4">1.2.6</span> add.hs</h4>
<div class="outline-text-4" id="text-1-2-6">
</div>
<div id="outline-container-sec-1-2-6-1" class="outline-5">
<h5 id="sec-1-2-6-1"><a id="ID-dc6ec096-d117-4a0e-8f61-58a94102386b" name="ID-dc6ec096-d117-4a0e-8f61-58a94102386b"></a><span class="section-number-5">1.2.6.1</span> Code</h5>
<div class="outline-text-5" id="text-1-2-6-1">

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-definition">sumList</span> (x<span class="org-haskell-constructor">:</span>xs) <span class="org-haskell-operator">=</span> x <span class="org-haskell-operator">+</span> sumList xs 
<span class="org-haskell-definition">sumList</span> <span class="org-haskell-constructor">[]</span>     <span class="org-haskell-operator">=</span> 0
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-6-2" class="outline-5">
<h5 id="sec-1-2-6-2"><span class="section-number-5">1.2.6.2</span> Running</h5>
<div class="outline-text-5" id="text-1-2-6-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch03/add.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch03<span class="org-haskell-operator">/</span>add<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> sumList <span class="org-haskell-constructor">[]</span>
0
<span class="org-haskell-operator">&gt;&gt;&gt;</span> sumList [1, 2, 3, 4, 5, 6]
21
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-7" class="outline-4">
<h4 id="sec-1-2-7"><a id="ID-fb640cfa-ca4c-457a-9253-25b41a31cc65" name="ID-fb640cfa-ca4c-457a-9253-25b41a31cc65"></a><span class="section-number-4">1.2.7</span> BookStore3.hs</h4>
<div class="outline-text-4" id="text-1-2-7">
</div>
<div id="outline-container-sec-1-2-7-1" class="outline-5">
<h5 id="sec-1-2-7-1"><a id="ID-d793907a-b4a4-451c-a4c9-1b4c43f14531" name="ID-d793907a-b4a4-451c-a4c9-1b4c43f14531"></a><span class="section-number-5">1.2.7.1</span> Code</h5>
<div class="outline-text-5" id="text-1-2-7-1">

<ul class="org-ul">
<li><a href="rwh/ch03/BookStore3.hs">rwh/ch03/BookStore3.hs</a>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BookInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Book</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">String</span> [<span class="org-haskell-constructor">String</span>]
                <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)



<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">MagazineInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Magazine</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">String</span> [<span class="org-haskell-constructor">String</span>]
                    <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)


<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">CustomerID</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">Int</span>        <span class="org-comment-delimiter">--</span><span class="org-comment">- Type synonym </span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">ReviewBody</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">String</span> 

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BookReview</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">BookReview</span> <span class="org-haskell-constructor">BookInfo</span> <span class="org-haskell-constructor">CustomerID</span> <span class="org-haskell-constructor">String</span> 

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BetterReviw</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">BetterReviw</span> <span class="org-haskell-constructor">BookInfo</span> <span class="org-haskell-constructor">CustomerID</span> <span class="org-haskell-constructor">ReviewBody</span> 

<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">BookRecord</span> <span class="org-haskell-operator">=</span> (<span class="org-haskell-type">BookInfo</span>, <span class="org-haskell-type">BookReview</span>) 

<span class="org-haskell-definition">bookID</span>      (<span class="org-haskell-constructor">Book</span> id title authors) <span class="org-haskell-operator">=</span> id
<span class="org-haskell-definition">bookTitle</span>   (<span class="org-haskell-constructor">Book</span> id title authors) <span class="org-haskell-operator">=</span> title
<span class="org-haskell-definition">bookAuthors</span> (<span class="org-haskell-constructor">Book</span> id title authors) <span class="org-haskell-operator">=</span> authors

<span class="org-haskell-definition">myInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Book</span> 9780135072455 <span class="org-string">"Algebra of Programming"</span>
              [<span class="org-string">"Richard Bird"</span>, <span class="org-string">"Oege de Moor"</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-7-2" class="outline-5">
<h5 id="sec-1-2-7-2"><span class="section-number-5">1.2.7.2</span> Running</h5>
<div class="outline-text-5" id="text-1-2-7-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch03/BookStore3.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch03<span class="org-haskell-operator">/</span>BookStore3.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> bookID (<span class="org-haskell-constructor">Book</span> 3 <span class="org-string">"Probability Theory"</span> [<span class="org-string">"E.T.H. Jaynes"</span>])
3
<span class="org-haskell-operator">&gt;&gt;&gt;</span> bookTitle (<span class="org-haskell-constructor">Book</span> 3 <span class="org-string">"Probability Theory"</span> [<span class="org-string">"E.T.H. Jaynes"</span>])
<span class="org-string">"Probability Theory"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> bookAuthors (<span class="org-haskell-constructor">Book</span> 3 <span class="org-string">"Probability Theory"</span> [<span class="org-string">"E.T.H. Jaynes"</span>])
[<span class="org-string">"E.T.H. Jaynes"</span>]

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span><span class="org-haskell-keyword">type</span> bookID
<span class="org-haskell-definition">bookID</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">BookInfo</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span><span class="org-haskell-keyword">type</span> bookTitle
<span class="org-haskell-definition">bookTitle</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">BookInfo</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span><span class="org-haskell-keyword">type</span> bookAuthors
<span class="org-haskell-definition">bookAuthors</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">BookInfo</span> <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-type">String</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-8" class="outline-4">
<h4 id="sec-1-2-8"><a id="ID-698235ad-1c82-4061-b689-e5b11f1adfc9" name="ID-698235ad-1c82-4061-b689-e5b11f1adfc9"></a><span class="section-number-4">1.2.8</span> BookStore4.hs</h4>
<div class="outline-text-4" id="text-1-2-8">
</div>
<div id="outline-container-sec-1-2-8-1" class="outline-5">
<h5 id="sec-1-2-8-1"><a id="ID-b3a8441b-98b1-4c7c-b742-e28e431f9ad3" name="ID-b3a8441b-98b1-4c7c-b742-e28e431f9ad3"></a><span class="section-number-5">1.2.8.1</span> Code</h5>
<div class="outline-text-5" id="text-1-2-8-1">

<ul class="org-ul">
<li><a href="rwh/ch03/BookStore4.hs">rwh/ch03/BookStore4.hs</a> 
</li>
</ul>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BookInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Book</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">String</span> [<span class="org-haskell-constructor">String</span>]
                <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)



<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">MagazineInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Magazine</span> <span class="org-haskell-constructor">Int</span> <span class="org-haskell-constructor">String</span> [<span class="org-haskell-constructor">String</span>]
                    <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)


<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">CustomerID</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">Int</span>        <span class="org-comment-delimiter">--</span><span class="org-comment">- Type synonym </span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">ReviewBody</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">String</span> 
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">Address</span> <span class="org-haskell-operator">=</span> [<span class="org-haskell-type">String</span>] 

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BookReview</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">BookReview</span> <span class="org-haskell-constructor">BookInfo</span> <span class="org-haskell-constructor">CustomerID</span> <span class="org-haskell-constructor">String</span> 

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">BetterReviw</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">BetterReviw</span> <span class="org-haskell-constructor">BookInfo</span> <span class="org-haskell-constructor">CustomerID</span> <span class="org-haskell-constructor">ReviewBody</span> 

<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">BookRecord</span> <span class="org-haskell-operator">=</span> (<span class="org-haskell-type">BookInfo</span>, <span class="org-haskell-type">BookReview</span>) 

<span class="org-haskell-definition">bookID</span>      (<span class="org-haskell-constructor">Book</span> id title authors) <span class="org-haskell-operator">=</span> id
<span class="org-haskell-definition">bookTitle</span>   (<span class="org-haskell-constructor">Book</span> id title authors) <span class="org-haskell-operator">=</span> title
<span class="org-haskell-definition">bookAuthors</span> (<span class="org-haskell-constructor">Book</span> id title authors) <span class="org-haskell-operator">=</span> authors


<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Customer</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Customer</span> {
      customerID      <span class="org-haskell-operator">::</span> <span class="org-haskell-type">CustomerID</span>
    , customerName    <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>
    , customerAddress <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Address</span>
    } <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-definition">myInfo</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Book</span> 9780135072455 <span class="org-string">"Algebra of Programming"</span>
              [<span class="org-string">"Richard Bird"</span>, <span class="org-string">"Oege de Moor"</span>]

<span class="org-haskell-definition">customer1</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Customer</span> 271828 <span class="org-string">"J.R. Hacker"</span>
            [<span class="org-string">"255 Syntax Ct"</span>,
             <span class="org-string">"Milpitas, CA 95134"</span>,
             <span class="org-string">"USA"</span>]

<span class="org-haskell-definition">customer2</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Customer</span> {
              customerID <span class="org-haskell-operator">=</span> 271828
            , customerAddress <span class="org-haskell-operator">=</span> [<span class="org-string">"1048576 Disk Drive"</span>,
                                 <span class="org-string">"Milpitas, CA 95134"</span>,
                                 <span class="org-string">"USA"</span>]
            , customerName <span class="org-haskell-operator">=</span> <span class="org-string">"Jane Q. Citizen"</span>
            }
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-8-2" class="outline-5">
<h5 id="sec-1-2-8-2"><span class="section-number-5">1.2.8.2</span> Running</h5>
<div class="outline-text-5" id="text-1-2-8-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch03/BookStore4.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch03<span class="org-haskell-operator">/</span>BookStore4.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> customer1
<span class="org-haskell-constructor">Customer</span> {customerID <span class="org-haskell-operator">=</span> 271828, customerName <span class="org-haskell-operator">=</span> <span class="org-string">"J.R. Hacker"</span>, customerAddress <span class="org-haskell-operator">=</span> [<span class="org-string">"255 Syntax Ct"</span>,<span class="org-string">"Milpitas, CA 95134"</span>,<span class="org-string">"USA"</span>]}
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> customer2
<span class="org-haskell-constructor">Customer</span> {customerID <span class="org-haskell-operator">=</span> 271828, customerName <span class="org-haskell-operator">=</span> <span class="org-string">"Jane Q. Citizen"</span>, customerAddress <span class="org-haskell-operator">=</span> [<span class="org-string">"1048576 Disk Drive"</span>,<span class="org-string">"Milpitas, CA 95134"</span>,<span class="org-string">"USA"</span>]}
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> customerID customer1
271828
<span class="org-haskell-operator">&gt;&gt;&gt;</span> customerID customer2
271828
<span class="org-haskell-operator">&gt;&gt;&gt;</span> customerName customer1
<span class="org-string">"J.R. Hacker"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> customerAddress customer1
[<span class="org-string">"255 Syntax Ct"</span>,<span class="org-string">"Milpitas, CA 95134"</span>,<span class="org-string">"USA"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t customerName
<span class="org-haskell-definition">customerName</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Customer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>  <span class="org-haskell-type">:</span>t customerAddress
<span class="org-haskell-definition">customerAddress</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Customer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Address</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span>t customerID
<span class="org-haskell-definition">customerID</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Customer</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">CustomerID</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Chapter 4  - Functional Programming</h3>
<div class="outline-text-3" id="text-1-3">
</div><div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> Location</h4>
<div class="outline-text-4" id="text-1-3-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/functional-programming.html">Chapter 4. Functional programming</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><a id="ID-2803ae95-b2dc-41bb-a649-cd4035196e37" name="ID-2803ae95-b2dc-41bb-a649-cd4035196e37"></a><span class="section-number-4">1.3.2</span> InteractWith.hs</h4>
<div class="outline-text-4" id="text-1-3-2">
</div>
<div id="outline-container-sec-1-3-2-1" class="outline-5">
<h5 id="sec-1-3-2-1"><a id="ID-ec5cabe1-5d75-480a-a5bb-8493042df332" name="ID-ec5cabe1-5d75-480a-a5bb-8493042df332"></a><span class="section-number-5">1.3.2.1</span> Code</h5>
<div class="outline-text-5" id="text-1-3-2-1">

<p>
Page 71: <a href="rwh/ch04/InteractWith.hs">rwh/ch04/InteractWith.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.Environment</span> (getArgs)

<span class="org-haskell-definition">interactWith</span> function inputFile outputFile <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  input <span class="org-haskell-operator">&lt;-</span> readFile inputFile
  writeFile outputFile (function input)

<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> mainWith myFunction
  <span class="org-haskell-keyword">where</span> mainWith function <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
          args <span class="org-haskell-operator">&lt;-</span> getArgs
          <span class="org-haskell-keyword">case</span> args <span class="org-haskell-keyword">of</span>
            [input,output] <span class="org-haskell-operator">-&gt;</span> interactWith function input output
            <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> putStrLn <span class="org-string">"error: exactly two arguments needed"</span>

        <span class="org-comment-delimiter">-- </span><span class="org-comment">replace "id" with the name of our function below</span>
        myFunction <span class="org-haskell-operator">=</span> id
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-2-2" class="outline-5">
<h5 id="sec-1-3-2-2"><span class="section-number-5">1.3.2.2</span> Running</h5>
<div class="outline-text-5" id="text-1-3-2-2">
<pre class="example">
$ ghc --make InteractWith 
[1 of 1] Compiling Main             ( InteractWith.hs, InteractWith.o )
Linking InteractWith ...

$ ./InteractWith /etc/issue 
error: exactly two arguments needed

$ ./InteractWith /etc/issue /tmp/issue.out

$ cat /tmp/issue.out 
Arch Linux \r (\l)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-3" class="outline-4">
<h4 id="sec-1-3-3"><a id="ID-03823902-66d2-4136-9793-c2b9946e1d2c" name="ID-03823902-66d2-4136-9793-c2b9946e1d2c"></a><span class="section-number-4">1.3.3</span> FixLines.hs</h4>
<div class="outline-text-4" id="text-1-3-3">
</div>
<div id="outline-container-sec-1-3-3-1" class="outline-5">
<h5 id="sec-1-3-3-1"><a id="ID-d9d2025e-d203-4424-8c69-2308dbe44679" name="ID-d9d2025e-d203-4424-8c69-2308dbe44679"></a><span class="section-number-5">1.3.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-3-3-1">
<p>
Page 73: <a href="rwh/ch04/FixLines.hs">rwh/ch04/FixLines.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.Environment</span> (getArgs)

<span class="org-haskell-definition">interactWith</span> function inputFile outputFile <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  input <span class="org-haskell-operator">&lt;-</span> readFile inputFile
  writeFile outputFile (function input)

<span class="org-haskell-definition">splitLines</span> <span class="org-haskell-constructor">[]</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">[]</span>
<span class="org-haskell-definition">splitLines</span> cs <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">let</span> (pre, suf) <span class="org-haskell-operator">=</span> break isLineTerminator cs
    <span class="org-haskell-keyword">in</span>  pre <span class="org-haskell-constructor">:</span> <span class="org-haskell-keyword">case</span> suf <span class="org-haskell-keyword">of</span> 
                (<span class="org-string">'\r'</span><span class="org-haskell-constructor">:</span><span class="org-string">'\n'</span><span class="org-haskell-constructor">:</span>rest) <span class="org-haskell-operator">-&gt;</span> splitLines rest
                (<span class="org-string">'\r'</span><span class="org-haskell-constructor">:</span>rest)      <span class="org-haskell-operator">-&gt;</span> splitLines rest
                (<span class="org-string">'\n'</span><span class="org-haskell-constructor">:</span>rest)      <span class="org-haskell-operator">-&gt;</span> splitLines rest
                <span class="org-haskell-keyword">_</span>                <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">[]</span>

<span class="org-haskell-definition">isLineTerminator</span> c <span class="org-haskell-operator">=</span> c <span class="org-haskell-operator">==</span> <span class="org-string">'\r'</span> <span class="org-haskell-operator">||</span> c <span class="org-haskell-operator">==</span> <span class="org-string">'\n'</span>

<span class="org-haskell-definition">fixLines</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-definition">fixLines</span> input <span class="org-haskell-operator">=</span> unlines (splitLines input)


<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> mainWith myFunction
  <span class="org-haskell-keyword">where</span> mainWith function <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
          args <span class="org-haskell-operator">&lt;-</span> getArgs
          <span class="org-haskell-keyword">case</span> args <span class="org-haskell-keyword">of</span>
            [input,output] <span class="org-haskell-operator">-&gt;</span> interactWith function input output
            <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> putStrLn <span class="org-string">"error: exactly two arguments needed"</span>

        <span class="org-comment-delimiter">-- </span><span class="org-comment">replace "id" with the name of our function below</span>
        myFunction <span class="org-haskell-operator">=</span> fixLines
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-3-2" class="outline-5">
<h5 id="sec-1-3-3-2"><span class="section-number-5">1.3.3.2</span> Running</h5>
<div class="outline-text-5" id="text-1-3-3-2">
<p>
Running Interactive:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch04/FixLines.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch04<span class="org-haskell-operator">/</span>FixLines.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> break odd [2, 4, 5, 6, 8]
([2,4],[5,6,8])

<span class="org-haskell-operator">&gt;&gt;&gt;</span> splitLines <span class="org-string">"line1\nline2\r\nline3\r\n"</span>
[<span class="org-string">"line1"</span>,<span class="org-string">"line2"</span>,<span class="org-string">"line3"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>


<p>
Running in batch mode:
</p>

<div class="org-src-container">

<pre class="src src-sh">$ curl -O http://www.gnu.org/licenses/gpl-3.0.txt

$ file gpl-3.0.txt 
gpl-3.0.txt: ASCII text

<span class="org-comment-delimiter">#  </span><span class="org-comment">dos2unix replacement </span>
<span class="org-comment-delimiter">#</span>
$ awk <span class="org-string">'sub("$", "\r")'</span> gpl-3.0.txt  &gt;  gpl-3.0.dos.txt

$ file gpl-3.0.dos.txt 
gpl-3.0.dos.txt: ASCII text, with CRLF line terminators

$ ghc --make FixLines
[1 of 1] Compiling Main             ( FixLines.hs, FixLines.o )
Linking FixLines ...

$ file FixLines
FixLines: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically 
linked, interpreter 
/nix/store/n2wxp513rr00f6hr2dy0waqahns49dch-glibc-2.21/lib/ld-linux-x86-64.so.2, 
<span class="org-keyword">for</span> GNU/Linux 2.6.32, not stripped


$ ./FixLines 
error: exactly two arguments needed

$ ./FixLines gpl-3.0.dos.txt gpl-3.0.unix.txt

$ file gpl-3.0.unix.txt 
gpl-3.0.unix.txt: ASCII text
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-4" class="outline-4">
<h4 id="sec-1-3-4"><a id="ID-a618ec21-39db-4d03-8320-039ec50221c7" name="ID-a618ec21-39db-4d03-8320-039ec50221c7"></a><span class="section-number-4">1.3.4</span> ch4.exercises.hs</h4>
<div class="outline-text-4" id="text-1-3-4">
</div>
<div id="outline-container-sec-1-3-4-1" class="outline-5">
<h5 id="sec-1-3-4-1"><a id="ID-b85730e5-1c51-4242-9124-b4393283d54d" name="ID-b85730e5-1c51-4242-9124-b4393283d54d"></a><span class="section-number-5">1.3.4.1</span> Code</h5>
<div class="outline-text-5" id="text-1-3-4-1">

<ol class="org-ol">
<li>Write your own “safe” definitions of the standard partial list
</li>
</ol>
<p>
functions, but make sure they never fail. As a hint, you might want to
consider using the following types:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-definition">safeHead</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> a
<span class="org-haskell-definition">safeTail</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [a]
<span class="org-haskell-definition">safeLast</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> a
<span class="org-haskell-definition">safeInit</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [a]
</pre>
</div>


<ol class="org-ol">
<li>Write a function splitWith  that acts similarly to words  but takes a predicate and a
</li>
</ol>
<p>
list of any type, and then splits its input list on every element for which the predicate
returns False:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch04/ch04.exercises.hs</span>
<span class="org-haskell-definition">splitWith</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>) <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> [[a]]
</pre>
</div>


<p>
Page 84: <a href="rwh/ch04/ch04.exercises.hs">rwh/ch04/ch04.exercises.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-definition">safeHead</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> a
<span class="org-haskell-definition">safeHead</span> (head<span class="org-haskell-constructor">:</span>rest) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> head
<span class="org-haskell-definition">safeHead</span> <span class="org-haskell-constructor">[]</span>   <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-haskell-definition">safeTail</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [a]
<span class="org-haskell-definition">safeTail</span> (head<span class="org-haskell-constructor">:</span>rest) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> rest 
<span class="org-haskell-definition">safeTail</span> <span class="org-haskell-constructor">[]</span>          <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> 


<span class="org-haskell-definition">safeLast</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> a
<span class="org-haskell-definition">safeLast</span> [x] <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> x
<span class="org-haskell-definition">safeLast</span> (hd<span class="org-haskell-constructor">:</span>tl) <span class="org-haskell-operator">=</span> safeLast tl 
<span class="org-haskell-definition">safeLast</span> <span class="org-haskell-constructor">[]</span>  <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-haskell-definition">safeInit</span> <span class="org-haskell-operator">::</span> [a] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [a]
<span class="org-haskell-definition">safeInit</span> (x<span class="org-haskell-constructor">:</span>xs)      <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> <span class="org-haskell-operator">$</span> init (x<span class="org-haskell-constructor">:</span>xs)
<span class="org-haskell-definition">safeInit</span> <span class="org-haskell-constructor">[]</span>          <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> 

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">splitWith_aux :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]] -&gt; [[a]]</span>
<span class="org-comment">splitWith_aux fnp []     acc  = [] </span>
<span class="org-comment">splitWith_aux fnp (x:xs) acc  = if fnp x</span>
<span class="org-comment">                                then  splitWith_aux fnp xs  </span>

<span class="org-comment">-}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-4-2" class="outline-5">
<h5 id="sec-1-3-4-2"><span class="section-number-5">1.3.4.2</span> Running</h5>
<div class="outline-text-5" id="text-1-3-4-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch04/ch04.exercises.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch04<span class="org-haskell-operator">/</span>ch04<span class="org-haskell-operator">.</span>exercises<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeHead [1, 2, 3, 4]
<span class="org-haskell-constructor">Just</span> 1
<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeHead [1 <span class="org-haskell-operator">..</span>]
<span class="org-haskell-constructor">Just</span> 1
<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeHead <span class="org-haskell-constructor">[]</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeTail [1, 2, 3, 4]
<span class="org-haskell-constructor">Just</span> [2,3,4]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeTail <span class="org-haskell-constructor">[]</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeLast [1, 2, 3, 4]
<span class="org-haskell-constructor">Just</span> 4
<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeLast [4]
<span class="org-haskell-constructor">Just</span> 4
<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeLast <span class="org-haskell-constructor">[]</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeInit <span class="org-haskell-constructor">[]</span>
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeInit [1, 2, 3, 4, 5]
<span class="org-haskell-constructor">Just</span> [1,2,3,4]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> safeInit [1]
<span class="org-haskell-constructor">Just</span> <span class="org-haskell-constructor">[]</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-5" class="outline-4">
<h4 id="sec-1-3-5"><a id="ID-4654f267-034e-42b7-94bc-542e6dc38798" name="ID-4654f267-034e-42b7-94bc-542e6dc38798"></a><span class="section-number-4">1.3.5</span> IntParser.hs</h4>
<div class="outline-text-4" id="text-1-3-5">
</div>
<div id="outline-container-sec-1-3-5-1" class="outline-5">
<h5 id="sec-1-3-5-1"><a id="ID-b2ca74d6-83e1-4f2f-8945-454cb90d82c0" name="ID-b2ca74d6-83e1-4f2f-8945-454cb90d82c0"></a><span class="section-number-5">1.3.5.1</span> Code</h5>
<div class="outline-text-5" id="text-1-3-5-1">

<p>
Page 86: <a href="rwh/ch04/IntParse.hs">rwh/ch04/IntParse.hs</a> 
</p>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Char</span> (digitToInt)

<span class="org-haskell-definition">asInt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span> 
<span class="org-haskell-definition">asInt</span> xs <span class="org-haskell-operator">=</span> loop 0 xs

<span class="org-haskell-definition">loop</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span> 
<span class="org-haskell-definition">loop</span> acc <span class="org-haskell-constructor">[]</span> <span class="org-haskell-operator">=</span> acc
<span class="org-haskell-definition">loop</span> acc (x<span class="org-haskell-constructor">:</span>xs) <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">let</span> acc' <span class="org-haskell-operator">=</span> acc <span class="org-haskell-operator">*</span> 10 <span class="org-haskell-operator">+</span> digitToInt x
                  <span class="org-haskell-keyword">in</span> loop acc' xs
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-5-2" class="outline-5">
<h5 id="sec-1-3-5-2"><span class="section-number-5">1.3.5.2</span> Running</h5>
<div class="outline-text-5" id="text-1-3-5-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;:</span>load rwh<span class="org-haskell-operator">/</span>ch04<span class="org-haskell-operator">/</span>IntParse.hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch04<span class="org-haskell-operator">/</span>IntParse.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> digitToInt <span class="org-string">'9'</span>
9
<span class="org-haskell-operator">&gt;&gt;&gt;</span> digitToInt <span class="org-string">'a'</span>
10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> digitToInt <span class="org-string">'x'</span>
 <span class="org-haskell-operator">***</span> <span class="org-haskell-constructor">Exception:</span> Char.digitToInt<span class="org-haskell-constructor">:</span> not a digit <span class="org-string">'x'</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> asInt <span class="org-string">"33"</span>
33
<span class="org-haskell-operator">&gt;&gt;&gt;</span> asInt <span class="org-string">"100"</span>
100
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t asInt
<span class="org-haskell-definition">asInt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> asInt <span class="org-string">"not a number"</span>
 <span class="org-haskell-operator">***</span> <span class="org-haskell-type">Exception:</span> Char.digitToInt<span class="org-haskell-type">:</span> not a digit <span class="org-string">'n'</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Chapter 5  - Writing a Library: Working with JSON Data</h3>
<div class="outline-text-3" id="text-1-4">
</div><div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> Location</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/writing-a-library-working-with-json-data.html">Chapter 5. Writing a library: working with JSON data</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-4-2" class="outline-4">
<h4 id="sec-1-4-2"><a id="ID-0b1fe766-54e3-40d6-b078-18c6762b3eea" name="ID-0b1fe766-54e3-40d6-b078-18c6762b3eea"></a><span class="section-number-4">1.4.2</span> SimpleJson1.hs</h4>
<div class="outline-text-4" id="text-1-4-2">
</div>
<div id="outline-container-sec-1-4-2-1" class="outline-5">
<h5 id="sec-1-4-2-1"><a id="ID-6bb61c3b-15b8-4a61-a744-c8af5dd948b7" name="ID-6bb61c3b-15b8-4a61-a744-c8af5dd948b7"></a><span class="section-number-5">1.4.2.1</span> Code</h5>
<div class="outline-text-5" id="text-1-4-2-1">
<p>
Page: 112 <a href="rwh/ch05/SimpleJSON1.hs">rwh/ch05/SimpleJSON1.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">JString</span> <span class="org-haskell-constructor">String</span>
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JNumber</span> <span class="org-haskell-constructor">Double</span> 
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">Bool</span>
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JNull</span> 
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JObject</span> [(<span class="org-haskell-constructor">String</span>, <span class="org-haskell-constructor">JValue</span>)]
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JArray</span>  [<span class="org-haskell-constructor">JValue</span>]
            <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span>, <span class="org-haskell-constructor">Ord</span>, <span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-definition">getString</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">String</span> 
<span class="org-haskell-definition">getString</span> (<span class="org-haskell-constructor">JString</span> s) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> s
<span class="org-haskell-definition">getString</span> <span class="org-haskell-keyword">_</span>           <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-haskell-definition">getBool</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Bool</span> 
<span class="org-haskell-definition">getBool</span> (<span class="org-haskell-constructor">JBool</span> b) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> b 
<span class="org-haskell-definition">getBool</span> <span class="org-haskell-keyword">_</span>         <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> 

<span class="org-haskell-definition">getNumber</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>
<span class="org-haskell-definition">getNumber</span> (<span class="org-haskell-constructor">JNumber</span> n) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> n
<span class="org-haskell-definition">getNumber</span> <span class="org-haskell-keyword">_</span>           <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-haskell-definition">getObject</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">JValue</span>)]
<span class="org-haskell-definition">getObject</span> js <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> js <span class="org-haskell-keyword">of</span>
               <span class="org-haskell-constructor">JObject</span> xs <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Just</span> xs
               <span class="org-haskell-keyword">_</span>          <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span> 


<span class="org-haskell-definition">getArray</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [<span class="org-haskell-type">JValue</span>]
<span class="org-haskell-definition">getArray</span> js <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> js <span class="org-haskell-keyword">of</span>
              <span class="org-haskell-constructor">JArray</span> xs <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Just</span> xs
              <span class="org-haskell-keyword">_</span>         <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span> 

<span class="org-haskell-definition">isNull</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span> 
<span class="org-haskell-definition">isNull</span> <span class="org-haskell-constructor">JNull</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">True</span>
<span class="org-haskell-definition">isNull</span> <span class="org-haskell-keyword">_</span>     <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-2-2" class="outline-5">
<h5 id="sec-1-4-2-2"><span class="section-number-5">1.4.2.2</span> Running</h5>
<div class="outline-text-5" id="text-1-4-2-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch05/SimpleJSON1.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch05<span class="org-haskell-operator">/</span>SimpleJSON1.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">JString</span> <span class="org-string">"New Jersey"</span>
<span class="org-haskell-constructor">JString</span> <span class="org-string">"New Jersey"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">JNumber</span> 3.1415
<span class="org-haskell-constructor">JNumber</span> 3.1415
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">False</span>
<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">True</span>
<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> getString (<span class="org-haskell-constructor">JNumber</span> 3)
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> getString (<span class="org-haskell-constructor">JString</span> <span class="org-string">"Utah"</span> )
<span class="org-haskell-constructor">Just</span> <span class="org-string">"Utah"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> getNumber (<span class="org-haskell-constructor">JNumber</span> 10.2323)
<span class="org-haskell-constructor">Just</span> 10.2323
<span class="org-haskell-operator">&gt;&gt;&gt;</span> getNumber (<span class="org-haskell-constructor">JString</span> <span class="org-string">"Texas"</span>)
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> getBool (<span class="org-haskell-constructor">JString</span> <span class="org-string">"Alabama"</span>)
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> getBool (<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">False</span>)
<span class="org-haskell-constructor">Just</span> <span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> getArray (<span class="org-haskell-constructor">JArray</span> [<span class="org-haskell-constructor">JString</span> <span class="org-string">"Alabama"</span>, <span class="org-haskell-constructor">JNumber</span> 102.23, <span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">True</span>])
<span class="org-haskell-constructor">Just</span> [<span class="org-haskell-constructor">JString</span> <span class="org-string">"Alabama"</span>,<span class="org-haskell-constructor">JNumber</span> 102.23,<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">True</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> getObject (<span class="org-haskell-constructor">JObject</span> [(<span class="org-string">"Alabama"</span>, <span class="org-haskell-constructor">JNumber</span> 0), (<span class="org-string">"Texas"</span>, <span class="org-haskell-constructor">JNumber</span> 2), (<span class="org-string">"Nevada"</span>, <span class="org-haskell-constructor">JNumber</span> 20), (<span class="org-string">"New York"</span>, <span class="org-haskell-constructor">JNumber</span> 40)])
<span class="org-haskell-constructor">Just</span> [(<span class="org-string">"Alabama"</span>,<span class="org-haskell-constructor">JNumber</span> 0.0),(<span class="org-string">"Texas"</span>,<span class="org-haskell-constructor">JNumber</span> 2.0),(<span class="org-string">"Nevada"</span>,<span class="org-haskell-constructor">JNumber</span> 20.0),(<span class="org-string">"New York"</span>,<span class="org-haskell-constructor">JNumber</span> 40.0)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> isNull <span class="org-haskell-constructor">JNull</span>
<span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> isNull (<span class="org-haskell-constructor">JString</span> <span class="org-string">"California"</span>)
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-3" class="outline-4">
<h4 id="sec-1-4-3"><a id="ID-855fd9fb-3e76-4777-a89a-e9e9c78c02ba" name="ID-855fd9fb-3e76-4777-a89a-e9e9c78c02ba"></a><span class="section-number-4">1.4.3</span> SimpleJSon2.hs</h4>
<div class="outline-text-4" id="text-1-4-3">
</div>
<div id="outline-container-sec-1-4-3-1" class="outline-5">
<h5 id="sec-1-4-3-1"><a id="ID-2bb053fe-7cd6-42de-be5b-1e325f81efdb" name="ID-2bb053fe-7cd6-42de-be5b-1e325f81efdb"></a><span class="section-number-5">1.4.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-4-3-1">

<p>
Page: 112 - File: <a href="rwh/ch05/SimpleJSON2.hs">rwh/ch05/SimpleJSON2.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">module</span> <span class="org-haskell-constructor">SimpleJSON2</span>
       (
         <span class="org-haskell-constructor">JValue</span> (<span class="org-haskell-operator">..</span>)
         , getString
         , getInt
         , getDouble
         , getObject
         , getArray
         , isNull
       ) <span class="org-haskell-keyword">where</span> 

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">JString</span> <span class="org-haskell-constructor">String</span>
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JNumber</span> <span class="org-haskell-constructor">Double</span> 
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">Bool</span>
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JNull</span> 
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JObject</span> [(<span class="org-haskell-constructor">String</span>, <span class="org-haskell-constructor">JValue</span>)]
            <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">JArray</span>  [<span class="org-haskell-constructor">JValue</span>]
            <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span>, <span class="org-haskell-constructor">Ord</span>, <span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-definition">getString</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">String</span> 
<span class="org-haskell-definition">getString</span> (<span class="org-haskell-constructor">JString</span> s) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> s
<span class="org-haskell-definition">getString</span> <span class="org-haskell-keyword">_</span>           <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-haskell-definition">getBool</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Bool</span> 
<span class="org-haskell-definition">getBool</span> (<span class="org-haskell-constructor">JBool</span> b) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> b 
<span class="org-haskell-definition">getBool</span> <span class="org-haskell-keyword">_</span>         <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> 

<span class="org-haskell-definition">getNumber</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>
<span class="org-haskell-definition">getNumber</span> (<span class="org-haskell-constructor">JNumber</span> n) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> n
<span class="org-haskell-definition">getNumber</span> <span class="org-haskell-keyword">_</span>           <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

<span class="org-haskell-definition">getDouble</span> <span class="org-haskell-operator">=</span> getNumber 

<span class="org-haskell-definition">getObject</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">JValue</span>)]
<span class="org-haskell-definition">getObject</span> js <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> js <span class="org-haskell-keyword">of</span>
               <span class="org-haskell-constructor">JObject</span> xs <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Just</span> xs
               <span class="org-haskell-keyword">_</span>          <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span> 


<span class="org-haskell-definition">getArray</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [<span class="org-haskell-type">JValue</span>]
<span class="org-haskell-definition">getArray</span> js <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> js <span class="org-haskell-keyword">of</span>
              <span class="org-haskell-constructor">JArray</span> xs <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Just</span> xs
              <span class="org-haskell-keyword">_</span>         <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span> 

<span class="org-haskell-definition">getInt</span> (<span class="org-haskell-constructor">JNumber</span> n) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> (truncate n)
<span class="org-haskell-definition">getInt</span> <span class="org-haskell-keyword">_</span>           <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> 

<span class="org-haskell-definition">isNull</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span> 
<span class="org-haskell-definition">isNull</span> <span class="org-haskell-constructor">JNull</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">True</span>
</pre>
</div>


<p>
File: <a href="rwh/ch05/Main.hs">rwh/ch05/Main.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">module</span> <span class="org-haskell-constructor">Main</span> (main) <span class="org-haskell-keyword">where</span>

<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">SimpleJSON2</span>

<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> print (<span class="org-haskell-constructor">JObject</span> [(<span class="org-string">"foo"</span>, <span class="org-haskell-constructor">JNumber</span> 1), (<span class="org-string">"bar"</span>, <span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">False</span>)])
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-3-2" class="outline-5">
<h5 id="sec-1-4-3-2"><span class="section-number-5">1.4.3.2</span> Running</h5>
<div class="outline-text-5" id="text-1-4-3-2">
<p>
Compile the module:
</p>

<div class="org-src-container">

<pre class="src src-sh">$ alias <span class="org-variable-name">ghc</span>=/nix/store/fcwp5nswfq4wm4hc3c9ij8rap9dr9p3q-ghc-7.10.2/bin/ghc

<span class="org-comment-delimiter"># </span><span class="org-comment">Generate only object code</span>
<span class="org-comment-delimiter">#</span>
$ ghc -c SimpleJSON2.hs


$ file SimpleJSON2.o 
SimpleJSON2.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped

$ file SimpleJSON2.hi
SimpleJSON2.hi: data


<span class="org-comment-delimiter"># </span><span class="org-comment">Error:</span>
<span class="org-comment-delimiter">#</span>
$ ghc -o simple Main.hs SimpleJSON2.o
Linking simple ...
SimpleJSON2.o:(.data+0x0): multiple definition of <span class="org-sh-quoted-exec">`__stginit_SimpleJSON2'</span>
<span class="org-sh-quoted-exec">./SimpleJSON2.o:(.data+0x0): first defined here</span>
<span class="org-sh-quoted-exec">SimpleJSON2.o:(.data+0x0): multiple definition of `</span>SimpleJSON2_isNull_closure<span class="org-string">'</span>
<span class="org-string">./SimpleJSON2.o:(.data+0x0): first defined here</span>
<span class="org-string">...</span>
<span class="org-string">SimpleJSON2.o: In function `SimpleJSON2_JArray_info'</span>:
(.text+0x24f0): multiple definition of <span class="org-sh-quoted-exec">`SimpleJSON2_JArray_static_info'</span>
<span class="org-sh-quoted-exec">./SimpleJSON2.o:(.text+0x24f0): first defined here</span>
<span class="org-sh-quoted-exec">collect2: error: ld returned 1 exit status</span>


<span class="org-sh-quoted-exec"># Now it works </span>
<span class="org-sh-quoted-exec">#</span>
<span class="org-sh-quoted-exec">$ ghc --make -o simple Main.hs</span>
<span class="org-sh-quoted-exec">Linking simple ...</span>

<span class="org-sh-quoted-exec">$ file simple </span>
<span class="org-sh-quoted-exec">simple: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, </span>
<span class="org-sh-quoted-exec">interpreter /nix/store/n2wxp513rr00f6hr2dy0waqahns49dch-glibc-2.21/lib/ld-linux-x86-64.so.2, </span>
<span class="org-sh-quoted-exec">for GNU/Linux 2.6.32, not stripped</span>

<span class="org-sh-quoted-exec">$ ./simple </span>
<span class="org-sh-quoted-exec">JObject [("foo",JNumber 1.0),("bar",JBool False)]</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-4" class="outline-4">
<h4 id="sec-1-4-4"><a id="ID-95abb342-c395-40b3-a061-92b6dde2f783" name="ID-95abb342-c395-40b3-a061-92b6dde2f783"></a><span class="section-number-4">1.4.4</span> PutJSON.hs</h4>
<div class="outline-text-4" id="text-1-4-4">
</div>
<div id="outline-container-sec-1-4-4-1" class="outline-5">
<h5 id="sec-1-4-4-1"><a id="ID-e32b6296-e10f-4c35-9961-3aba317e4e41" name="ID-e32b6296-e10f-4c35-9961-3aba317e4e41"></a><span class="section-number-5">1.4.4.1</span> Code</h5>
<div class="outline-text-5" id="text-1-4-4-1">

<p>
Page: 116 <a href="rwh/ch05/PutJson.hs">rwh/ch05/PutJson.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">module</span> <span class="org-haskell-constructor">PutJSON</span> <span class="org-haskell-keyword">where</span>

<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span> (intercalate)
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">SimpleJSON2</span>

<span class="org-haskell-definition">renderJValue</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JString</span> s)   <span class="org-haskell-operator">=</span> show s
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JNumber</span> n)   <span class="org-haskell-operator">=</span> show n
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">True</span>)  <span class="org-haskell-operator">=</span> <span class="org-string">"true"</span>
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">False</span>) <span class="org-haskell-operator">=</span> <span class="org-string">"false"</span>
<span class="org-haskell-definition">renderJValue</span> <span class="org-haskell-constructor">JNull</span>         <span class="org-haskell-operator">=</span> <span class="org-string">"null"</span>

<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JObject</span> o) <span class="org-haskell-operator">=</span> <span class="org-string">"{"</span> <span class="org-haskell-operator">++</span> pairs o <span class="org-haskell-operator">++</span> <span class="org-string">"}"</span>
  <span class="org-haskell-keyword">where</span> pairs <span class="org-haskell-constructor">[]</span> <span class="org-haskell-operator">=</span> <span class="org-string">""</span>
        pairs ps <span class="org-haskell-operator">=</span> intercalate <span class="org-string">", "</span> (map renderPair ps)
        renderPair (k,v)   <span class="org-haskell-operator">=</span> show k <span class="org-haskell-operator">++</span> <span class="org-string">": "</span> <span class="org-haskell-operator">++</span> renderJValue v

<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JArray</span> a) <span class="org-haskell-operator">=</span> <span class="org-string">"["</span> <span class="org-haskell-operator">++</span> values a <span class="org-haskell-operator">++</span> <span class="org-string">"]"</span>
  <span class="org-haskell-keyword">where</span> values <span class="org-haskell-constructor">[]</span> <span class="org-haskell-operator">=</span> <span class="org-string">""</span>
        values vs <span class="org-haskell-operator">=</span> intercalate <span class="org-string">", "</span> (map renderJValue vs)

<span class="org-comment-delimiter">-- </span><span class="org-comment">Good Haskell style involves separating pure code from code that</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">performs I/O. (Real World Haskell) </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-definition">putJValue</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">putJValue</span> v <span class="org-haskell-operator">=</span> putStrLn (renderJValue v)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-4-2" class="outline-5">
<h5 id="sec-1-4-4-2"><span class="section-number-5">1.4.4.2</span> Running</h5>
<div class="outline-text-5" id="text-1-4-4-2">
<div class="org-src-container">

<pre class="src src-haskell"></pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-5" class="outline-4">
<h4 id="sec-1-4-5"><a id="ID-ebf5a7e1-6f1c-4961-b13c-b8972c6ef08f" name="ID-ebf5a7e1-6f1c-4961-b13c-b8972c6ef08f"></a><span class="section-number-4">1.4.5</span> PrettyJSON.hs</h4>
<div class="outline-text-4" id="text-1-4-5">

<p>
Page: 119 <a href="rwh/ch05/PrettyJSON.hs">rwh/ch05/PrettyJSON.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-definition">renderJValue</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">JValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Doc</span>
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">True</span>)  <span class="org-haskell-operator">=</span> text <span class="org-string">"true"</span>
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JBool</span> <span class="org-haskell-constructor">False</span>) <span class="org-haskell-operator">=</span> text <span class="org-string">"false"</span>
<span class="org-haskell-definition">renderJValue</span> <span class="org-haskell-constructor">JNull</span>         <span class="org-haskell-operator">=</span> text <span class="org-string">"null"</span>
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JNumber</span> num) <span class="org-haskell-operator">=</span> double num
<span class="org-haskell-definition">renderJValue</span> (<span class="org-haskell-constructor">JString</span> str) <span class="org-haskell-operator">=</span> string str
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><a id="ID-e95f98c1-fc9d-42aa-8e72-b816e998aadd" name="ID-e95f98c1-fc9d-42aa-8e72-b816e998aadd"></a><span class="section-number-3">1.5</span> Chapter 7  - Classic I/O in Haskell</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-sec-1-5-1" class="outline-4">
<h4 id="sec-1-5-1"><span class="section-number-4">1.5.1</span> Location</h4>
<div class="outline-text-4" id="text-1-5-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/io.html">Chapter 7. I/O</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-5-2" class="outline-4">
<h4 id="sec-1-5-2"><a id="ID-e295abfd-86e6-43a7-8389-cdae891857ef" name="ID-e295abfd-86e6-43a7-8389-cdae891857ef"></a><span class="section-number-4">1.5.2</span> basicio.hs</h4>
<div class="outline-text-4" id="text-1-5-2">
</div>
<div id="outline-container-sec-1-5-2-1" class="outline-5">
<h5 id="sec-1-5-2-1"><a id="ID-de73cecd-a3d5-44df-a1f8-a952abcb6ff5" name="ID-de73cecd-a3d5-44df-a1f8-a952abcb6ff5"></a><span class="section-number-5">1.5.2.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-2-1">

<p>
Page: 112   <a href="rwh/ch07/basicio.hs">rwh/ch07/basicio.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/basicio.hs</span>
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  putStrLn <span class="org-string">"Greetings! What is your name?"</span>
  inpStr <span class="org-haskell-operator">&lt;-</span> getLine
  putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"Welcome to Haskell, "</span> <span class="org-haskell-operator">++</span> inpStr <span class="org-haskell-operator">++</span> <span class="org-string">"!"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-2-2" class="outline-5">
<h5 id="sec-1-5-2-2"><span class="section-number-5">1.5.2.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-2-2">
<pre class="example">
[nix-shell:~/org/wiki/rwh/ch07]$ runhaskell basicio.hs 
Greetings! What is your name?
Julius Caesar
Welcome to Haskell, Julius Caesar!
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-3" class="outline-4">
<h4 id="sec-1-5-3"><a id="ID-1d5e0d92-8afc-4380-accb-b857cda4da3c" name="ID-1d5e0d92-8afc-4380-accb-b857cda4da3c"></a><span class="section-number-4">1.5.3</span> callingpure.hs</h4>
<div class="outline-text-4" id="text-1-5-3">
</div>
<div id="outline-container-sec-1-5-3-1" class="outline-5">
<h5 id="sec-1-5-3-1"><a id="ID-9a594b9b-b320-4f10-93af-d1a2f6c50d83" name="ID-9a594b9b-b320-4f10-93af-d1a2f6c50d83"></a><span class="section-number-5">1.5.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-3-1">

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/callingpure.hs</span>
<span class="org-haskell-definition">name2reply</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-definition">name2reply</span> name <span class="org-haskell-operator">=</span>
  <span class="org-string">"Pleased to meet you, "</span> <span class="org-haskell-operator">++</span> name <span class="org-haskell-operator">++</span> <span class="org-string">".\n"</span> <span class="org-haskell-operator">++</span>
  <span class="org-string">"Your name contains "</span> <span class="org-haskell-operator">++</span> charcount <span class="org-haskell-operator">++</span> <span class="org-string">" characters."</span>
  <span class="org-haskell-keyword">where</span> charcount <span class="org-haskell-operator">=</span> show (length name)

<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  putStrLn <span class="org-string">"Greetings once again. What is your name?"</span>
  inpStr <span class="org-haskell-operator">&lt;-</span> getLine
  <span class="org-haskell-keyword">let</span> outStr <span class="org-haskell-operator">=</span> name2reply inpStr
  putStrLn outStr
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-3-2" class="outline-5">
<h5 id="sec-1-5-3-2"><span class="section-number-5">1.5.3.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-3-2">
<div class="org-src-container">

<pre class="src src-haskell">[nix<span class="org-haskell-operator">-</span>shell<span class="org-haskell-constructor">:~/</span>org<span class="org-haskell-operator">/</span>wiki<span class="org-haskell-operator">/</span>rwh<span class="org-haskell-operator">/</span>ch07]<span class="org-haskell-operator">$</span> ghci
<span class="org-haskell-constructor">GHCi</span>, version 7.10<span class="org-haskell-operator">.</span>2<span class="org-haskell-constructor">:</span> http<span class="org-haskell-constructor">://</span>www<span class="org-haskell-operator">.</span>haskell<span class="org-haskell-operator">.</span>org<span class="org-haskell-operator">/</span>ghc<span class="org-haskell-operator">/</span>  <span class="org-haskell-constructor">:?</span> for help
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load 
basicio<span class="org-haskell-definition">.</span>hs      callingpure<span class="org-haskell-operator">.</span>hs
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load callingpure<span class="org-haskell-operator">.</span>hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( callingpure<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> name2reply <span class="org-string">"john"</span>
<span class="org-string">"Pleased to meet you, john.\nYour name contains 4 characters."</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> name2reply <span class="org-string">"julius caesar"</span>
<span class="org-string">"Pleased to meet you, julius caesar.\nYour name contains 13 characters."</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> putStrLn (name2reply <span class="org-string">"Julis Caesar"</span>)
<span class="org-haskell-constructor">Pleased</span> to meet you, <span class="org-haskell-constructor">Julis</span> Caesar.
<span class="org-haskell-constructor">Your</span> name contains 12 characters<span class="org-haskell-operator">.</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t putStrLn (name2reply <span class="org-string">"Julis Caesar"</span>)
<span class="org-haskell-definition">putStrLn</span> (name2reply <span class="org-string">"Julis Caesar"</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> (
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-4" class="outline-4">
<h4 id="sec-1-5-4"><a id="ID-abde9266-157e-4bf3-8d94-d759b43ed4a4" name="ID-abde9266-157e-4bf3-8d94-d759b43ed4a4"></a><span class="section-number-4">1.5.4</span> toupper-imp.hs</h4>
<div class="outline-text-4" id="text-1-5-4">
</div>
<div id="outline-container-sec-1-5-4-1" class="outline-5">
<h5 id="sec-1-5-4-1"><a id="ID-95522f15-85dd-402d-94f4-aa823f19ca4d" name="ID-95522f15-85dd-402d-94f4-aa823f19ca4d"></a><span class="section-number-5">1.5.4.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-4-1">

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/toupper-imp.hs</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.IO</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Char</span>(toUpper)

<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  inh <span class="org-haskell-operator">&lt;-</span> openFile <span class="org-string">"/etc/issue"</span> <span class="org-haskell-constructor">ReadMode</span>
  outh <span class="org-haskell-operator">&lt;-</span> openFile <span class="org-string">"/tmp/issue.out"</span> <span class="org-haskell-constructor">WriteMode</span>
  mainloop inh outh
  hClose inh
  hClose outh

<span class="org-haskell-definition">mainloop</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Handle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Handle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">mainloop</span> inh outh <span class="org-haskell-operator">=</span>
  <span class="org-haskell-keyword">do</span> ineof <span class="org-haskell-operator">&lt;-</span> hIsEOF inh
     <span class="org-haskell-keyword">if</span> ineof
       <span class="org-haskell-keyword">then</span> return <span class="org-haskell-constructor">()</span>
       <span class="org-haskell-keyword">else</span> <span class="org-haskell-keyword">do</span> inpStr <span class="org-haskell-operator">&lt;-</span> hGetLine inh
               hPutStrLn outh (map toUpper inpStr)
               mainloop inh outh
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-4-2" class="outline-5">
<h5 id="sec-1-5-4-2"><span class="section-number-5">1.5.4.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-4-2">
<pre class="example">
[nix-shell:~/org/wiki/rwh/ch07]$ runhaskell toupper-imp.hs 

[nix-shell:~/org/wiki/rwh/ch07]$ cat /etc/issue 
Arch Linux \r (\l)

[nix-shell:~/org/wiki/rwh/ch07]$ cat /tmp/issue.out 
ARCH LINUX \R (\L)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-5" class="outline-4">
<h4 id="sec-1-5-5"><a id="ID-dcd3f3aa-1762-4d25-abdc-f57ea8680e4b" name="ID-dcd3f3aa-1762-4d25-abdc-f57ea8680e4b"></a><span class="section-number-4">1.5.5</span> tempfile.hs</h4>
<div class="outline-text-4" id="text-1-5-5">
</div>
<div id="outline-container-sec-1-5-5-1" class="outline-5">
<h5 id="sec-1-5-5-1"><a id="ID-c930f726-39ae-41ea-abb0-5e406d6044f3" name="ID-c930f726-39ae-41ea-abb0-5e406d6044f3"></a><span class="section-number-5">1.5.5.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-5-1">

<p>
Page 175 <a href="rwh/ch07/tempfile.hs">rwh/ch07/tempfile.hs</a>
</p>

<p>
The code tempfile.hs failed to run and had to be changed to run in
Haskell 7.10.2.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/tempfile.hs</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.IO</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.Directory</span>    (getTemporaryDirectory, removeFile)

<span class="org-comment-delimiter">--</span><span class="org-comment">import System.IO.Error     (catch)</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Exception</span>   (catch, finally, <span class="org-haskell-constructor">IOException</span>)

<span class="org-comment-delimiter">-- </span><span class="org-comment">The main entry point.  Work with a temp file in myAction.</span>
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> withTempFile <span class="org-string">"mytemp.txt"</span> myAction

<span class="org-comment-delimiter">{- </span><span class="org-comment">The guts of the program.  Called with the path and handle of a temporary</span>
<span class="org-comment">   file.  When this function exits, that file will be closed and deleted</span>
<span class="org-comment">   because myAction was called from withTempFile. -}</span>
<span class="org-haskell-definition">myAction</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">FilePath</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Handle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">myAction</span> tempname temph <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Start by displaying a greeting on the terminal</span>
       putStrLn <span class="org-string">"Welcome to tempfile.hs"</span>
       putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"I have a temporary file at "</span> <span class="org-haskell-operator">++</span> tempname

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Let's see what the initial position is</span>
       pos <span class="org-haskell-operator">&lt;-</span> hTell temph
       putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"My initial position is "</span> <span class="org-haskell-operator">++</span> show pos

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Now, write some data to the temporary file</span>
       <span class="org-haskell-keyword">let</span> tempdata <span class="org-haskell-operator">=</span> show [1<span class="org-haskell-operator">..</span>10]
       putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"Writing one line containing "</span> <span class="org-haskell-operator">++</span> 
                  show (length tempdata) <span class="org-haskell-operator">++</span> <span class="org-string">" bytes: "</span> <span class="org-haskell-operator">++</span>
                  tempdata
       hPutStrLn temph tempdata

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Get our new position.  This doesn't actually modify pos</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">in memory, but makes the name "pos" correspond to a different </span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">value for the remainder of the "do" block.</span>
       pos <span class="org-haskell-operator">&lt;-</span> hTell temph
       putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"After writing, my new position is "</span> <span class="org-haskell-operator">++</span> show pos

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Seek to the beginning of the file and display it</span>
       putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"The file content is: "</span>
       hSeek temph <span class="org-haskell-constructor">AbsoluteSeek</span> 0

       <span class="org-comment-delimiter">-- </span><span class="org-comment">hGetContents performs a lazy read of the entire file</span>
       c <span class="org-haskell-operator">&lt;-</span> hGetContents temph

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Copy the file byte-for-byte to stdout, followed by \n</span>
       putStrLn c

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Let's also display it as a Haskell literal</span>
       putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"Which could be expressed as this Haskell literal:"</span>
       print c


<span class="org-haskell-definition">getTempdir</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">String</span> 
<span class="org-haskell-definition">getTempdir</span> <span class="org-haskell-operator">=</span>   catch getTemporaryDirectory handler
  <span class="org-haskell-keyword">where</span>
    handler <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IOException</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">String</span>
    handler <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span> <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> return <span class="org-string">"."</span> 


<span class="org-comment-delimiter">{- </span><span class="org-comment">This function takes two parameters: a filename pattern and another</span>
<span class="org-comment">   function.  It will create a temporary file, and pass the name and Handle</span>
<span class="org-comment">   of that file to the given function.</span>

<span class="org-comment">   The temporary file is created with openTempFile.  The directory is the one</span>
<span class="org-comment">   indicated by getTemporaryDirectory, or, if the system has no notion of</span>
<span class="org-comment">   a temporary directory, "." is used.  The given pattern is passed to</span>
<span class="org-comment">   openTempFile.</span>

<span class="org-comment">   After the given function terminates, even if it terminates due to an</span>
<span class="org-comment">   exception, the Handle is closed and the file is deleted. -}</span>
<span class="org-haskell-definition">withTempFile</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-type">FilePath</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Handle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> a) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> a
<span class="org-haskell-definition">withTempFile</span> <span class="org-haskell-keyword">pattern</span> func <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">The library ref says that getTemporaryDirectory may raise on</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">exception on systems that have no notion of a temporary directory.</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">So, we run getTemporaryDirectory under catch.  catch takes</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">two functions: one to run, and a different one to run if the</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">first raised an exception.  If getTemporaryDirectory raised an</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">exception, just use "." (the current working directory).</span>

       <span class="org-comment-delimiter">{- </span><span class="org-comment">Note: It doesn't work anymore in Haskell 7.10.2 -}</span>
       <span class="org-comment-delimiter">{- </span><span class="org-comment">tempdir &lt;- catch (getTemporaryDirectory) (\_ -&gt; return ".") -}</span>

       tempdir <span class="org-haskell-operator">&lt;-</span> getTempdir
       (tempfile, temph) <span class="org-haskell-operator">&lt;-</span> openTempFile tempdir <span class="org-haskell-keyword">pattern</span> 

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Call (func tempfile temph) to perform the action on the temporary</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">file.  finally takes two actions.  The first is the action to run.</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">The second is an action to run after the first, regardless of</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">whether the first action raised an exception.  This way, we ensure</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">the temporary file is always deleted.  The return value from finally</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">is the first action's return value.</span>
       finally (func tempfile temph) 
               (<span class="org-haskell-keyword">do</span> hClose temph
                   removeFile tempfile)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-5-2" class="outline-5">
<h5 id="sec-1-5-5-2"><span class="section-number-5">1.5.5.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-5-2">
<pre class="example">
$ &gt; runhaskell tempfile.hs 
Welcome to tempfile.hs
I have a temporary file at /run/user/1000/mytemp1804289383846930886.txt
My initial position is 0
Writing one line containing 22 bytes: [1,2,3,4,5,6,7,8,9,10]
After writing, my new position is 23
The file content is: 
[1,2,3,4,5,6,7,8,9,10]

Which could be expressed as this Haskell literal:
"[1,2,3,4,5,6,7,8,9,10]\n"
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-6" class="outline-4">
<h4 id="sec-1-5-6"><a id="ID-58fdaf3b-b6b1-4547-a218-13e4af64a44c" name="ID-58fdaf3b-b6b1-4547-a218-13e4af64a44c"></a><span class="section-number-4">1.5.6</span> actions.hs</h4>
<div class="outline-text-4" id="text-1-5-6">
</div>
<div id="outline-container-sec-1-5-6-1" class="outline-5">
<h5 id="sec-1-5-6-1"><a id="ID-6e385cf3-66dc-4e36-bd09-88a646210a43" name="ID-6e385cf3-66dc-4e36-bd09-88a646210a43"></a><span class="section-number-5">1.5.6.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-6-1">

<p>
IO actions can be passed as values, stored in data structures and
passed to another IO actions. They won't do anything until invoked
(called from the action main).
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/actions.hs</span>
<span class="org-haskell-definition">str2action</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">str2action</span> input <span class="org-haskell-operator">=</span> putStrLn (<span class="org-string">"Data: "</span> <span class="org-haskell-operator">++</span> input)

<span class="org-haskell-definition">list2actions</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">String</span>] <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>]
<span class="org-haskell-definition">list2actions</span> <span class="org-haskell-operator">=</span> map str2action

<span class="org-haskell-definition">numbers</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">Int</span>]
<span class="org-haskell-definition">numbers</span> <span class="org-haskell-operator">=</span> [1<span class="org-haskell-operator">..</span>10]

<span class="org-haskell-definition">strings</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">String</span>]
<span class="org-haskell-definition">strings</span> <span class="org-haskell-operator">=</span> map show numbers

<span class="org-haskell-definition">actions</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>]
<span class="org-haskell-definition">actions</span> <span class="org-haskell-operator">=</span> list2actions strings

<span class="org-haskell-definition">printitall</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">printitall</span> <span class="org-haskell-operator">=</span> runall actions

<span class="org-comment-delimiter">-- </span><span class="org-comment">Take a list of actions, and execute each of them in turn.</span>
<span class="org-haskell-definition">runall</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">runall</span> <span class="org-haskell-constructor">[]</span> <span class="org-haskell-operator">=</span> return <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">runall</span> (firstelem<span class="org-haskell-constructor">:</span>remainingelems) <span class="org-haskell-operator">=</span>
  <span class="org-haskell-keyword">do</span> firstelem
     runall remainingelems

<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> str2action <span class="org-string">"Start of the program"</span>
          printitall
          str2action <span class="org-string">"Done!"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-6-2" class="outline-5">
<h5 id="sec-1-5-6-2"><span class="section-number-5">1.5.6.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-6-2">
<pre class="example">
$ &gt; runhaskell actions.hs 
Data: Start of the program
Data: 1
Data: 2
Data: 3
Data: 4
Data: 5
Data: 6
Data: 7
Data: 8
Data: 9
Data: 10
Data: Done!
$ &gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-7" class="outline-4">
<h4 id="sec-1-5-7"><a id="ID-6093929a-53dc-4b3e-b396-2c368a655172" name="ID-6093929a-53dc-4b3e-b396-2c368a655172"></a><span class="section-number-4">1.5.7</span> actions2.hs</h4>
<div class="outline-text-4" id="text-1-5-7">
</div>
<div id="outline-container-sec-1-5-7-1" class="outline-5">
<h5 id="sec-1-5-7-1"><a id="ID-9ff8fe0a-fa42-477d-bdcd-205bdda26654" name="ID-9ff8fe0a-fa42-477d-bdcd-205bdda26654"></a><span class="section-number-5">1.5.7.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-7-1">

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/actions2.hs</span>
<span class="org-haskell-definition">str2message</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-definition">str2message</span> input <span class="org-haskell-operator">=</span> <span class="org-string">"Data: "</span> <span class="org-haskell-operator">++</span> input

<span class="org-haskell-definition">str2action</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">str2action</span> <span class="org-haskell-operator">=</span> putStrLn <span class="org-haskell-operator">.</span> str2message

<span class="org-haskell-definition">numbers</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">Int</span>]
<span class="org-haskell-definition">numbers</span> <span class="org-haskell-operator">=</span> [1<span class="org-haskell-operator">..</span>10]

<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> str2action <span class="org-string">"Start of the program"</span>
          mapM_ (str2action <span class="org-haskell-operator">.</span> show) numbers
          str2action <span class="org-string">"Done!"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-7-2" class="outline-5">
<h5 id="sec-1-5-7-2"><span class="section-number-5">1.5.7.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-7-2">
<pre class="example">
$ &gt; runhaskell actions2.hs 
Data: Start of the program
Data: 1
Data: 2
Data: 3
Data: 4
Data: 5
Data: 6
Data: 7
Data: 8
Data: 9
Data: 10
Data: Done!
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-8" class="outline-4">
<h4 id="sec-1-5-8"><a id="ID-5244cd2c-6749-416f-b5c8-2f46d121c275" name="ID-5244cd2c-6749-416f-b5c8-2f46d121c275"></a><span class="section-number-4">1.5.8</span> basicio-nodo.hs</h4>
<div class="outline-text-4" id="text-1-5-8">
</div>

<div id="outline-container-sec-1-5-8-1" class="outline-5">
<h5 id="sec-1-5-8-1"><a id="ID-7092de8f-71d1-4446-8ae7-05534a5815c2" name="ID-7092de8f-71d1-4446-8ae7-05534a5815c2"></a><span class="section-number-5">1.5.8.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-8-1">

<p>
Page 187 <a href="rwh/ch07/basicio-nodo.hs">rwh/ch07/basicio-nodo.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/basicio-nodo.hs</span>
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span>
  putStrLn <span class="org-string">"Greetings! What is your name?"</span> <span class="org-haskell-operator">&gt;&gt;</span>
  getLine <span class="org-haskell-operator">&gt;&gt;=</span>
  (<span class="org-haskell-operator">\</span>inpStr <span class="org-haskell-operator">-&gt;</span> putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"Welcome to Haskell, "</span> <span class="org-haskell-operator">++</span> inpStr <span class="org-haskell-operator">++</span> <span class="org-string">"!"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-8-2" class="outline-5">
<h5 id="sec-1-5-8-2"><span class="section-number-5">1.5.8.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-8-2">
<pre class="example">
$ &gt; runhaskell basicio-nodo.hs 
Greetings! What is your name?
Julius Caesar
Welcome to Haskell, Julius Caesar!
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-9" class="outline-4">
<h4 id="sec-1-5-9"><a id="ID-71c33d47-a99e-4005-8d2e-2be91d7b98d3" name="ID-71c33d47-a99e-4005-8d2e-2be91d7b98d3"></a><span class="section-number-4">1.5.9</span> return1.hs</h4>
<div class="outline-text-4" id="text-1-5-9">
</div>
<div id="outline-container-sec-1-5-9-1" class="outline-5">
<h5 id="sec-1-5-9-1"><a id="ID-4242f960-313f-4388-8564-55a12f9de692" name="ID-4242f960-313f-4388-8564-55a12f9de692"></a><span class="section-number-5">1.5.9.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-9-1">

<p>
Page: 187 <a href="rwh/ch07/return1.hs">rwh/ch07/return1.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/return1.hs</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Char</span>(toUpper)

<span class="org-haskell-definition">isGreen</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-definition">isGreen</span> <span class="org-haskell-operator">=</span>
  <span class="org-haskell-keyword">do</span> putStrLn <span class="org-string">"Is green your favorite color?"</span>
     inpStr <span class="org-haskell-operator">&lt;-</span> getLine
     return ((toUpper <span class="org-haskell-operator">.</span> head <span class="org-haskell-operator">$</span> inpStr) <span class="org-haskell-operator">==</span> <span class="org-string">'Y'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-9-2" class="outline-5">
<h5 id="sec-1-5-9-2"><span class="section-number-5">1.5.9.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-9-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">$</span> <span class="org-haskell-operator">&gt;</span> ghci
<span class="org-haskell-constructor">GHCi</span>, version 7.10<span class="org-haskell-operator">.</span>2<span class="org-haskell-constructor">:</span> http<span class="org-haskell-constructor">://</span>www<span class="org-haskell-operator">.</span>haskell<span class="org-haskell-operator">.</span>org<span class="org-haskell-operator">/</span>ghc<span class="org-haskell-operator">/</span>  <span class="org-haskell-constructor">:?</span> for help
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load return1<span class="org-haskell-operator">.</span>hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( return1<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t isGreen 
<span class="org-haskell-definition">isGreen</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> isGreen 
<span class="org-haskell-constructor">Is</span> green your favorite color<span class="org-haskell-operator">?</span>
<span class="org-haskell-constructor">Y</span>
<span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> isGreen 
<span class="org-haskell-constructor">Is</span> green your favorite color<span class="org-haskell-operator">?</span>
<span class="org-haskell-constructor">N</span>
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-10" class="outline-4">
<h4 id="sec-1-5-10"><a id="ID-2ab104bc-0c84-4af9-88b5-053a316e9248" name="ID-2ab104bc-0c84-4af9-88b5-053a316e9248"></a><span class="section-number-4">1.5.10</span> return2.hs</h4>
<div class="outline-text-4" id="text-1-5-10">
</div>
<div id="outline-container-sec-1-5-10-1" class="outline-5">
<h5 id="sec-1-5-10-1"><a id="ID-adc082c2-311a-46a2-85cd-33cdda2f003c" name="ID-adc082c2-311a-46a2-85cd-33cdda2f003c"></a><span class="section-number-5">1.5.10.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-10-1">

<p>
Page: 187 <a href="rwh/ch07/return2.hs">rwh/ch07/return2.hs</a> 
</p>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/return2.hs</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Char</span>(toUpper)

<span class="org-haskell-definition">isYes</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-definition">isYes</span> inpStr <span class="org-haskell-operator">=</span> (toUpper <span class="org-haskell-operator">.</span> head <span class="org-haskell-operator">$</span> inpStr) <span class="org-haskell-operator">==</span> <span class="org-string">'Y'</span>

<span class="org-haskell-definition">isGreen</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-definition">isGreen</span> <span class="org-haskell-operator">=</span>
  <span class="org-haskell-keyword">do</span> putStrLn <span class="org-string">"Is green your favorite color?"</span>
     inpStr <span class="org-haskell-operator">&lt;-</span> getLine
     return (isYes inpStr)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-10-2" class="outline-5">
<h5 id="sec-1-5-10-2"><span class="section-number-5">1.5.10.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-10-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load return2<span class="org-haskell-operator">.</span>hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( return2<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> isGreen 
<span class="org-haskell-constructor">Is</span> green your favorite color<span class="org-haskell-operator">?</span>
<span class="org-haskell-constructor">Y</span>
<span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> isGreen 
<span class="org-haskell-constructor">Is</span> green your favorite color<span class="org-haskell-operator">?</span>
<span class="org-haskell-constructor">N</span>
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-11" class="outline-4">
<h4 id="sec-1-5-11"><a id="ID-2007f6ab-07e6-40f8-9d6b-00460ef04a67" name="ID-2007f6ab-07e6-40f8-9d6b-00460ef04a67"></a><span class="section-number-4">1.5.11</span> return3.hs</h4>
<div class="outline-text-4" id="text-1-5-11">
</div>
<div id="outline-container-sec-1-5-11-1" class="outline-5">
<h5 id="sec-1-5-11-1"><a id="ID-d0a71105-e292-4bd0-9c36-6c5c82b81d3c" name="ID-d0a71105-e292-4bd0-9c36-6c5c82b81d3c"></a><span class="section-number-5">1.5.11.1</span> Code</h5>
<div class="outline-text-5" id="text-1-5-11-1">

<p>
Page: 187 <a href="rwh/ch07/return3.hs">rwh/ch07/return3.hs</a> 
</p>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch07/return3.hs</span>
<span class="org-haskell-definition">returnTest</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">returnTest</span> <span class="org-haskell-operator">=</span>
  <span class="org-haskell-keyword">do</span> one <span class="org-haskell-operator">&lt;-</span> return 1
     <span class="org-haskell-keyword">let</span> two <span class="org-haskell-operator">=</span> 2
     putStrLn <span class="org-haskell-operator">$</span> show (one <span class="org-haskell-operator">+</span> two)

<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>  
<span class="org-haskell-definition">main</span> <span class="org-haskell-operator">=</span> returnTest
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-11-2" class="outline-5">
<h5 id="sec-1-5-11-2"><span class="section-number-5">1.5.11.2</span> Running</h5>
<div class="outline-text-5" id="text-1-5-11-2">
<p>
Running in batch mode:
</p>

<pre class="example">
&gt; runhaskell return3.hs 
3
&gt;
</pre>

<p>
Running in ghci:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">$</span> <span class="org-haskell-operator">&gt;</span> ghci
<span class="org-haskell-constructor">GHCi</span>, version 7.10<span class="org-haskell-operator">.</span>2<span class="org-haskell-constructor">:</span> http<span class="org-haskell-constructor">://</span>www<span class="org-haskell-operator">.</span>haskell<span class="org-haskell-operator">.</span>org<span class="org-haskell-operator">/</span>ghc<span class="org-haskell-operator">/</span>  <span class="org-haskell-constructor">:?</span> for help
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load return3<span class="org-haskell-operator">.</span>hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( return3<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t returnTest 
<span class="org-haskell-definition">returnTest</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> return
<span class="org-haskell-definition">return</span>      returnTest
<span class="org-haskell-operator">&gt;&gt;&gt;</span> returnTest 
3
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t returnTest 
<span class="org-haskell-definition">returnTest</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Chapter 8  - Efficient File Processing, Regular Expressions, and Filename Matching</h3>
<div class="outline-text-3" id="text-1-6">
</div><div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1"><span class="section-number-4">1.6.1</span> Location</h4>
<div class="outline-text-4" id="text-1-6-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/efficient-file-processing-regular-expressions-and-file-name-matching.html">Chapter 8. Efficient file processing, regular expressions, and file name matching</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-6-2" class="outline-4">
<h4 id="sec-1-6-2"><a id="ID-d160ca41-6b1a-47b7-acc6-9a4407e0b84b" name="ID-d160ca41-6b1a-47b7-acc6-9a4407e0b84b"></a><span class="section-number-4">1.6.2</span> ElfMagic.hs</h4>
<div class="outline-text-4" id="text-1-6-2">
</div>
<div id="outline-container-sec-1-6-2-1" class="outline-5">
<h5 id="sec-1-6-2-1"><a id="ID-10c62716-029b-4c4e-aa88-69dfe85e1b7b" name="ID-10c62716-029b-4c4e-aa88-69dfe85e1b7b"></a><span class="section-number-5">1.6.2.1</span> Code</h5>
<div class="outline-text-5" id="text-1-6-2-1">

<p>
Page 194. <a href="rwh/ch08/ElfMagic.hs">rwh/ch08/ElfMagic.hs</a>  
</p>

<p>
This function tests if the file is a Unix ELF executable that are
recognized by its magic number which is a initial unique set of bytes
that identify the file. Unlike Windows, Unix like OS recognizes the
file formats by its magic number.
</p>

<p>
See also:
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Magic_number_(programming)">Magic number (programming) - Wikipedia, the free encyclopedia</a>
</li>

<li><a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">Executable and Linkable Format - Wikipedia, the free encyclopedia</a>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Data.ByteString.Lazy</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">L</span>

<span class="org-haskell-definition">hasElfMagic</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-definition">hasElfMagic</span> content <span class="org-haskell-operator">=</span> L.take 4 content <span class="org-haskell-operator">==</span> elfMagic
    <span class="org-haskell-keyword">where</span> elfMagic <span class="org-haskell-operator">=</span> L.pack [0x7f, 0x45, 0x4c, 0x46]

<span class="org-haskell-definition">isElfFile</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">FilePath</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-definition">isElfFile</span> path <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  content <span class="org-haskell-operator">&lt;-</span> L.readFile path
  return (hasElfMagic content)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-2-2" class="outline-5">
<h5 id="sec-1-6-2-2"><span class="section-number-5">1.6.2.2</span> Running</h5>
<div class="outline-text-5" id="text-1-6-2-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-constructor">GHCi</span>, version 7.10<span class="org-haskell-operator">.</span>2<span class="org-haskell-constructor">:</span> http<span class="org-haskell-constructor">://</span>www<span class="org-haskell-operator">.</span>haskell<span class="org-haskell-operator">.</span>org<span class="org-haskell-operator">/</span>ghc<span class="org-haskell-operator">/</span>  <span class="org-haskell-constructor">:?</span> for help
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"ch08/ElfMagic.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( ch08<span class="org-haskell-operator">/</span>ElfMagic.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t hasElfMagic 
<span class="org-haskell-definition">hasElfMagic</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> file <span class="org-haskell-operator">&lt;-</span> L.readFile <span class="org-string">"/bin/sh"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t file
<span class="org-haskell-definition">file</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> hasElfMagic file
<span class="org-haskell-constructor">True</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> L.take 10 file
<span class="org-string">"\DELELF\STX\SOH\SOH\NUL\NUL\NUL"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> file <span class="org-haskell-operator">&lt;-</span> L.readFile <span class="org-string">"/etc/issue"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> file
<span class="org-string">"Arch Linux \\r (\\l)\n\n"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> hasElfMagic file
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">System.Directory</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">SD</span>


<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t isElfFile 
<span class="org-haskell-definition">isElfFile</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">FilePath</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> isElfFile <span class="org-string">"/bin/sh"</span>
<span class="org-haskell-constructor">True</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> isElfFile <span class="org-string">"/etc/fstab"</span>
<span class="org-haskell-constructor">False</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> SD.setCurrentDirectory <span class="org-string">"/bin"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> SD.getCurrentDirectory 
<span class="org-string">"/usr/bin"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> files <span class="org-haskell-operator">&lt;-</span> SD.getDirectoryContents <span class="org-string">"/bin"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t files
<span class="org-haskell-definition">files</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">FilePath</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> take 4 files
[<span class="org-string">"."</span>,<span class="org-string">".."</span>,<span class="org-string">"install-info"</span>,<span class="org-string">"update-desktop-database"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> flist <span class="org-haskell-operator">=</span> drop 2 files
<span class="org-haskell-operator">&gt;&gt;&gt;</span> take 4 flist
[<span class="org-string">"install-info"</span>,<span class="org-string">"update-desktop-database"</span>,<span class="org-string">"libinput-list-devices"</span>,<span class="org-string">"visudo"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t isElfFile 
<span class="org-haskell-definition">isElfFile</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">FilePath</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span>t filter
<span class="org-haskell-definition">filter</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>) <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> [a]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> filter isElfFile flist

<span class="org-haskell-operator">&lt;</span>interactive<span class="org-haskell-operator">&gt;:</span>83<span class="org-haskell-type">:</span>8<span class="org-haskell-type">:</span>
    <span class="org-haskell-type">Couldn't</span> match <span class="org-haskell-keyword">type</span> &#8216;<span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>&#8217; with &#8216;<span class="org-haskell-type">Bool</span>&#8217;
    <span class="org-haskell-constructor">Expected</span> <span class="org-haskell-keyword">type</span><span class="org-haskell-type">:</span> <span class="org-haskell-type">FilePath</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>
      <span class="org-haskell-constructor">Actual</span> <span class="org-haskell-keyword">type</span><span class="org-haskell-type">:</span> <span class="org-haskell-type">FilePath</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Bool</span>
    <span class="org-haskell-constructor">In</span> the first argument <span class="org-haskell-keyword">of</span> &#8216;filter&#8217;, namely &#8216;isElfFile&#8217;
    <span class="org-haskell-constructor">In</span> the expression<span class="org-haskell-constructor">:</span> filter isElfFile flist
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad</span> (filterM)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t filterM
<span class="org-haskell-definition">filterM</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Monad</span> m <span class="org-haskell-operator">=&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> m <span class="org-haskell-type">Bool</span>) <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> m [a]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> filesOnly <span class="org-haskell-operator">&lt;-</span> filterM SD.doesFileExist flist
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> take 4 filesOnly 
[<span class="org-string">"install-info"</span>,<span class="org-string">"update-desktop-database"</span>,<span class="org-string">"libinput-list-devices"</span>,<span class="org-string">"visudo"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> filterM isElfFile  (take 30 filesOnly ) <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ putStrLn 
install<span class="org-haskell-definition">-</span>info
update<span class="org-haskell-definition">-</span>desktop<span class="org-haskell-operator">-</span>database
libinput<span class="org-haskell-definition">-</span>list<span class="org-haskell-operator">-</span>devices
visudo
suexec
jack_wait
dirname
j2k_dump
json<span class="org-haskell-definition">-</span>glib<span class="org-haskell-operator">-</span>format
runlevel
chacl
eu<span class="org-haskell-definition">-</span>addr2line
c<span class="org-haskell-definition">++</span>
git
gcov
ionice
lircd
<span class="org-haskell-operator">...</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-3" class="outline-4">
<h4 id="sec-1-6-3"><a id="ID-44f4e009-e4dd-441a-86f0-51d80358efba" name="ID-44f4e009-e4dd-441a-86f0-51d80358efba"></a><span class="section-number-4">1.6.3</span> HighestClose.hs</h4>
<div class="outline-text-4" id="text-1-6-3">
</div>

<div id="outline-container-sec-1-6-3-1" class="outline-5">
<h5 id="sec-1-6-3-1"><a id="ID-4271f1de-f939-415b-bf5a-77aaa5298a73" name="ID-4271f1de-f939-415b-bf5a-77aaa5298a73"></a><span class="section-number-5">1.6.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-6-3-1">

<p>
Page 196. <a href="rwh/ch08/HighestClose.hs">rwh/ch08/HighestClose.hs</a> 
</p>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Data.ByteString.Lazy.Char8</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">L</span>

<span class="org-haskell-definition">closing</span> <span class="org-haskell-operator">=</span> readPrice <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>

<span class="org-haskell-definition">readPrice</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-definition">readPrice</span> str <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">case</span> L.readInt str <span class="org-haskell-keyword">of</span>
      <span class="org-haskell-constructor">Nothing</span>             <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
      <span class="org-haskell-constructor">Just</span> (dollars,rest) <span class="org-haskell-operator">-&gt;</span>
        <span class="org-haskell-keyword">case</span> L.readInt (L.tail rest) <span class="org-haskell-keyword">of</span>
          <span class="org-haskell-constructor">Nothing</span>           <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
          <span class="org-haskell-constructor">Just</span> (cents,more) <span class="org-haskell-operator">-&gt;</span>
            <span class="org-haskell-constructor">Just</span> (dollars <span class="org-haskell-operator">*</span> 100 <span class="org-haskell-operator">+</span> cents)


<span class="org-haskell-definition">highestClose</span> <span class="org-haskell-operator">=</span> maximum <span class="org-haskell-operator">.</span> (<span class="org-haskell-constructor">Nothing:</span>) <span class="org-haskell-operator">.</span> map closing <span class="org-haskell-operator">.</span> L.lines

<span class="org-haskell-definition">highestCloseFrom</span> path <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
    contents <span class="org-haskell-operator">&lt;-</span> L.readFile path
    print (highestClose contents)
</pre>
</div>

<p>
File: <a href="rwh/ch08/prices.csv">rwh/ch08/prices.csv</a> 
</p>

<div class="org-src-container">

<pre class="src src-csv" id="prices.csv">Date,Open,High,Low,Close,Volume,Adj Close
2008-08-01,20.09,20.12,19.53,19.80,19777000,19.80
2008-06-30,21.12,21.20,20.60,20.66,17173500,20.66
2008-05-30,27.07,27.10,26.63,26.76,17754100,26.76
2008-04-30,27.17,27.78,26.76,27.41,30597400,27.41
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-6-3-2" class="outline-5">
<h5 id="sec-1-6-3-2"><span class="section-number-5">1.6.3.2</span> Running</h5>
<div class="outline-text-5" id="text-1-6-3-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch08/HighestClose.hs"</span> 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch08<span class="org-haskell-operator">/</span>HighestClose.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> highestCloseFrom <span class="org-string">"rwh/ch08/prices.csv"</span>
<span class="org-haskell-constructor">Just</span> 2741
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> contents <span class="org-haskell-operator">&lt;-</span> L.readFile <span class="org-string">"rwh/ch08/prices.csv"</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t contents
<span class="org-haskell-definition">contents</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">The output was formatted manually to fit in the </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">screen. </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> tail <span class="org-haskell-operator">$</span> L.lines contents 
[<span class="org-string">"2008-08-01,20.09,20.12,19.53,19.80,19777000,19.80"</span>,
<span class="org-string">"2008-06-30,21.12,21.20,20.60,20.66,17173500,20.66"</span>,
<span class="org-string">"2008-05-30,27.07,27.10,26.63,26.76,17754100,26.76"</span>,
<span class="org-string">"2008-04-30,27.17,27.78,26.76,27.41,30597400,27.41"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> mapM_ (<span class="org-haskell-operator">\</span> x <span class="org-haskell-operator">-&gt;</span> putStrLn (show x)) <span class="org-haskell-operator">$</span> tail <span class="org-haskell-operator">$</span> L.lines contents 
<span class="org-string">"2008-08-01,20.09,20.12,19.53,19.80,19777000,19.80"</span>
<span class="org-string">"2008-06-30,21.12,21.20,20.60,20.66,17173500,20.66"</span>
<span class="org-string">"2008-05-30,27.07,27.10,26.63,26.76,17754100,26.76"</span>
<span class="org-string">"2008-04-30,27.17,27.78,26.76,27.41,30597400,27.41"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> mapM_ (<span class="org-haskell-operator">\</span> x <span class="org-haskell-operator">-&gt;</span> putStrLn (show x)) <span class="org-haskell-operator">$</span> map (L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">$</span> tail <span class="org-haskell-operator">$</span> L.lines contents 
[<span class="org-string">"2008-08-01"</span>,<span class="org-string">"20.09"</span>,<span class="org-string">"20.12"</span>,<span class="org-string">"19.53"</span>,<span class="org-string">"19.80"</span>,<span class="org-string">"19777000"</span>,<span class="org-string">"19.80"</span>]
[<span class="org-string">"2008-06-30"</span>,<span class="org-string">"21.12"</span>,<span class="org-string">"21.20"</span>,<span class="org-string">"20.60"</span>,<span class="org-string">"20.66"</span>,<span class="org-string">"17173500"</span>,<span class="org-string">"20.66"</span>]
[<span class="org-string">"2008-05-30"</span>,<span class="org-string">"27.07"</span>,<span class="org-string">"27.10"</span>,<span class="org-string">"26.63"</span>,<span class="org-string">"26.76"</span>,<span class="org-string">"17754100"</span>,<span class="org-string">"26.76"</span>]
[<span class="org-string">"2008-04-30"</span>,<span class="org-string">"27.17"</span>,<span class="org-string">"27.78"</span>,<span class="org-string">"26.76"</span>,<span class="org-string">"27.41"</span>,<span class="org-string">"30597400"</span>,<span class="org-string">"27.41"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Adj close </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> map (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">$</span> map (L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">$</span> tail <span class="org-haskell-operator">$</span> L.lines contents 
[<span class="org-string">"19.80"</span>,<span class="org-string">"20.66"</span>,<span class="org-string">"26.76"</span>,<span class="org-string">"27.41"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">Optmization with function composition </span>
<span class="org-comment-delimiter">-- </span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> map ( (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">$</span> tail <span class="org-haskell-operator">$</span> L.lines contents 
[<span class="org-string">"19.80"</span>,<span class="org-string">"20.66"</span>,<span class="org-string">"26.76"</span>,<span class="org-string">"27.41"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> map ( (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">.</span> tail <span class="org-haskell-operator">.</span> L.lines <span class="org-haskell-operator">$</span> contents 
[<span class="org-string">"19.80"</span>,<span class="org-string">"20.66"</span>,<span class="org-string">"26.76"</span>,<span class="org-string">"27.41"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> readLByteStringMaybe  <span class="org-haskell-operator">=</span> readMaybe <span class="org-haskell-operator">.</span> L.unpack 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t readLByteStringMaybe
<span class="org-haskell-definition">readLByteStringMaybe</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Read</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> map (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> readLByteStringMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>) <span class="org-haskell-operator">$</span> map ( (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">.</span> tail <span class="org-haskell-operator">.</span> L.lines <span class="org-haskell-operator">$</span> contents 
[<span class="org-haskell-constructor">Just</span> 19.8,<span class="org-haskell-constructor">Just</span> 20.66,<span class="org-haskell-constructor">Just</span> 26.76,<span class="org-haskell-constructor">Just</span> 27.41]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> map ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> readLByteStringMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>) <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">.</span> tail <span class="org-haskell-operator">.</span> L.lines <span class="org-haskell-operator">$</span> contents 
[<span class="org-haskell-constructor">Just</span> 19.8,<span class="org-haskell-constructor">Just</span> 20.66,<span class="org-haskell-constructor">Just</span> 26.76,<span class="org-haskell-constructor">Just</span> 27.41]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">If any number fail to be parsed the whole column will fail, </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">it will return Nothing </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> sequence <span class="org-haskell-operator">$</span> map ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> readLByteStringMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>) <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">.</span> tail <span class="org-haskell-operator">.</span> L.lines <span class="org-haskell-operator">$</span> contents 
<span class="org-haskell-constructor">Just</span> [19.8,20.66,26.76,27.41]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmap sum <span class="org-haskell-operator">$</span> sequence <span class="org-haskell-operator">$</span> map ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> readLByteStringMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>) <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">!!</span>4) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">.</span> tail <span class="org-haskell-operator">.</span> L.lines <span class="org-haskell-operator">$</span> contents 
<span class="org-haskell-constructor">Just</span> 94.63
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> parseColumnDouble n <span class="org-haskell-operator">=</span>  sequence <span class="org-haskell-operator">.</span> map ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> readLByteStringMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>) <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">!!</span>n) <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">.</span> tail <span class="org-haskell-operator">.</span> L.lines 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t parseColumnDouble
<span class="org-haskell-definition">parseColumnDouble</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> [<span class="org-haskell-type">Double</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">--</span><span class="org-comment">- Multiline function composition </span>
<span class="org-comment-delimiter">--</span><span class="org-comment">- </span>
<span class="org-comment-delimiter">--</span><span class="org-comment">- </span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-</span>
<span class="org-haskell-type">:</span>set <span class="org-haskell-operator">+</span>m  <span class="org-comment-delimiter">-- </span><span class="org-comment">Allow multi line paste in the repl.</span>

<span class="org-haskell-type">:</span>{
<span class="org-haskell-keyword">let</span> parseColumnDouble n <span class="org-haskell-operator">=</span>
      sequence
      <span class="org-haskell-operator">.</span> map ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> readLByteStringMaybe x <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Double</span>)
             <span class="org-haskell-operator">.</span> (<span class="org-haskell-operator">!!</span>n)
             <span class="org-haskell-operator">.</span> L.split <span class="org-string">','</span>
            )
             <span class="org-haskell-operator">.</span> tail
             <span class="org-haskell-operator">.</span> L.lines            
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;&gt;&gt;</span> parseColumnDouble 0 contents 
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parseColumnDouble 1 contents 
<span class="org-haskell-constructor">Just</span> [20.09,21.12,27.07,27.17]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parseColumnDouble 2 contents 
<span class="org-haskell-constructor">Just</span> [20.12,21.2,27.1,27.78]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parseColumnDouble 3 contents 
<span class="org-haskell-constructor">Just</span> [19.53,20.6,26.63,26.76]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parseColumnDouble 4 contents 
<span class="org-haskell-constructor">Just</span> [19.8,20.66,26.76,27.41]

<span class="org-comment-delimiter">-- </span><span class="org-comment">Year </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> map (<span class="org-haskell-operator">!!</span>0) <span class="org-haskell-operator">$</span> map (L.split <span class="org-string">','</span>)  <span class="org-haskell-operator">$</span> tail <span class="org-haskell-operator">$</span> L.lines contents 
[<span class="org-string">"2008-08-01"</span>,<span class="org-string">"2008-06-30"</span>,<span class="org-string">"2008-05-30"</span>,<span class="org-string">"2008-04-30"</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Chapter 10 - Code Case Study: Parsing a Binary Data Format</h3>
<div class="outline-text-3" id="text-1-7">
</div><div id="outline-container-sec-1-7-1" class="outline-4">
<h4 id="sec-1-7-1"><span class="section-number-4">1.7.1</span> Location</h4>
<div class="outline-text-4" id="text-1-7-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/code-case-study-parsing-a-binary-data-format.html">Chapter 10. Code case study: parsing a binary data format</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-7-2" class="outline-4">
<h4 id="sec-1-7-2"><a id="ID-628a2e2d-5ae0-4fa6-ba66-1a0f2190d428" name="ID-628a2e2d-5ae0-4fa6-ba66-1a0f2190d428"></a><span class="section-number-4">1.7.2</span> PNM.hs</h4>
<div class="outline-text-4" id="text-1-7-2">
</div>
<div id="outline-container-sec-1-7-2-1" class="outline-5">
<h5 id="sec-1-7-2-1"><a id="ID-4db16ed3-7abf-4e71-ae19-24ea303822ea" name="ID-4db16ed3-7abf-4e71-ae19-24ea303822ea"></a><span class="section-number-5">1.7.2.1</span> Code</h5>
<div class="outline-text-5" id="text-1-7-2-1">

<p>
Page 246 - File: <a href="rwh/ch10/PNM.hs">rwh/ch10/PNM.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Data.ByteString.Lazy.Char8</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">L8</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Data.ByteString.Lazy</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">L</span> 
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Char</span> (isSpace)

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Greymap</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Greymap</span> {
      greyWidth  <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span>
    , greyHeight <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span>
    , greyMax    <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span>
    , greyData   <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span>
    } <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span>)

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Show</span> <span class="org-haskell-type">Greymap</span> <span class="org-haskell-keyword">where</span>
    show (<span class="org-haskell-constructor">Greymap</span> w h m <span class="org-haskell-keyword">_</span>) <span class="org-haskell-operator">=</span> <span class="org-string">"Greymap "</span> <span class="org-haskell-operator">++</span> show w <span class="org-haskell-operator">++</span> <span class="org-string">"x"</span> <span class="org-haskell-operator">++</span> show h <span class="org-haskell-operator">++</span>
                             <span class="org-string">" "</span> <span class="org-haskell-operator">++</span> show m

<span class="org-haskell-definition">parseP5</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> (<span class="org-haskell-type">Greymap</span>, <span class="org-haskell-type">L.ByteString</span>)
<span class="org-haskell-definition">parseP5</span> s <span class="org-haskell-operator">=</span>
  <span class="org-haskell-keyword">case</span> matchHeader (L8.pack <span class="org-string">"P5"</span>) s <span class="org-haskell-keyword">of</span>
    <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
    <span class="org-haskell-constructor">Just</span> s1 <span class="org-haskell-operator">-&gt;</span>
      <span class="org-haskell-keyword">case</span> getNat s1 <span class="org-haskell-keyword">of</span>
        <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
        <span class="org-haskell-constructor">Just</span> (width, s2) <span class="org-haskell-operator">-&gt;</span>
          <span class="org-haskell-keyword">case</span> getNat (L8.dropWhile isSpace s2) <span class="org-haskell-keyword">of</span>
            <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
            <span class="org-haskell-constructor">Just</span> (height, s3) <span class="org-haskell-operator">-&gt;</span>
              <span class="org-haskell-keyword">case</span> getNat (L8.dropWhile isSpace s3) <span class="org-haskell-keyword">of</span>
                <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
                <span class="org-haskell-constructor">Just</span> (maxGrey, s4)
                  <span class="org-haskell-operator">|</span> maxGrey <span class="org-haskell-operator">&gt;</span> 255 <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
                  <span class="org-haskell-operator">|</span> otherwise <span class="org-haskell-operator">-&gt;</span>
                      <span class="org-haskell-keyword">case</span> getBytes 1 s4 <span class="org-haskell-keyword">of</span>
                        <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
                        <span class="org-haskell-constructor">Just</span> (<span class="org-haskell-keyword">_</span>, s5) <span class="org-haskell-operator">-&gt;</span>
                          <span class="org-haskell-keyword">case</span> getBytes (width <span class="org-haskell-operator">*</span> height) s5 <span class="org-haskell-keyword">of</span>
                            <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
                            <span class="org-haskell-constructor">Just</span> (bitmap, s6) <span class="org-haskell-operator">-&gt;</span>
                              <span class="org-haskell-constructor">Just</span> (<span class="org-haskell-constructor">Greymap</span> width height maxGrey bitmap, s6)


<span class="org-haskell-definition">matchHeader</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">L.ByteString</span>
<span class="org-haskell-definition">matchHeader</span> prefix str
    <span class="org-haskell-operator">|</span> prefix <span class="org-haskell-operator">`L8.isPrefixOf`</span> str
        <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> (L8.dropWhile isSpace (L.drop (L.length prefix) str))
    <span class="org-haskell-operator">|</span> otherwise
        <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>


<span class="org-haskell-definition">getNat</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> (<span class="org-haskell-type">Int</span>, <span class="org-haskell-type">L.ByteString</span>)
<span class="org-haskell-definition">getNat</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> L8.readInt s <span class="org-haskell-keyword">of</span>
             <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
             <span class="org-haskell-constructor">Just</span> (num,rest)
                 <span class="org-haskell-operator">|</span> num <span class="org-haskell-operator">&lt;=</span> 0    <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Nothing</span>
                 <span class="org-haskell-operator">|</span> otherwise <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Just</span> (fromIntegral num, rest)

<span class="org-haskell-definition">getBytes</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> (<span class="org-haskell-type">L.ByteString</span>, <span class="org-haskell-type">L.ByteString</span>)
<span class="org-haskell-definition">getBytes</span> n str <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">let</span> count           <span class="org-haskell-operator">=</span> fromIntegral n
                     both<span class="org-haskell-operator">@</span>(prefix,<span class="org-haskell-keyword">_</span>) <span class="org-haskell-operator">=</span> L.splitAt count str
                 <span class="org-haskell-keyword">in</span> <span class="org-haskell-keyword">if</span> L.length prefix <span class="org-haskell-operator">&lt;</span> count
                    <span class="org-haskell-keyword">then</span> <span class="org-haskell-constructor">Nothing</span>
                    <span class="org-haskell-keyword">else</span> <span class="org-haskell-constructor">Just</span> both
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-2-2" class="outline-5">
<h5 id="sec-1-7-2-2"><span class="section-number-5">1.7.2.2</span> Running</h5>
<div class="outline-text-5" id="text-1-7-2-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch10/PNM.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch10<span class="org-haskell-operator">/</span>PNM.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> content <span class="org-haskell-operator">&lt;-</span> L.readFile <span class="org-string">"rwh/ch10/bird.pgm"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> L.take 30 content
<span class="org-string">"P5\n321 481\n255\n4`oxyrxvuuuuuuu"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parseP5 content
<span class="org-haskell-constructor">Just</span> (<span class="org-haskell-constructor">Greymap</span> 321x481 255,<span class="org-string">""</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>

<p>
Test files:
</p>

<ul class="org-ul">
<li><a href="rwh/ch10/bird.pgm">rwh/ch10/bird.pgm</a>
</li>

<li>rwh/ch10/bird.png 
</li>
</ul>


<div class="figure">
<p><img src="rwh/ch10/bird.png" alt="bird.png" /> 
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-3" class="outline-4">
<h4 id="sec-1-7-3"><a id="ID-2d8ec97b-199b-4f73-a873-ec93d7418cbf" name="ID-2d8ec97b-199b-4f73-a873-ec93d7418cbf"></a><span class="section-number-4">1.7.3</span> Parse.hs</h4>
<div class="outline-text-4" id="text-1-7-3">
</div>
<div id="outline-container-sec-1-7-3-1" class="outline-5">
<h5 id="sec-1-7-3-1"><a id="ID-c2c782b2-2e2b-4460-8ce7-8ca8af11d1ea" name="ID-c2c782b2-2e2b-4460-8ce7-8ca8af11d1ea"></a><span class="section-number-5">1.7.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-7-3-1">

<p>
Page 240; 250 - File: <a href="rwh/ch10/Parse.hs">rwh/ch10/Parse.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Data.ByteString.Lazy.Char8</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">L8</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Data.ByteString.Lazy</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">L</span> 
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Word</span> (<span class="org-haskell-constructor">Word8</span>)
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Int</span> (<span class="org-haskell-constructor">Int64</span>)
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Char</span> (chr, isDigit, isSpace)
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Applicative</span> ((<span class="org-haskell-operator">&lt;$&gt;</span>))

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">ParseState</span> {
      string <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span>
    , offset <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int64</span>           <span class="org-comment-delimiter">-- </span><span class="org-comment">imported from Data.Int</span>
    } <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-definition">simpleParse</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">-&gt;</span> (a, <span class="org-haskell-type">ParseState</span>)
<span class="org-haskell-definition">simpleParse</span> <span class="org-haskell-operator">=</span> undefined

<span class="org-haskell-definition">betterParse</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Either</span> <span class="org-haskell-type">String</span> (a, <span class="org-haskell-type">ParseState</span>)
<span class="org-haskell-definition">betterParse</span> <span class="org-haskell-operator">=</span> undefined

<span class="org-haskell-keyword">newtype</span> <span class="org-haskell-type">Parse</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Parse</span> {
      runParse <span class="org-haskell-operator">::</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Either</span> <span class="org-haskell-type">String</span> (a, <span class="org-haskell-type">ParseState</span>)
    }

<span class="org-haskell-definition">identity</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> a
<span class="org-haskell-definition">identity</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Parse</span> (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Right</span> (a, s))


<span class="org-haskell-definition">parse</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Either</span> <span class="org-haskell-type">String</span> a
<span class="org-haskell-definition">parse</span> parser initState
    <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> runParse parser (<span class="org-haskell-constructor">ParseState</span> initState 0) <span class="org-haskell-keyword">of</span>
        <span class="org-haskell-constructor">Left</span> err          <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Left</span> err
        <span class="org-haskell-constructor">Right</span> (result, <span class="org-haskell-keyword">_</span>) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Right</span> result

<span class="org-haskell-definition">modifyOffset</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int64</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">ParseState</span>
<span class="org-haskell-definition">modifyOffset</span> initState newOffset <span class="org-haskell-operator">=</span>
    initState { offset <span class="org-haskell-operator">=</span> newOffset }

<span class="org-haskell-definition">getState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-type">ParseState</span>
<span class="org-haskell-definition">getState</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Parse</span> (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Right</span> (s, s))

<span class="org-haskell-definition">putState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">putState</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Parse</span> (<span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Right</span> (<span class="org-haskell-constructor">()</span>, s))

<span class="org-haskell-definition">bail</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> a
<span class="org-haskell-definition">bail</span> err <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Parse</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-constructor">Left</span> <span class="org-haskell-operator">$</span>
           <span class="org-string">"byte offset "</span> <span class="org-haskell-operator">++</span> show (offset s) <span class="org-haskell-operator">++</span> <span class="org-string">": "</span> <span class="org-haskell-operator">++</span> err

(<span class="org-haskell-definition">==&gt;</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> a <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> b
<span class="org-haskell-definition">firstParser</span> <span class="org-haskell-definition">==&gt;</span> secondParser  <span class="org-haskell-operator">=</span>  <span class="org-haskell-constructor">Parse</span> chainedParser
  <span class="org-haskell-keyword">where</span> chainedParser initState   <span class="org-haskell-operator">=</span>
          <span class="org-haskell-keyword">case</span> runParse firstParser initState <span class="org-haskell-keyword">of</span>
            <span class="org-haskell-constructor">Left</span> errMessage <span class="org-haskell-operator">-&gt;</span>
                <span class="org-haskell-constructor">Left</span> errMessage
            <span class="org-haskell-constructor">Right</span> (firstResult, newState) <span class="org-haskell-operator">-&gt;</span>
                runParse (secondParser firstResult) newState


<span class="org-haskell-definition">parseByte</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-type">Word8</span>
<span class="org-haskell-definition">parseByte</span> <span class="org-haskell-operator">=</span>
    getState <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>initState <span class="org-haskell-operator">-&gt;</span>
    <span class="org-haskell-keyword">case</span> L.uncons (string initState) <span class="org-haskell-keyword">of</span>
      <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span>
          bail <span class="org-string">"no more input"</span>
      <span class="org-haskell-constructor">Just</span> (byte,remainder) <span class="org-haskell-operator">-&gt;</span>
          putState newState <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span>
          identity byte
        <span class="org-haskell-keyword">where</span> newState <span class="org-haskell-operator">=</span> initState { string <span class="org-haskell-operator">=</span> remainder,
                                     offset <span class="org-haskell-operator">=</span> newOffset }
              newOffset <span class="org-haskell-operator">=</span> offset initState <span class="org-haskell-operator">+</span> 1

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Functor</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-keyword">where</span>
    fmap f parser <span class="org-haskell-operator">=</span> parser <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>result <span class="org-haskell-operator">-&gt;</span>
                    identity (f result)

<span class="org-haskell-definition">w2c</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Word8</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Char</span>
<span class="org-haskell-definition">w2c</span> <span class="org-haskell-operator">=</span> chr <span class="org-haskell-operator">.</span> fromIntegral

<span class="org-haskell-definition">parseChar</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-type">Char</span>
<span class="org-haskell-definition">parseChar</span> <span class="org-haskell-operator">=</span> w2c <span class="org-haskell-operator">&lt;$&gt;</span> parseByte

<span class="org-haskell-definition">peekByte</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> (<span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Word8</span>)
<span class="org-haskell-definition">peekByte</span> <span class="org-haskell-operator">=</span> (fmap fst <span class="org-haskell-operator">.</span> L.uncons <span class="org-haskell-operator">.</span> string) <span class="org-haskell-operator">&lt;$&gt;</span> getState

<span class="org-haskell-definition">peekChar</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> (<span class="org-haskell-type">Maybe</span> <span class="org-haskell-type">Char</span>)
<span class="org-haskell-definition">peekChar</span> <span class="org-haskell-operator">=</span> fmap w2c <span class="org-haskell-operator">&lt;$&gt;</span> peekByte


<span class="org-haskell-definition">parseWhile</span> <span class="org-haskell-operator">::</span> (<span class="org-haskell-type">Word8</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> [<span class="org-haskell-type">Word8</span>]
<span class="org-haskell-definition">parseWhile</span> p <span class="org-haskell-operator">=</span> (fmap p <span class="org-haskell-operator">&lt;$&gt;</span> peekByte) <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>mp <span class="org-haskell-operator">-&gt;</span>
               <span class="org-haskell-keyword">if</span> mp <span class="org-haskell-operator">==</span> <span class="org-haskell-constructor">Just</span> <span class="org-haskell-constructor">True</span>
               <span class="org-haskell-keyword">then</span> parseByte <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>b <span class="org-haskell-operator">-&gt;</span>
                    (b<span class="org-haskell-constructor">:</span>) <span class="org-haskell-operator">&lt;$&gt;</span> parseWhile p
               <span class="org-haskell-keyword">else</span> identity <span class="org-haskell-constructor">[]</span>

<span class="org-haskell-definition">parseWhileVerbose</span> p <span class="org-haskell-operator">=</span>
    peekByte <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>mc <span class="org-haskell-operator">-&gt;</span>
    <span class="org-haskell-keyword">case</span> mc <span class="org-haskell-keyword">of</span>
      <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">-&gt;</span> identity <span class="org-haskell-constructor">[]</span>
      <span class="org-haskell-constructor">Just</span> c <span class="org-haskell-operator">|</span> p c <span class="org-haskell-operator">-&gt;</span>
                 parseByte <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>b <span class="org-haskell-operator">-&gt;</span>
                 parseWhileVerbose p <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>bs <span class="org-haskell-operator">-&gt;</span>
                 identity (b<span class="org-haskell-constructor">:</span>bs)
             <span class="org-haskell-operator">|</span> otherwise <span class="org-haskell-operator">-&gt;</span>
                 identity <span class="org-haskell-constructor">[]</span>

<span class="org-haskell-definition">parseWhileWith</span> <span class="org-haskell-operator">::</span> (<span class="org-haskell-type">Word8</span> <span class="org-haskell-operator">-&gt;</span> a) <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Bool</span>) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> [a]
<span class="org-haskell-definition">parseWhileWith</span> f p <span class="org-haskell-operator">=</span> fmap f <span class="org-haskell-operator">&lt;$&gt;</span> parseWhile (p <span class="org-haskell-operator">.</span> f)

<span class="org-haskell-definition">parseNat</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-definition">parseNat</span> <span class="org-haskell-operator">=</span> parseWhileWith w2c isDigit <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>digits <span class="org-haskell-operator">-&gt;</span>
           <span class="org-haskell-keyword">if</span> null digits
           <span class="org-haskell-keyword">then</span> bail <span class="org-string">"no more input"</span>
           <span class="org-haskell-keyword">else</span> <span class="org-haskell-keyword">let</span> n <span class="org-haskell-operator">=</span> read digits
                <span class="org-haskell-keyword">in</span> <span class="org-haskell-keyword">if</span> n <span class="org-haskell-operator">&lt;</span> 0
                   <span class="org-haskell-keyword">then</span> bail <span class="org-string">"integer overflow"</span>
                   <span class="org-haskell-keyword">else</span> identity n

(<span class="org-haskell-definition">==&gt;&amp;</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> b <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> b
<span class="org-haskell-definition">p</span> <span class="org-haskell-definition">==&gt;&amp;</span> f <span class="org-haskell-operator">=</span> p <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> f

<span class="org-haskell-definition">skipSpaces</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">skipSpaces</span> <span class="org-haskell-operator">=</span> parseWhileWith w2c isSpace <span class="org-haskell-operator">==&gt;&amp;</span> identity <span class="org-haskell-constructor">()</span>

<span class="org-haskell-definition">assert</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Bool</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">assert</span> <span class="org-haskell-constructor">True</span>  <span class="org-haskell-keyword">_</span>   <span class="org-haskell-operator">=</span> identity <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">assert</span> <span class="org-haskell-constructor">False</span> err <span class="org-haskell-operator">=</span> bail err

<span class="org-haskell-definition">parseBytes</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> <span class="org-haskell-type">L.ByteString</span>
<span class="org-haskell-definition">parseBytes</span> n <span class="org-haskell-operator">=</span>
    getState <span class="org-haskell-operator">==&gt;</span> <span class="org-haskell-operator">\</span>st <span class="org-haskell-operator">-&gt;</span>
    <span class="org-haskell-keyword">let</span> n' <span class="org-haskell-operator">=</span> fromIntegral n
        (h, t) <span class="org-haskell-operator">=</span> L.splitAt n' (string st)
        st' <span class="org-haskell-operator">=</span> st { offset <span class="org-haskell-operator">=</span> offset st <span class="org-haskell-operator">+</span> L.length h, string <span class="org-haskell-operator">=</span> t }
    <span class="org-haskell-keyword">in</span> putState st' <span class="org-haskell-operator">==&gt;&amp;</span>
       assert (L.length h <span class="org-haskell-operator">==</span> n') <span class="org-string">"end of input"</span> <span class="org-haskell-operator">==&gt;&amp;</span>
       identity h
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-3-2" class="outline-5">
<h5 id="sec-1-7-3-2"><span class="section-number-5">1.7.3.2</span> Running</h5>
<div class="outline-text-5" id="text-1-7-3-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch10/Parse.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch10<span class="org-haskell-operator">/</span>Parse.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t identity
<span class="org-haskell-definition">identity</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Parse</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span>info <span class="org-haskell-type">Parse</span>
<span class="org-haskell-keyword">newtype</span> <span class="org-haskell-type">Parse</span> a
  <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Parse</span> {runParse <span class="org-haskell-operator">::</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Either</span> <span class="org-haskell-type">String</span> (a, <span class="org-haskell-type">ParseState</span>)}
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined at rwh/ch10/Parse.hs:18:1</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span><span class="org-haskell-keyword">type</span> parse (identity 1) undefined
<span class="org-haskell-definition">parse</span> (identity 1) undefined <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Num</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">Either</span> <span class="org-haskell-type">String</span> a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse (identity 1) undefined
<span class="org-haskell-constructor">Right</span> 1
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse (identity <span class="org-string">"foo"</span>) undefined
<span class="org-haskell-constructor">Right</span> <span class="org-string">"foo"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> before <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">ParseState</span> (L8.pack <span class="org-string">"foo"</span>) 0
<span class="org-haskell-operator">&gt;&gt;&gt;</span> before
<span class="org-haskell-constructor">ParseState</span> {string <span class="org-haskell-operator">=</span> <span class="org-string">"foo"</span>, offset <span class="org-haskell-operator">=</span> 0}
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> after <span class="org-haskell-operator">=</span> modifyOffset before 3
<span class="org-haskell-operator">&gt;&gt;&gt;</span> after
<span class="org-haskell-constructor">ParseState</span> {string <span class="org-haskell-operator">=</span> <span class="org-string">"foo"</span>, offset <span class="org-haskell-operator">=</span> 3}
<span class="org-haskell-operator">&gt;&gt;&gt;</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t L8.uncons
L8<span class="org-haskell-definition">.</span>uncons <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> (<span class="org-haskell-type">Char</span>, <span class="org-haskell-type">L.ByteString</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span>t L8.pack
L8<span class="org-haskell-definition">.</span>pack <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">Char</span>] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">L.ByteString</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> L8.pack <span class="org-string">"foo"</span>
<span class="org-string">"foo"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t L8.pack <span class="org-string">"foo"</span>
L8<span class="org-haskell-definition">.</span>pack <span class="org-string">"foo"</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> L8.uncons <span class="org-haskell-operator">$</span> L8.pack <span class="org-string">"foo"</span>
<span class="org-haskell-constructor">Just</span> (<span class="org-string">'f'</span>,<span class="org-string">"oo"</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> L8.uncons <span class="org-haskell-operator">$</span> L8.empty
<span class="org-haskell-constructor">Nothing</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t runParse
<span class="org-haskell-definition">runParse</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">ParseState</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Either</span> <span class="org-haskell-type">String</span> (a, <span class="org-haskell-type">ParseState</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span>t parse
<span class="org-haskell-definition">parse</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Parse</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">L.ByteString</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Either</span> <span class="org-haskell-type">String</span> a

<span class="org-comment-delimiter">-- </span><span class="org-comment">0xff = 255</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseByte (L8.pack <span class="org-string">"\xff"</span>)
<span class="org-haskell-constructor">Right</span> 255
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseByte (L8.pack <span class="org-string">"\xa"</span>)
<span class="org-haskell-constructor">Right</span> 10
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseByte (L8.pack <span class="org-string">"\xb"</span>)
<span class="org-haskell-constructor">Right</span> 11
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseByte (L8.pack <span class="org-string">""</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"byte offset 0: no more input"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">0xfa = 16 * 15 + 10  = 250 decimal </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runParse parseByte  <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">ParseState</span> (L8.pack <span class="org-string">"\xfa"</span>) 0
<span class="org-haskell-constructor">Right</span> (250,<span class="org-haskell-constructor">ParseState</span> {string <span class="org-haskell-operator">=</span> <span class="org-string">""</span>, offset <span class="org-haskell-operator">=</span> 1})
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runParse parseByte  <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">ParseState</span> (L8.pack <span class="org-string">"x9023"</span>) 1
<span class="org-haskell-constructor">Right</span> (120,<span class="org-haskell-constructor">ParseState</span> {string <span class="org-haskell-operator">=</span> <span class="org-string">"9023"</span>, offset <span class="org-haskell-operator">=</span> 2})
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runParse parseByte  <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">ParseState</span> (L8.pack <span class="org-string">""</span>) 1
<span class="org-haskell-constructor">Left</span> <span class="org-string">"byte offset 1: no more input"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> input <span class="org-haskell-operator">=</span> L8.pack <span class="org-string">"foo"</span>

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t input
<span class="org-haskell-definition">input</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">L.ByteString</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> L.head input
102
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseByte input
<span class="org-haskell-constructor">Right</span> 102
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse (id <span class="org-haskell-operator">&lt;$&gt;</span> parseByte) input
<span class="org-haskell-constructor">Right</span> 102
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse ((<span class="org-haskell-operator">*</span>2) <span class="org-haskell-operator">&lt;$&gt;</span> parseByte) input
<span class="org-haskell-constructor">Right</span> 204 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseNat (L8.pack <span class="org-string">"10023 asdb"</span>)
<span class="org-haskell-constructor">Right</span> 10023
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseNat (L8.pack <span class="org-string">"sad10023 asdb"</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"byte offset 0: no more input"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseChar (L8.pack <span class="org-string">"23"</span>)
<span class="org-haskell-constructor">Right</span> <span class="org-string">'2'</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> parse parseChar (L8.pack <span class="org-string">""</span>)
<span class="org-haskell-constructor">Left</span> <span class="org-string">"byte offset 0: no more input"</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-4" class="outline-4">
<h4 id="sec-1-7-4"><a id="ID-5aaef142-aec5-4f9e-bc01-b5e5e6b78611" name="ID-5aaef142-aec5-4f9e-bc01-b5e5e6b78611"></a><span class="section-number-4">1.7.4</span> TreeMap.sh</h4>
<div class="outline-text-4" id="text-1-7-4">
</div>
<div id="outline-container-sec-1-7-4-1" class="outline-5">
<h5 id="sec-1-7-4-1"><a id="ID-2b500650-5e07-479b-a85b-f317cf57039b" name="ID-2b500650-5e07-479b-a85b-f317cf57039b"></a><span class="section-number-5">1.7.4.1</span> Code</h5>
<div class="outline-text-5" id="text-1-7-4-1">

<p>
Page: 244 - File: <a href="rwh/ch10/TreeMap.hs">rwh/ch10/TreeMap.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Tree</span> a <span class="org-haskell-operator">=</span>  <span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Tree</span> a) (<span class="org-haskell-constructor">Tree</span> a)
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Leaf</span> a 
              <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Show</span>)

<span class="org-haskell-definition">treeLengths</span> (<span class="org-haskell-constructor">Leaf</span> s) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Leaf</span> (length s)
<span class="org-haskell-definition">treeLengths</span> (<span class="org-haskell-constructor">Node</span> l r) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Node</span> (treeLengths l) (treeLengths r)

<span class="org-haskell-definition">treeMap</span> <span class="org-haskell-operator">::</span> (a <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Tree</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Tree</span> b
<span class="org-haskell-definition">treeMap</span> f (<span class="org-haskell-constructor">Leaf</span> a)   <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Leaf</span> (f a)
<span class="org-haskell-definition">treeMap</span> f (<span class="org-haskell-constructor">Node</span> l r) <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Node</span> (treeMap f l) (treeMap f r)

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">class Functor f where</span>
<span class="org-comment">    fmap :: (a -&gt; b) -&gt; f a -&gt; f b</span>
<span class="org-comment">-}</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Functor</span> <span class="org-haskell-type">Tree</span> <span class="org-haskell-keyword">where</span>
    fmap <span class="org-haskell-operator">=</span> treeMap

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmap length (<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"North Carolina"</span>) (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"Puerto Rico"</span>))
<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> 14) (<span class="org-haskell-constructor">Leaf</span> 11)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> fmap id (<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"a"</span>) (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"b"</span>))
<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"a"</span>) (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"b"</span>)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-7-4-2" class="outline-5">
<h5 id="sec-1-7-4-2"><span class="section-number-5">1.7.4.2</span> Running</h5>
<div class="outline-text-5" id="text-1-7-4-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"rwh/ch10/TreeMap.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( rwh<span class="org-haskell-operator">/</span>ch10<span class="org-haskell-operator">/</span>TreeMap.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>info <span class="org-haskell-constructor">Tree</span>
<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Tree</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Tree</span> a) (<span class="org-haskell-constructor">Tree</span> a) <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Leaf</span> a
        <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined at rwh/ch10/TreeMap.hs:2:1</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Show</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">Show</span> (<span class="org-haskell-type">Tree</span> a)
  <span class="org-comment-delimiter">-- </span><span class="org-comment">Defined at rwh/ch10/TreeMap.hs:4:25</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> tree <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"foo"</span>) (<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"x"</span>) (<span class="org-haskell-constructor">Leaf</span> <span class="org-string">"quux"</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t tree
<span class="org-haskell-definition">tree</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Tree</span> [<span class="org-haskell-type">Char</span>]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> treeLengths tree
<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> 3) (<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> 1) (<span class="org-haskell-constructor">Leaf</span> 4))
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> treeMap (odd <span class="org-haskell-operator">.</span> length) tree
<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> <span class="org-haskell-constructor">True</span>) (<span class="org-haskell-constructor">Node</span> (<span class="org-haskell-constructor">Leaf</span> <span class="org-haskell-constructor">True</span>) (<span class="org-haskell-constructor">Leaf</span> <span class="org-haskell-constructor">False</span>))
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> Chapter 13 - Data Structures</h3>
</div>
<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> Chapter 14 - Monads</h3>
<div class="outline-text-3" id="text-1-9">
</div><div id="outline-container-sec-1-9-1" class="outline-4">
<h4 id="sec-1-9-1"><span class="section-number-4">1.9.1</span> Location</h4>
<div class="outline-text-4" id="text-1-9-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/monads.html">Chapter 14. Monads</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-9-2" class="outline-4">
<h4 id="sec-1-9-2"><a id="ID-59a268ba-7f65-4091-b109-9e8878a8b3ed" name="ID-59a268ba-7f65-4091-b109-9e8878a8b3ed"></a><span class="section-number-4">1.9.2</span> Maybe.hs</h4>
<div class="outline-text-4" id="text-1-9-2">

<p>
Page 367 - File: <a href="rwh/ch14/Maybe.hs">rwh/ch14/Maybe.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch14/Maybe.hs </span>

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Maybe</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">Just</span> a 

<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Monad</span> <span class="org-haskell-type">Maybe</span> <span class="org-haskell-keyword">where</span>

 <span class="org-comment-delimiter">-- </span><span class="org-comment">chain </span>
 (<span class="org-haskell-operator">&gt;&gt;=</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> a <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> b
 <span class="org-haskell-constructor">Just</span> x    <span class="org-haskell-operator">&gt;&gt;=</span> fn <span class="org-haskell-operator">=</span> fn x
 <span class="org-haskell-constructor">Nothing</span>   <span class="org-haskell-operator">&gt;&gt;=</span> fn <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

 <span class="org-comment-delimiter">-- </span><span class="org-comment">inject </span>
 return <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span>  <span class="org-haskell-type">Maybe</span> a
 return a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Just</span> a 

 <span class="org-comment-delimiter">--</span><span class="org-comment">-</span>
 (<span class="org-haskell-operator">&gt;&gt;</span>) <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Maybe</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> b <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> b
 <span class="org-haskell-constructor">Just</span> <span class="org-haskell-keyword">_</span>   <span class="org-haskell-operator">&gt;&gt;</span> mb <span class="org-haskell-operator">=</span> mb
 <span class="org-haskell-constructor">Nothing</span>  <span class="org-haskell-operator">&gt;&gt;</span> mb <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>

 fail <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span> 



<span class="org-comment-delimiter">{- </span><span class="org-comment">Function that executes the Maybe monad. If the computation </span>
<span class="org-comment">   fails the third parameter is Nothing it returns the value n, </span>
<span class="org-comment">   on  the other hand if the computation succeeds the third</span>
<span class="org-comment">   parameter is (Just x) it applies the function (a -&gt; b) to the</span>
<span class="org-comment">   value x wrapped in the monad. </span>

<span class="org-comment">-}</span>
<span class="org-haskell-definition">maybe</span> <span class="org-haskell-operator">::</span> b <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> b ) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Maybe</span> a <span class="org-haskell-operator">-&gt;</span> b
<span class="org-haskell-definition">maybe</span> n <span class="org-haskell-keyword">_</span> <span class="org-haskell-constructor">Nothing</span>  <span class="org-haskell-operator">=</span> n 
<span class="org-haskell-definition">maybe</span> <span class="org-haskell-keyword">_</span> f (<span class="org-haskell-constructor">Just</span> x) <span class="org-haskell-operator">=</span> f x
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-3" class="outline-4">
<h4 id="sec-1-9-3"><a id="ID-df84c4d5-4eba-4a4d-aad2-a30b2f8a4398" name="ID-df84c4d5-4eba-4a4d-aad2-a30b2f8a4398"></a><span class="section-number-4">1.9.3</span> MultiplyTo.hs</h4>
<div class="outline-text-4" id="text-1-9-3">
</div>

<div id="outline-container-sec-1-9-3-1" class="outline-5">
<h5 id="sec-1-9-3-1"><a id="ID-1272d371-6693-40de-aeeb-fbe0a92eeabb" name="ID-1272d371-6693-40de-aeeb-fbe0a92eeabb"></a><span class="section-number-5">1.9.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-9-3-1">

<p>
Page: 343. File: <a href="rwh/ch14/MultiplyTo.hs">rwh/ch14/MultiplyTo.hs</a>
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-definition">guarded</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Bool</span> <span class="org-haskell-operator">-&gt;</span> [a] <span class="org-haskell-operator">-&gt;</span> [a]
<span class="org-haskell-definition">guarded</span> <span class="org-haskell-constructor">True</span>  xs <span class="org-haskell-operator">=</span> xs
<span class="org-haskell-definition">guarded</span> <span class="org-haskell-constructor">False</span> <span class="org-haskell-keyword">_</span>  <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">[]</span>

<span class="org-haskell-definition">multiplyTo</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> [(<span class="org-haskell-type">Int</span>, <span class="org-haskell-type">Int</span>)]
<span class="org-haskell-definition">multiplyTo</span> n <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> 
  x <span class="org-haskell-operator">&lt;-</span> [1<span class="org-haskell-operator">..</span>n]
  y <span class="org-haskell-operator">&lt;-</span> [x<span class="org-haskell-operator">..</span>n]
  guarded (x <span class="org-haskell-operator">*</span> y <span class="org-haskell-operator">==</span> n) <span class="org-haskell-operator">$</span>
    return (x, y)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-3-2" class="outline-5">
<h5 id="sec-1-9-3-2"><span class="section-number-5">1.9.3.2</span> Running</h5>
<div class="outline-text-5" id="text-1-9-3-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load ch14<span class="org-haskell-operator">/</span>MultiplyTo.hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( ch14<span class="org-haskell-operator">/</span>MultiplyTo.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t multiplyTo 
<span class="org-haskell-definition">multiplyTo</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> [(<span class="org-haskell-type">Int</span>, <span class="org-haskell-type">Int</span>)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> multiplyTo 8
[(1,8),(2,4)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> multiplyTo 100
[(1,100),(2,50),(4,25),(5,20),(10,10)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> multiplyTo 891
[(1,891),(3,297),(9,99),(11,81),(27,33)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> multiplyTo 1000
[(1,1000),(2,500),(4,250),(5,200),(8,125),(10,100),(20,50),(25,40)]
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-4" class="outline-4">
<h4 id="sec-1-9-4"><a id="ID-47972b40-8b89-4151-9e0e-7b4d9c5af4e7" name="ID-47972b40-8b89-4151-9e0e-7b4d9c5af4e7"></a><span class="section-number-4">1.9.4</span> SimpleState.hs</h4>
<div class="outline-text-4" id="text-1-9-4">
</div>

<div id="outline-container-sec-1-9-4-1" class="outline-5">
<h5 id="sec-1-9-4-1"><a id="ID-0a52baf0-f7db-44a3-aaa4-92ba0454acf7" name="ID-0a52baf0-f7db-44a3-aaa4-92ba0454acf7"></a><span class="section-number-5">1.9.4.1</span> Code</h5>
<div class="outline-text-5" id="text-1-9-4-1">

<p>
Page: 347 - File: <a href="rwh/ch14/SimpleState.hs">rwh/ch14/SimpleState.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch14/SimpleState.hs</span>

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">   This function transforms one state into another yielding</span>
<span class="org-comment">   a result (output). The state monad is also called</span>
<span class="org-comment">   State Transformer Monad. </span>

<span class="org-comment">   s            : Type of state</span>
<span class="org-comment">   a            : Type of state output</span>

<span class="org-comment">   s -&gt; (a, s)  : State transformer function </span>


<span class="org-comment">            :: SimpleState s a         :: SimpleState s a</span>

<span class="org-comment">             |-------------|            |-------------|</span>
<span class="org-comment">State 0      |             | State 1    |             | State 2</span>
<span class="org-comment">        ---&gt; | a -&gt; (a, s) | ------&gt;    | a -&gt; (a, s) | -------&gt;            </span>
<span class="org-comment">             |-------------|            |-------------|  </span>
<span class="org-comment">                  |                                |</span>
<span class="org-comment">                  |                                |</span>
<span class="org-comment">                 \ / Output 1: a                  \ /  Output 2: a</span>

<span class="org-comment"> -}</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">SimpleState</span> s a <span class="org-haskell-operator">=</span> s <span class="org-haskell-operator">-&gt;</span> (a, s)

<span class="org-comment-delimiter">-- </span><span class="org-comment">A type can be partially applied. The type constructor is:</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">SimpleState s</span>
<span class="org-comment-delimiter">-- </span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">StringState</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-type">SimpleState</span> <span class="org-haskell-type">String</span> a

<span class="org-haskell-definition">returnSt</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SimpleState</span> s a
<span class="org-haskell-definition">returnSt</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> (a, s)

<span class="org-haskell-definition">returnAlt</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SimpleState</span> s a
<span class="org-haskell-definition">returnAlt</span> a s <span class="org-haskell-operator">=</span> (a, s)

<span class="org-haskell-definition">bindSt</span> <span class="org-haskell-operator">::</span> (<span class="org-haskell-type">SimpleState</span> s a) <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SimpleState</span> s b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SimpleState</span> s b
<span class="org-haskell-definition">bindSt</span> m fn <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (a, s') <span class="org-haskell-operator">=</span> m s
                    <span class="org-haskell-keyword">in</span> (fn a) s'

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">  A more readable version of bindSt </span>

<span class="org-comment">   -- m == step</span>
<span class="org-comment">   -- k == makeStep</span>
<span class="org-comment">   -- s == oldState </span>
<span class="org-comment">-}</span>
<span class="org-haskell-definition">bindAlt</span> <span class="org-haskell-operator">::</span> (<span class="org-haskell-type">SimpleState</span> s a) <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SimpleState</span> s b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SimpleState</span> s b
<span class="org-haskell-definition">bindAlt</span> step makeStep oldState <span class="org-haskell-operator">=</span>
  <span class="org-haskell-keyword">let</span> (result, newState) <span class="org-haskell-operator">=</span> step oldState
  <span class="org-haskell-keyword">in</span> (makeStep result) newState


<span class="org-comment-delimiter">{- </span><span class="org-comment">Get current state and returens it as result -}</span>
<span class="org-haskell-definition">getSt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SimpleState</span> s s 
<span class="org-haskell-definition">getSt</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> (s, s)

<span class="org-comment-delimiter">{- </span><span class="org-comment">Set current state and ignore the current one. -}</span>
<span class="org-haskell-definition">putSt</span> <span class="org-haskell-operator">::</span> s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SimpleState</span> s <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">putSt</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">()</span>, s)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-4-2" class="outline-5">
<h5 id="sec-1-9-4-2"><span class="section-number-5">1.9.4.2</span> Running</h5>
<div class="outline-text-5" id="text-1-9-4-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load ch14<span class="org-haskell-operator">/</span>SimpleState.hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( ch14<span class="org-haskell-operator">/</span>SimpleState.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">It can be pasted in Ghci </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">The current state is n, the next state is </span>
<span class="org-comment-delimiter">-- </span><span class="org-comment">n + 1, the state output is 2 * n </span>
<span class="org-comment-delimiter">--</span>

<span class="org-comment-delimiter">{-</span>
<span class="org-comment">       |---------|        |----------|       |----------|     |---------|</span>
<span class="org-comment">   ---&gt;| stateFn |----&gt;   | stateFn  |-----&gt; | stateFn  |----&gt;| stateFn |--&gt; </span>
<span class="org-comment">  1    |---------|    2   |----------|   3   |----------| 4   |---------|   5 ...</span>
<span class="org-comment">            |                   |                 |                | </span>
<span class="org-comment">            |                   |                 |                |</span>
<span class="org-comment">           \ /                 \ /               \ /              \ /</span>
<span class="org-comment">           output = 2          output = 4       output = 6        output = 8</span>
<span class="org-comment">-}</span>


<span class="org-haskell-constructor">:</span>{

<span class="org-haskell-keyword">let</span> stateFn <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SimpleState</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-type">Int</span> 
    stateFn n <span class="org-haskell-operator">=</span> (2 <span class="org-haskell-operator">*</span> n, n <span class="org-haskell-operator">+</span> 1)
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateFn 
<span class="org-haskell-definition">stateFn</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SimpleState</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> stateFn 1
(2,2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stateFn 2
(4,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stateFn 3
(6,4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stateFn 4
(8,5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stateFn 5
(10,6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> stateFn 6
(12,7)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t returnSt 10
<span class="org-haskell-definition">returnSt</span> 10 <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Num</span> a <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">SimpleState</span> s a
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> (returnSt 10) 3
(10,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> (returnSt 20) 4
(20,4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> (returnSt 12) 5
(12,5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> getSt 3
(3,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> getSt 10
(10,10)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> (putSt 3) 4
(<span class="org-haskell-constructor">()</span>,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> (putSt 3) 4
(<span class="org-haskell-constructor">()</span>,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> (putSt 3) 5
(<span class="org-haskell-constructor">()</span>,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> (putSt 3) 10
(<span class="org-haskell-constructor">()</span>,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-5" class="outline-4">
<h4 id="sec-1-9-5"><a id="ID-ee2209d0-76cb-4681-a725-0d4e99374cd3" name="ID-ee2209d0-76cb-4681-a725-0d4e99374cd3"></a><span class="section-number-4">1.9.5</span> State.hs</h4>
<div class="outline-text-4" id="text-1-9-5">
</div>
<div id="outline-container-sec-1-9-5-1" class="outline-5">
<h5 id="sec-1-9-5-1"><a id="ID-b79e9e77-d696-413a-8c53-6d77413b09e2" name="ID-b79e9e77-d696-413a-8c53-6d77413b09e2"></a><span class="section-number-5">1.9.5.1</span> Code</h5>
<div class="outline-text-5" id="text-1-9-5-1">

<p>
Page: 349 - File: <a href="rwh/ch14/State.hs">rwh/ch14/State.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">{-</span>
<span class="org-comment">  Applies a state transformer to a state and returns a new state</span>
<span class="org-comment">  yielding a result. </span>

<span class="org-comment">  runState :: State s a -&gt; s -&gt; (a, s)</span>

<span class="org-comment"> -}</span>
<span class="org-haskell-keyword">newtype</span> <span class="org-haskell-type">State</span> s a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> { runState <span class="org-haskell-operator">::</span> s <span class="org-haskell-operator">-&gt;</span> (a, s)  }


<span class="org-haskell-definition">returnState</span> <span class="org-haskell-operator">::</span> a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">State</span> s a
<span class="org-haskell-definition">returnState</span> a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> ( <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> (a, s) )

<span class="org-haskell-definition">bindState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> s a <span class="org-haskell-operator">-&gt;</span> (a <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">State</span> s b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">State</span> s b
<span class="org-haskell-definition">bindState</span> m fn <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (a, s') <span class="org-haskell-operator">=</span> runState m s
                               <span class="org-haskell-keyword">in</span> runState (fn a) s'

<span class="org-comment-delimiter">-- </span><span class="org-comment">evalState : Returns only the result, throwing away the final state</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-definition">evalState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> a
<span class="org-haskell-definition">evalState</span> fn s <span class="org-haskell-operator">=</span> fst (runState fn s)

<span class="org-comment-delimiter">-- </span><span class="org-comment">execState : Throws the result away, returning only the final state</span>
<span class="org-haskell-definition">execState</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> s a <span class="org-haskell-operator">-&gt;</span> s <span class="org-haskell-operator">-&gt;</span> s
<span class="org-haskell-definition">execState</span> fn s <span class="org-haskell-operator">=</span> snd (runState fn s)


<span class="org-haskell-definition">get</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> s s
<span class="org-haskell-definition">get</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span> (s, s))

<span class="org-haskell-definition">put</span> <span class="org-haskell-operator">::</span> s <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">State</span> s <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">put</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-operator">\</span> <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> (<span class="org-haskell-constructor">()</span>, s))

<span class="org-comment-delimiter">{- </span><span class="org-comment">State Monad Evaluation Functions -}</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">runState : Returns both the result and the final state</span>



<span class="org-comment-delimiter">{- </span><span class="org-comment">State Monad Evaluation Functions -}</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">runState : Returns both the result and the final state</span>



<span class="org-comment-delimiter">{-</span>
<span class="org-comment">   Applies a function to the result of the</span>
<span class="org-comment">   state transformer (state monad) application</span>
<span class="org-comment">   keeping the current state. </span>

<span class="org-comment">-}</span>
<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Functor</span> (<span class="org-haskell-type">State</span> s) <span class="org-haskell-keyword">where</span>

  <span class="org-comment-delimiter">{- </span><span class="org-comment">fmap :: (a -&gt; b) -&gt; F a -&gt; F b -}</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">fmap :: (a -&gt; b) -&gt; State s a -&gt; State s b</span>
  fmap f fns <span class="org-haskell-operator">=</span>
    <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>oldState <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (output, newState) <span class="org-haskell-operator">=</span> runState fns oldState
                         <span class="org-haskell-keyword">in</span> (f output, newState)



<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Applicative</span> (<span class="org-haskell-type">State</span> s) <span class="org-haskell-keyword">where</span>

  pure <span class="org-haskell-operator">=</span> returnState

  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">(&lt;*&gt;) :: State s (a -&gt; b) -&gt; State s a -&gt; State s b</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">fsa :: State s a</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">fn :: State s (a -&gt; b)</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">output :: a </span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">newState :: s</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">f_a_to_b :: a -&gt; b</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">newState' :: s</span>
  <span class="org-comment-delimiter">--</span>
  fn <span class="org-haskell-operator">&lt;*&gt;</span> fsa <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span> oldState <span class="org-haskell-operator">-&gt;</span>
    <span class="org-haskell-keyword">let</span> (output, newState) <span class="org-haskell-operator">=</span> runState fsa oldState <span class="org-haskell-keyword">in</span>
    <span class="org-haskell-keyword">let</span> (f_a_to_b, newState') <span class="org-haskell-operator">=</span> runState fn newState <span class="org-haskell-keyword">in</span>
    (f_a_to_b output, newState')




<span class="org-haskell-keyword">instance</span> <span class="org-haskell-type">Monad</span> (<span class="org-haskell-type">State</span> s) <span class="org-haskell-keyword">where</span>

  <span class="org-comment-delimiter">-- </span><span class="org-comment">return :: a -&gt; State s a </span>
  <span class="org-comment-delimiter">--</span>
  return a <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>s <span class="org-haskell-operator">-&gt;</span>  (a, s)   

  <span class="org-comment-delimiter">-- </span><span class="org-comment">(&gt;&gt;=) :: State s a -&gt; (a -&gt; State s b) -&gt; State s b</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">StateFn    :: State s a</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">stateMaker :: a -&gt; State s b </span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">result     :: a</span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">-- </span><span class="org-comment">newState   :: s </span>
  <span class="org-comment-delimiter">--</span>
  <span class="org-comment-delimiter">--  </span>
  <span class="org-comment-delimiter">--</span>
  stateFn <span class="org-haskell-operator">&gt;&gt;=</span> stateMaker  <span class="org-haskell-operator">=</span>

    <span class="org-haskell-constructor">State</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span>oldState <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">let</span> (result, newState) <span class="org-haskell-operator">=</span> runState stateFn oldState
                         <span class="org-haskell-keyword">in</span>  runState (stateMaker result) newState
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-5-2" class="outline-5">
<h5 id="sec-1-9-5-2"><span class="section-number-5">1.9.5.2</span> Running</h5>
<div class="outline-text-5" id="text-1-9-5-2">
<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load ch14<span class="org-haskell-operator">/</span>State.hs 
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( ch14<span class="org-haskell-operator">/</span>State.hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">+</span>m
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-keyword">let</span> stateFn1 <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">State</span> (<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> (2 <span class="org-haskell-operator">*</span> x, x <span class="org-haskell-operator">+</span> 1)) <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-type">:</span>t stateFn1 
<span class="org-haskell-definition">stateFn1</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 0
(0,1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 1
(2,2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 2
(4,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 3
(6,4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 4
(8,5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn1 5
(10,6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">*</span>2) stateFn1) 0
(0,1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">*</span>2) stateFn1) 1
(4,2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">*</span>2) stateFn1) 2
(8,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">*</span>2) stateFn1) 3
(12,4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">*</span>2) stateFn1) 4
(16,5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (fmap (<span class="org-haskell-operator">*</span>2) stateFn1) 5
(20,6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-comment-delimiter">{- </span><span class="org-comment">stateFn in monadic notation</span>
<span class="org-comment">   This block can be copied in the repl.</span>
<span class="org-comment">-}</span>

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> stateFn2 <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-type">Int</span>
    stateFn2 <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
      sc <span class="org-haskell-operator">&lt;-</span> get
      put (sc <span class="org-haskell-operator">+</span> 1)
      return <span class="org-haskell-operator">$</span> 2 <span class="org-haskell-operator">*</span> sc

<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>t stateFn2
<span class="org-haskell-definition">stateFn2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 0
(0,1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 1
(2,2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 2
(4,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 3
(6,4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 4
(8,5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn2 5
(10,6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">{- </span><span class="org-comment">stateFn3   -}</span>

<span class="org-haskell-constructor">:</span>{
<span class="org-haskell-keyword">let</span> stateFn3 <span class="org-haskell-operator">::</span> <span class="org-haskell-type">State</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-type">Int</span>
    stateFn3 <span class="org-haskell-operator">=</span>
      get          <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span> sc <span class="org-haskell-operator">-&gt;</span>
      put (sc <span class="org-haskell-operator">+</span> 1) <span class="org-haskell-operator">&gt;&gt;=</span> <span class="org-haskell-operator">\</span><span class="org-haskell-keyword">_</span>   <span class="org-haskell-operator">-&gt;</span>
      return (2 <span class="org-haskell-operator">*</span> sc)

<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 0
(0,1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 1
(2,2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 2
(4,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 3
(6,4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 4
(8,5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState stateFn3 5
(10,6)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (replicateM 10 stateFn3) 0
([18,16,14,12,10,8,6,4,2,0],10)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (replicateM 0 stateFn3) 0
(<span class="org-haskell-constructor">[]</span>,0)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (replicateM 1 stateFn3) 0
([0],1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (replicateM 2 stateFn3) 0
([2,0],2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (replicateM 3 stateFn3) 0
([4,2,0],3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (replicateM 4 stateFn3) 0
([6,4,2,0],4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState (replicateM 10 stateFn3) 0
([18,16,14,12,10,8,6,4,2,0],10)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 


<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) <span class="org-haskell-operator">&lt;$&gt;</span>  stateFn3) 0
(3,1)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) <span class="org-haskell-operator">&lt;$&gt;</span>  stateFn3) 1
(5,2)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) <span class="org-haskell-operator">&lt;$&gt;</span>  stateFn3) 2
(7,3)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) <span class="org-haskell-operator">&lt;$&gt;</span>  stateFn3) 3
(9,4)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> runState ((<span class="org-haskell-operator">\</span>x <span class="org-haskell-operator">-&gt;</span> x <span class="org-haskell-operator">+</span> 3) <span class="org-haskell-operator">&lt;$&gt;</span>  stateFn3) 4
(11,5)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> <span class="done FAILED">FAILED</span> Chapter 27 - Sockets and Syslog</h3>
<div class="outline-text-3" id="text-1-10">
</div><div id="outline-container-sec-1-10-1" class="outline-4">
<h4 id="sec-1-10-1"><span class="section-number-4">1.10.1</span> Location</h4>
<div class="outline-text-4" id="text-1-10-1">
<ul class="org-ul">
<li><a href="http://book.realworldhaskell.org/read/sockets-and-syslog.html">Chapter 27. Sockets and Syslog</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-10-2" class="outline-4">
<h4 id="sec-1-10-2"><span class="section-number-4">1.10.2</span> Requirements</h4>
<div class="outline-text-4" id="text-1-10-2">
<ul class="org-ul">
<li><a href="https://hackage.haskell.org/package/network-2.6.2.1">Network Package</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-10-3" class="outline-4">
<h4 id="sec-1-10-3"><a id="ID-5b049d04-463e-46bb-b980-2fefa3c51f95" name="ID-5b049d04-463e-46bb-b980-2fefa3c51f95"></a><span class="section-number-4">1.10.3</span> UDP Syslog Server and Client</h4>
<div class="outline-text-4" id="text-1-10-3">
</div>
<div id="outline-container-sec-1-10-3-1" class="outline-5">
<h5 id="sec-1-10-3-1"><span class="section-number-5">1.10.3.1</span> Code</h5>
<div class="outline-text-5" id="text-1-10-3-1">
</div><ol class="org-ol"><li><a id="sec-1-10-3-1-1" name="sec-1-10-3-1-1"></a><a id="ID-fe703668-ccfe-4b2d-8e58-124673efddcf" name="ID-fe703668-ccfe-4b2d-8e58-124673efddcf"></a>syslogclient.hs<br  /><div class="outline-text-6" id="text-1-10-3-1-1">

<p>
Page 611 - File: <a href="rwh/ch27/syslogclient.hs">rwh/ch27/syslogclient.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch27/syslogclient.hs</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Bits</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.Socket</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.BSD</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">SyslogTypes</span>


<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">SyslogHandle</span> <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-constructor">SyslogHandle</span> {slSocket <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Socket</span>,
                  slProgram <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>,
                  slAddress <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SockAddr</span>}

<span class="org-haskell-definition">openlog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">HostName</span>             <span class="org-doc">-- ^ Remote hostname, or localhost</span>
        <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>               <span class="org-doc">-- ^ Port number or name; 514 is default</span>
        <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>               <span class="org-doc">-- ^ Name to log under</span>
        <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">SyslogHandle</span>      <span class="org-doc">-- ^ Handle to use for logging</span>

<span class="org-haskell-definition">openlog</span> hostname port progname <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Look up the hostname and port.  Either raises an exception</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">or returns a nonempty list.  First element in that list</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">is supposed to be the best option.</span>
       addrinfos <span class="org-haskell-operator">&lt;-</span> getAddrInfo <span class="org-haskell-constructor">Nothing</span> (<span class="org-haskell-constructor">Just</span> hostname) (<span class="org-haskell-constructor">Just</span> port)
       <span class="org-haskell-keyword">let</span> serveraddr <span class="org-haskell-operator">=</span> head addrinfos

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Establish a socket for communication</span>
       sock <span class="org-haskell-operator">&lt;-</span> socket (addrFamily serveraddr) <span class="org-haskell-constructor">Datagram</span> defaultProtocol

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Save off the socket, program name, and server address in a handle</span>
       return <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">SyslogHandle</span> sock progname (addrAddress serveraddr)


<span class="org-haskell-definition">syslog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SyslogHandle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Facility</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Priority</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">syslog</span> syslogh fac pri msg <span class="org-haskell-operator">=</span>
    sendstr sendmsg
    <span class="org-haskell-keyword">where</span> code <span class="org-haskell-operator">=</span> makeCode fac pri
          sendmsg <span class="org-haskell-operator">=</span> <span class="org-string">"&lt;"</span> <span class="org-haskell-operator">++</span> show code <span class="org-haskell-operator">++</span> <span class="org-string">"&gt;"</span> <span class="org-haskell-operator">++</span> (slProgram syslogh) <span class="org-haskell-operator">++</span>
                    <span class="org-string">": "</span> <span class="org-haskell-operator">++</span> msg
          <span class="org-comment-delimiter">-- </span><span class="org-comment">Send until everything is done</span>
          sendstr <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
          sendstr <span class="org-haskell-constructor">[]</span> <span class="org-haskell-operator">=</span> return <span class="org-haskell-constructor">()</span>
          sendstr omsg <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span> sent <span class="org-haskell-operator">&lt;-</span> sendTo (slSocket syslogh) omsg
                                    (slAddress syslogh)
                            sendstr (genericDrop sent omsg)


<span class="org-haskell-definition">closelog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SyslogHandle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">closelog</span> syslogh <span class="org-haskell-operator">=</span> sClose (slSocket syslogh)


<span class="org-doc">{- | Convert a facility and a priority into a syslog code -}</span>
<span class="org-haskell-definition">makeCode</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Facility</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Priority</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-definition">makeCode</span> fac pri <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">let</span> faccode <span class="org-haskell-operator">=</span> codeOfFac fac
        pricode <span class="org-haskell-operator">=</span> fromEnum pri 
        <span class="org-haskell-keyword">in</span>
          (faccode <span class="org-haskell-operator">`shiftL`</span> 3) <span class="org-haskell-operator">.|.</span> pricode
</pre>
</div>
</div>
</li>

<li><a id="sec-1-10-3-1-2" name="sec-1-10-3-1-2"></a><a id="ID-5f003735-f112-4a0d-83f2-5056f15972f8" name="ID-5f003735-f112-4a0d-83f2-5056f15972f8"></a>SystlogTypes.hs<br  /><div class="outline-text-6" id="text-1-10-3-1-2">

<p>
File: <a href="rwh/ch27/SyslogTypes.hs">rwh/ch27/SyslogTypes.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">module</span> <span class="org-haskell-constructor">SyslogTypes</span> <span class="org-haskell-keyword">where</span>
<span class="org-doc">{- | Priorities define how important a log message is. -}</span>

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Priority</span> <span class="org-haskell-operator">=</span> 
            <span class="org-haskell-constructor">DEBUG</span>                   <span class="org-doc">-- ^ Debug messages</span>
          <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">INFO</span>                    <span class="org-doc">-- ^ Information</span>
          <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">NOTICE</span>                  <span class="org-doc">-- ^ Normal runtime conditions</span>
          <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">WARNING</span>                 <span class="org-doc">-- ^ General Warnings</span>
          <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">ERROR</span>                   <span class="org-doc">-- ^ General Errors</span>
          <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">CRITICAL</span>                <span class="org-doc">-- ^ Severe situations</span>
          <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">ALERT</span>                   <span class="org-doc">-- ^ Take immediate action</span>
          <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">EMERGENCY</span>               <span class="org-doc">-- ^ System is unusable</span>
                    <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span>, <span class="org-haskell-constructor">Ord</span>, <span class="org-haskell-constructor">Show</span>, <span class="org-haskell-constructor">Read</span>, <span class="org-haskell-constructor">Enum</span>)

<span class="org-doc">{- | Facilities are used by the system to determine where messages</span>
<span class="org-doc">are sent. -}</span>

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">Facility</span> <span class="org-haskell-operator">=</span> 
              <span class="org-haskell-constructor">KERN</span>                      <span class="org-doc">-- ^ Kernel messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">USER</span>                    <span class="org-doc">-- ^ General userland messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">MAIL</span>                    <span class="org-doc">-- ^ E-Mail system</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">DAEMON</span>                  <span class="org-doc">-- ^ Daemon (server process) messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">AUTH</span>                    <span class="org-doc">-- ^ Authentication or security messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">SYSLOG</span>                  <span class="org-doc">-- ^ Internal syslog messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LPR</span>                     <span class="org-doc">-- ^ Printer messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">NEWS</span>                    <span class="org-doc">-- ^ Usenet news</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">UUCP</span>                    <span class="org-doc">-- ^ UUCP messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">CRON</span>                    <span class="org-doc">-- ^ Cron messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">AUTHPRIV</span>                <span class="org-doc">-- ^ Private authentication messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">FTP</span>                     <span class="org-doc">-- ^ FTP messages</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL0</span>                  
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL1</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL2</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL3</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL4</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL5</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL6</span>
              <span class="org-haskell-operator">|</span> <span class="org-haskell-constructor">LOCAL7</span>
                <span class="org-haskell-keyword">deriving</span> (<span class="org-haskell-constructor">Eq</span>, <span class="org-haskell-constructor">Show</span>, <span class="org-haskell-constructor">Read</span>)

<span class="org-haskell-definition">facToCode</span> <span class="org-haskell-operator">=</span> [ 
                       (<span class="org-haskell-constructor">KERN</span>, 0),
                       (<span class="org-haskell-constructor">USER</span>, 1),
                       (<span class="org-haskell-constructor">MAIL</span>, 2),
                       (<span class="org-haskell-constructor">DAEMON</span>, 3),
                       (<span class="org-haskell-constructor">AUTH</span>, 4),
                       (<span class="org-haskell-constructor">SYSLOG</span>, 5),
                       (<span class="org-haskell-constructor">LPR</span>, 6),
                       (<span class="org-haskell-constructor">NEWS</span>, 7),
                       (<span class="org-haskell-constructor">UUCP</span>, 8),
                       (<span class="org-haskell-constructor">CRON</span>, 9),
                       (<span class="org-haskell-constructor">AUTHPRIV</span>, 10),
                       (<span class="org-haskell-constructor">FTP</span>, 11),
                       (<span class="org-haskell-constructor">LOCAL0</span>, 16),
                       (<span class="org-haskell-constructor">LOCAL1</span>, 17),
                       (<span class="org-haskell-constructor">LOCAL2</span>, 18),
                       (<span class="org-haskell-constructor">LOCAL3</span>, 19),
                       (<span class="org-haskell-constructor">LOCAL4</span>, 20),
                       (<span class="org-haskell-constructor">LOCAL5</span>, 21),
                       (<span class="org-haskell-constructor">LOCAL6</span>, 22),
                       (<span class="org-haskell-constructor">LOCAL7</span>, 23)

           ]


<span class="org-haskell-definition">codeToFac</span> <span class="org-haskell-operator">=</span> map (<span class="org-haskell-operator">\</span>(x, y) <span class="org-haskell-operator">-&gt;</span> (y, x)) facToCode


<span class="org-doc">{- | We can't use enum here because the numbering is discontiguous -}</span>
<span class="org-haskell-definition">codeOfFac</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Facility</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-definition">codeOfFac</span> f <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> lookup f facToCode <span class="org-haskell-keyword">of</span>
                <span class="org-haskell-constructor">Just</span> x <span class="org-haskell-operator">-&gt;</span> x
                <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> error <span class="org-haskell-operator">$</span> <span class="org-string">"Internal error in codeOfFac"</span>

<span class="org-haskell-definition">facOfCode</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Facility</span>
<span class="org-haskell-definition">facOfCode</span> f <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">case</span> lookup f codeToFac <span class="org-haskell-keyword">of</span>
                <span class="org-haskell-constructor">Just</span> x <span class="org-haskell-operator">-&gt;</span> x
                <span class="org-haskell-keyword">_</span> <span class="org-haskell-operator">-&gt;</span> error <span class="org-haskell-operator">$</span> <span class="org-string">"Invalid code in facOfCode"</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-1-10-3-1-3" name="sec-1-10-3-1-3"></a><a id="ID-978d03df-fb09-4e9b-b191-1f049b24aa35" name="ID-978d03df-fb09-4e9b-b191-1f049b24aa35"></a>syslogserver.hs<br  /><div class="outline-text-6" id="text-1-10-3-1-3">

<p>
File: <a href="rwh/ch27/syslogserver.hs">rwh/ch27/syslogserver.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Bits</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.Socket</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.BSD</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span>

<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">HandlerFunc</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">SockAddr</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>

<span class="org-haskell-definition">serveLog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>              <span class="org-doc">-- ^ Port number or name; 514 is default</span>
         <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">HandlerFunc</span>         <span class="org-doc">-- ^ Function to handle incoming messages</span>
         <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>

<span class="org-haskell-definition">serveLog</span> port handlerfunc <span class="org-haskell-operator">=</span> withSocketsDo <span class="org-haskell-operator">$</span>
    <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Look up the port.  Either raises an exception or returns</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">a nonempty list.  </span>
       addrinfos <span class="org-haskell-operator">&lt;-</span> getAddrInfo 
                    (<span class="org-haskell-constructor">Just</span> (defaultHints {addrFlags <span class="org-haskell-operator">=</span> [<span class="org-haskell-constructor">AI_PASSIVE</span>]}))
                    <span class="org-haskell-constructor">Nothing</span> (<span class="org-haskell-constructor">Just</span> port)
       <span class="org-haskell-keyword">let</span> serveraddr <span class="org-haskell-operator">=</span> head addrinfos
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Create a socket</span>
       sock <span class="org-haskell-operator">&lt;-</span> socket (addrFamily serveraddr) <span class="org-haskell-constructor">Datagram</span> defaultProtocol
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Bind it to the address we're listening to</span>
       bindSocket sock (addrAddress serveraddr)
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Loop forever processing incoming data.  Ctrl-C to abort.</span>
       procMessages sock
    <span class="org-haskell-keyword">where</span> procMessages sock <span class="org-haskell-operator">=</span>
              <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Receive one UDP packet, maximum length 1024 bytes,</span>
                 <span class="org-comment-delimiter">-- </span><span class="org-comment">and save its content into msg and its source</span>
                 <span class="org-comment-delimiter">-- </span><span class="org-comment">IP and port into addr</span>
                 (msg, <span class="org-haskell-keyword">_</span>, addr) <span class="org-haskell-operator">&lt;-</span> recvFrom sock 1024
                 <span class="org-comment-delimiter">-- </span><span class="org-comment">Handle it</span>
                 handlerfunc addr msg
                 <span class="org-comment-delimiter">-- </span><span class="org-comment">And process more messages</span>
                 procMessages sock

<span class="org-comment-delimiter">-- </span><span class="org-comment">A simple handler that prints incoming packets</span>
<span class="org-haskell-definition">plainHandler</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">HandlerFunc</span>
<span class="org-haskell-definition">plainHandler</span> addr msg <span class="org-haskell-operator">=</span> 
    putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"From "</span> <span class="org-haskell-operator">++</span> show addr <span class="org-haskell-operator">++</span> <span class="org-string">": "</span> <span class="org-haskell-operator">++</span> msg
</pre>
</div>
</div>
</li></ol>
</div>

<div id="outline-container-sec-1-10-3-2" class="outline-5">
<h5 id="sec-1-10-3-2"><span class="section-number-5">1.10.3.2</span> Running:</h5>
<div class="outline-text-5" id="text-1-10-3-2">
<p>
This app loaded in GHCI without any errors, however it didn't work the
server printed nothing. It was tested in GHC/GHCI Version 7.10.2, Arch
Linux 64 bits, Linux version 4.4.3-1-ARCH.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-10-4" class="outline-4">
<h4 id="sec-1-10-4"><a id="ID-9a184320-586d-4bd4-84b5-5f65c06b801a" name="ID-9a184320-586d-4bd4-84b5-5f65c06b801a"></a><span class="section-number-4">1.10.4</span> TCP Syslog Server and Client</h4>
<div class="outline-text-4" id="text-1-10-4">
</div>
<div id="outline-container-sec-1-10-4-1" class="outline-5">
<h5 id="sec-1-10-4-1"><span class="section-number-5">1.10.4.1</span> Code</h5>
<div class="outline-text-5" id="text-1-10-4-1">
</div><ol class="org-ol"><li><a id="sec-1-10-4-1-1" name="sec-1-10-4-1-1"></a><a id="ID-ea0bc382-3629-421b-9041-2f4c0eab5843" name="ID-ea0bc382-3629-421b-9041-2f4c0eab5843"></a>syslogtcpserver.hs<br  /><div class="outline-text-6" id="text-1-10-4-1-1">

<p>
Page 617 - File: <a href="rwh/ch27/syslogtcpserver.hs">rwh/ch27/syslogtcpserver.hs</a> 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Bits</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.Socket</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.BSD</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Concurrent</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Concurrent.MVar</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.IO</span>


<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">HandlerFunc</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">SockAddr</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>

<span class="org-haskell-definition">serveLog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>              <span class="org-doc">-- ^ Port number or name; 514 is default</span>
         <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">HandlerFunc</span>         <span class="org-doc">-- ^ Function to handle incoming messages</span>
         <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">serveLog</span> port handlerfunc <span class="org-haskell-operator">=</span> withSocketsDo <span class="org-haskell-operator">$</span>
    <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Look up the port.  Either raises an exception or returns</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">a nonempty list.  </span>
       addrinfos <span class="org-haskell-operator">&lt;-</span> getAddrInfo 
                    (<span class="org-haskell-constructor">Just</span> (defaultHints {addrFlags <span class="org-haskell-operator">=</span> [<span class="org-haskell-constructor">AI_PASSIVE</span>]}))
                    <span class="org-haskell-constructor">Nothing</span> (<span class="org-haskell-constructor">Just</span> port)
       <span class="org-haskell-keyword">let</span> serveraddr <span class="org-haskell-operator">=</span> head addrinfos
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Create a socket</span>
       sock <span class="org-haskell-operator">&lt;-</span> socket (addrFamily serveraddr) <span class="org-haskell-constructor">Stream</span> defaultProtocol
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Bind it to the address we're listening to</span>
       bindSocket sock (addrAddress serveraddr)
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Start listening for connection requests.  Maximum queue size</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">of 5 connection requests waiting to be accepted.</span>
       listen sock 5
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Create a lock to use for synchronizing access to the handler</span>
       lock <span class="org-haskell-operator">&lt;-</span> newMVar <span class="org-haskell-constructor">()</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Loop forever waiting for connections.  Ctrl-C to abort.</span>
       procRequests lock sock
    <span class="org-haskell-keyword">where</span>
          <span class="org-doc">-- | Process incoming connection requests</span>
          procRequests <span class="org-haskell-operator">::</span> <span class="org-haskell-type">MVar</span> <span class="org-haskell-constructor">()</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Socket</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
          procRequests lock mastersock <span class="org-haskell-operator">=</span> 
              <span class="org-haskell-keyword">do</span> (connsock, clientaddr) <span class="org-haskell-operator">&lt;-</span> accept mastersock
                 handle lock clientaddr
                    <span class="org-string">"syslogtcpserver.hs: client connnected"</span>
                 forkIO <span class="org-haskell-operator">$</span> procMessages lock connsock clientaddr
                 procRequests lock mastersock

          <span class="org-doc">-- | Process incoming messages</span>
          procMessages <span class="org-haskell-operator">::</span> <span class="org-haskell-type">MVar</span> <span class="org-haskell-constructor">()</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Socket</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">SockAddr</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
          procMessages lock connsock clientaddr <span class="org-haskell-operator">=</span>
              <span class="org-haskell-keyword">do</span> connhdl <span class="org-haskell-operator">&lt;-</span> socketToHandle connsock <span class="org-haskell-constructor">ReadMode</span>
                 hSetBuffering connhdl <span class="org-haskell-constructor">LineBuffering</span>
                 messages <span class="org-haskell-operator">&lt;-</span> hGetContents connhdl
                 mapM_ (handle lock clientaddr) (lines messages)
                 hClose connhdl
                 handle lock clientaddr 
                    <span class="org-string">"syslogtcpserver.hs: client disconnected"</span>
          <span class="org-comment-delimiter">-- </span><span class="org-comment">Lock the handler before passing data to it.</span>
          handle <span class="org-haskell-operator">::</span> <span class="org-haskell-type">MVar</span> <span class="org-haskell-constructor">()</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">HandlerFunc</span>
          <span class="org-comment-delimiter">-- </span><span class="org-comment">This type is the same as</span>
          <span class="org-comment-delimiter">-- </span><span class="org-comment">handle :: MVar () -&gt; SockAddr -&gt; String -&gt; IO ()</span>
          handle lock clientaddr msg <span class="org-haskell-operator">=</span>
              withMVar lock 
                 (<span class="org-haskell-operator">\</span>a <span class="org-haskell-operator">-&gt;</span> handlerfunc clientaddr msg <span class="org-haskell-operator">&gt;&gt;</span> return a)

<span class="org-comment-delimiter">-- </span><span class="org-comment">A simple handler that prints incoming packets</span>
<span class="org-haskell-definition">plainHandler</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">HandlerFunc</span>
<span class="org-haskell-definition">plainHandler</span> addr msg <span class="org-haskell-operator">=</span> 
    putStrLn <span class="org-haskell-operator">$</span> <span class="org-string">"From "</span> <span class="org-haskell-operator">++</span> show addr <span class="org-haskell-operator">++</span> <span class="org-string">": "</span> <span class="org-haskell-operator">++</span> msg
</pre>
</div>


<p>
File: <a href="rwh/ch27/syslogtcpserver.hs">rwh/ch27/syslogtcpserver.hs</a> 
</p>
</div>
</li>

<li><a id="sec-1-10-4-1-2" name="sec-1-10-4-1-2"></a><a id="ID-142c7b93-72b0-413b-b6f6-7ac793951794" name="ID-142c7b93-72b0-413b-b6f6-7ac793951794"></a>sylogtcpclient.hs<br  /><div class="outline-text-6" id="text-1-10-4-1-2">

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">file: ch27/syslogtcpclient.hs</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.Bits</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.Socket</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Network.BSD</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Data.List</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">SyslogTypes</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">System.IO</span>

<span class="org-haskell-keyword">data</span> <span class="org-haskell-type">SyslogHandle</span> <span class="org-haskell-operator">=</span> 
    <span class="org-haskell-constructor">SyslogHandle</span> {slHandle <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Handle</span>,
                  slProgram <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>}

<span class="org-haskell-definition">openlog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">HostName</span>             <span class="org-doc">-- ^ Remote hostname, or localhost</span>
        <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>               <span class="org-doc">-- ^ Port number or name; 514 is default</span>
        <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>               <span class="org-doc">-- ^ Name to log under</span>
        <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">SyslogHandle</span>      <span class="org-doc">-- ^ Handle to use for logging</span>

<span class="org-haskell-definition">openlog</span> hostname port progname <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">do</span> <span class="org-comment-delimiter">-- </span><span class="org-comment">Look up the hostname and port.  Either raises an exception</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">or returns a nonempty list.  First element in that list</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">is supposed to be the best option.</span>
       addrinfos <span class="org-haskell-operator">&lt;-</span> getAddrInfo <span class="org-haskell-constructor">Nothing</span> (<span class="org-haskell-constructor">Just</span> hostname) (<span class="org-haskell-constructor">Just</span> port)
       <span class="org-haskell-keyword">let</span> serveraddr <span class="org-haskell-operator">=</span> head addrinfos

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Establish a socket for communication</span>
       sock <span class="org-haskell-operator">&lt;-</span> socket (addrFamily serveraddr) <span class="org-haskell-constructor">Stream</span> defaultProtocol

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Mark the socket for keep-alive handling since it may be idle</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">for long periods of time</span>
       setSocketOption sock <span class="org-haskell-constructor">KeepAlive</span> 1

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Connect to server</span>
       connect sock (addrAddress serveraddr)

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Make a Handle out of it for convenience</span>
       h <span class="org-haskell-operator">&lt;-</span> socketToHandle sock <span class="org-haskell-constructor">WriteMode</span>

       <span class="org-comment-delimiter">-- </span><span class="org-comment">We're going to set buffering to BlockBuffering and then</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">explicitly call hFlush after each message, below, so that</span>
       <span class="org-comment-delimiter">-- </span><span class="org-comment">messages get logged immediately</span>
       hSetBuffering h (<span class="org-haskell-constructor">BlockBuffering</span> <span class="org-haskell-constructor">Nothing</span>)

       <span class="org-comment-delimiter">-- </span><span class="org-comment">Save off the socket, program name, and server address in a handle</span>
       return <span class="org-haskell-operator">$</span> <span class="org-haskell-constructor">SyslogHandle</span> h progname



<span class="org-haskell-definition">syslog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SyslogHandle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Facility</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Priority</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">syslog</span> syslogh fac pri msg <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">do</span> hPutStrLn (slHandle syslogh) sendmsg
       <span class="org-comment-delimiter">-- </span><span class="org-comment">Make sure that we send data immediately</span>
       hFlush (slHandle syslogh)
    <span class="org-haskell-keyword">where</span> code <span class="org-haskell-operator">=</span> makeCode fac pri
          sendmsg <span class="org-haskell-operator">=</span> <span class="org-string">"&lt;"</span> <span class="org-haskell-operator">++</span> show code <span class="org-haskell-operator">++</span> <span class="org-string">"&gt;"</span> <span class="org-haskell-operator">++</span> (slProgram syslogh) <span class="org-haskell-operator">++</span>
                    <span class="org-string">": "</span> <span class="org-haskell-operator">++</span> msg

<span class="org-haskell-definition">closelog</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SyslogHandle</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">closelog</span> syslogh <span class="org-haskell-operator">=</span> hClose (slHandle syslogh)

<span class="org-doc">{- | Convert a facility and a priority into a syslog code -}</span>
<span class="org-haskell-definition">makeCode</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Facility</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Priority</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-definition">makeCode</span> fac pri <span class="org-haskell-operator">=</span>
    <span class="org-haskell-keyword">let</span> faccode <span class="org-haskell-operator">=</span> codeOfFac fac
        pricode <span class="org-haskell-operator">=</span> fromEnum pri 
        <span class="org-haskell-keyword">in</span>
          (faccode <span class="org-haskell-operator">`shiftL`</span> 3) <span class="org-haskell-operator">.|.</span> pricode
</pre>
</div>
</div>
</li></ol>
</div>

<div id="outline-container-sec-1-10-4-2" class="outline-5">
<h5 id="sec-1-10-4-2"><span class="section-number-5">1.10.4.2</span> Running</h5>
<div class="outline-text-5" id="text-1-10-4-2">
<p>
Running: syslogtcpserver with telnet as client:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"syslogtcpserver.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( syslogtcpserver<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-comment-delimiter">--  </span><span class="org-comment">Open another terminal window </span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">and enter: </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">$ telnet localhost 10514 </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--  </span><span class="org-comment">and type the log messages. </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;&gt;&gt;</span> serveLog <span class="org-string">"10514"</span> plainHandler
<span class="org-haskell-constructor">From</span> 127.0<span class="org-haskell-operator">.</span>0.1<span class="org-haskell-constructor">:</span>49570<span class="org-haskell-constructor">:</span> syslogtcpserver<span class="org-haskell-operator">.</span>hs<span class="org-haskell-constructor">:</span> client connnected
<span class="org-haskell-constructor">From</span> 127.0<span class="org-haskell-operator">.</span>0.1<span class="org-haskell-constructor">:</span>49570<span class="org-haskell-constructor">:</span> <span class="org-haskell-constructor">Test</span> message <span class="org-haskell-operator">-</span> <span class="org-haskell-constructor">Fatal</span> kernel error
<span class="org-haskell-constructor">From</span> 127.0<span class="org-haskell-operator">.</span>0.1<span class="org-haskell-constructor">:</span>49570<span class="org-haskell-constructor">:</span> <span class="org-haskell-constructor">Application</span> server running OK.
</pre>
</div>


<p>
Running: syslogtcpserver with syslogclient:
</p>

<p>
syslogserver:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load <span class="org-string">"syslogtcpserver.hs"</span>
[1 <span class="org-haskell-keyword">of</span> 1] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( syslogtcpserver<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> serveLog <span class="org-string">"10514"</span> plainHandler
</pre>
</div>

<p>
syslogclient:
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;&gt;&gt;</span> 
<span class="org-haskell-operator">&gt;&gt;&gt;</span> <span class="org-haskell-constructor">:</span>load sylogtcpclient<span class="org-haskell-operator">.</span>hs 
[1 <span class="org-haskell-keyword">of</span> 2] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">SyslogTypes</span>      ( SyslogTypes.hs, interpreted )
[2 <span class="org-haskell-keyword">of</span> 2] <span class="org-haskell-constructor">Compiling</span> <span class="org-haskell-constructor">Main</span>             ( sylogtcpclient<span class="org-haskell-operator">.</span>hs, interpreted )
<span class="org-haskell-constructor">Ok</span>, modules loaded<span class="org-haskell-constructor">:</span> <span class="org-haskell-constructor">SyslogTypes</span>, Main.
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> openlog <span class="org-string">"localhost"</span> <span class="org-string">"10514"</span> <span class="org-string">"tcptest"</span>
 <span class="org-haskell-operator">***</span> <span class="org-haskell-constructor">Exception:</span> connect<span class="org-haskell-constructor">:</span> does not exist (<span class="org-haskell-constructor">Connection</span> refused)
<span class="org-haskell-operator">&gt;&gt;&gt;</span> 

<span class="org-haskell-operator">&gt;&gt;&gt;</span> sl <span class="org-haskell-operator">&lt;-</span> openlog <span class="org-string">"localhost"</span> <span class="org-string">"1514"</span> <span class="org-string">"tcptest"</span>
 <span class="org-haskell-operator">***</span> <span class="org-haskell-constructor">Exception:</span> connect<span class="org-haskell-constructor">:</span> does not exist (<span class="org-haskell-constructor">Connection</span> refused)
<span class="org-haskell-operator">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Caio Rodrigues</p>
<p class="date">Created: 2017-03-12 dom 16:47</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.1.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>