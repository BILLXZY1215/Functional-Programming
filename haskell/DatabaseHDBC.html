<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Databases in Haskell - HDBC</title>
<!-- 2018-05-07 Mon 10:11 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="nobody" />
<meta  name="description" content="Databases in Haskell, database drivers"
 />
<meta  name="keywords" content="haskell, database, drivers, hdbc, sqlite, postgres" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
<link href="/Functional-Programming/theme/style.css" rel="stylesheet">
<script src="/Functional-Programming/theme/org-nav-theme.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Databases in Haskell - HDBC</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Databases - HDBC</a>
<ul>
<li><a href="#sec-1-1">1.1. Overview</a></li>
<li><a href="#sec-1-2">1.2. Install the Database Drivers</a></li>
<li><a href="#sec-1-3">1.3. Examples</a>
<ul>
<li><a href="#sec-1-3-1">1.3.1. Example - Simple Database Query</a></li>
<li><a href="#sec-1-3-2">1.3.2. Example - Datbase query with ReaderT monad transformer.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<lu> 
  <li><a href="/Functional-Programming/index.html">Index</a></li>
  <li><a href="https://github.com/caiorss/Functional-Programming">Repository</a></li>
</lu>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Databases - HDBC</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Overview</h3>
<div class="outline-text-3" id="text-1-1">
<p>
HDBC is a library that provides a common abstraction or interface to
different database engines like sqlite, mysql and postgres. The
communication to each database engine is handled by the database
driver.
</p>

<p>
<b>Documentation:</b>
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">Haskell Database Connectivity library</td>
<td class="left"><a href="https://hackage.haskell.org/package/HDBC-2.4.0.1/docs/Database-HDBC.html">Database.HDBC</a></td>
</tr>

<tr>
<td class="left">Sqlite Driver</td>
<td class="left"><a href="https://hackage.haskell.org/package/HDBC-sqlite3">HDBC-sqlite3: Sqlite v3 driver for HDBC</a></td>
</tr>

<tr>
<td class="left">Postgresql Driver</td>
<td class="left"><a href="https://hackage.haskell.org/package/HDBC-postgresql-2.3.2.4/docs/Database-HDBC-PostgreSQL.html">Database.HDBC.PostgreSQL</a></td>
</tr>

<tr>
<td class="left">MySQL Driver</td>
<td class="left"><a href="https://hackage.haskell.org/package/HDBC-mysql">HDBC-mysql: MySQL driver for HDBC</a></td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>


<p>
<b>Getting a database to play</b>
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Download sample database dump </span>
$ curl -L -o <span class="org-keyword">zotero.sql</span> https://github.com/caiorss/zhserver/raw/master/database/zotero-test.sql

$ du -h zotero.sql 
3,0M    zotero.sql
3,0M    total

$ file zotero.sql 
<span class="org-function-name">zotero.sql</span>: UTF-8 Unicode text, with very long lines, with LF, NEL line terminators

<span class="org-comment-delimiter"># </span><span class="org-comment">Make the database </span>
$ cat zotero.sql | sqlite3 zotero.sqlite

<span class="org-comment-delimiter"># </span><span class="org-comment">Check the file type </span>
$ file zotero.sqlite 
<span class="org-function-name">zotero.sqlite</span>: SQLite 3.x database, last written using SQLite version 3016002

sqlite&gt; 
sqlite&gt; .tables
annotations                itemNotes                
baseFieldMappings          itemSeeAlso              
baseFieldMappingsCombined  itemTags                 
charsets                   itemTypeCreatorTypes     
collectionItems            itemTypeFields           
collections                itemTypeFieldsCombined   
creatorData                itemTypes                
creatorTypes               itemTypesCombined        
creators                   items                    
customBaseFieldMappings    libraries                
customFields               proxies                  
customItemTypeFields       proxyHosts               
customItemTypes            relations            
   ... ... ... ... ...


sqlite&gt; .headers on
sqlite&gt; .mode column


sqlite&gt; SELECT * FROM tags LIMIT 10 ;
tagID       name        type        dateAdded            dateModified         clientDateModified   libraryID   key       
----------  ----------  ----------  -------------------  -------------------  -------------------  ----------  ----------
2           fp          0           2016-11-07 22:03:05  2017-02-08 20:10:06  2017-02-08 20:10:06              TCG4NFU2  
3           fsharp      0           2016-11-07 22:03:09  2016-11-07 22:03:23  2016-11-07 22:03:23              ZWMIIEA9  
4           doc         0           2016-11-07 22:03:11  2016-11-07 22:03:29  2016-11-07 22:03:29              B4SGSEZR  
5           overview    0           2016-11-07 22:03:25  2016-11-07 22:03:25  2016-11-07 22:03:25              DP9WBHZJ  
6           haskell     0           2016-11-07 22:03:44  2017-02-08 20:10:31  2017-02-08 20:10:31              FSZTVA3J  
7           tutorial    0           2016-11-07 22:03:47  2016-11-07 22:03:47  2016-11-07 22:03:47              Z2KJVEKI  
8           quickref    0           2016-11-07 22:06:24  2016-11-07 22:07:34  2016-11-07 22:07:34              P67M4AB5  
9           linux       0           2016-11-07 22:06:26  2016-11-07 22:07:30  2016-11-07 22:07:30              JQR7943E  
10          c++         0           2016-11-07 22:15:22  2017-02-08 20:09:44  2017-02-08 20:09:44              VG2ZRGWM  
11          numerical   0           2016-11-07 22:20:56  2016-11-07 22:24:03  2016-11-07 22:24:03              P859CH9I  
sqlite&gt; 


sqlite&gt; SELECT * FROM collections LIMIT 10 ;
collectionID  collectionName  parentCollectionID  dateAdded            dateModified         clientDateModified   libraryID   key       
------------  --------------  ------------------  -------------------  -------------------  -------------------  ----------  ----------
2             Haskell                             2016-11-07 21:50:38  2016-11-07 23:13:55  2016-11-07 23:13:55              PMHEFIBA  
3             Haskell doc     2                   2016-11-07 21:50:57  2016-11-07 21:51:18  2016-11-07 21:51:18              CCCGVG4V  
5             Haskell Tutori  2                   2016-11-07 21:53:30  2016-11-07 21:54:32  2016-11-07 21:54:32              FRE2DHFB  
6             Fsharp                              2016-11-07 21:59:56  2016-11-07 22:01:43  2016-11-07 22:01:43              BICWZD7P  
7             Linux                               2016-11-07 22:05:05  2016-11-07 22:07:05  2016-11-07 22:07:05              TIWU5EPF  
8             C++/CPP                             2016-11-07 22:11:57  2016-11-07 22:42:28  2016-11-07 22:42:28              42H6QC5D  
sqlite&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Install the Database Drivers</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Go outside a project </span>
$ cd ~

<span class="org-comment-delimiter"># </span><span class="org-comment">Install database drivers </span>
$ stack install HDBC
$ stack install HDBC-sqlite3
$ stack install HDBC-postgresql

<span class="org-comment-delimiter"># </span><span class="org-comment">Run Haskell REPL</span>
$ stack ghci
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Examples</h3>
<div class="outline-text-3" id="text-1-3">
</div><div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> Example - Simple Database Query</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
Connect to sqlite3 database 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Database.HDBC</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Database.HDBC.Sqlite3</span> 

<span class="org-haskell-operator">&gt;</span> conn <span class="org-haskell-operator">&lt;-</span> connectSqlite3 <span class="org-string">"zotero.sqlite"</span> 
<span class="org-function-name">conn</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Connection</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
Database Metadata
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-comment-delimiter">-- </span><span class="org-comment">Driver name</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">hdbcDriverName</span> conn
<span class="org-string">"sqlite3"</span>
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-type">:</span>t hdbcDriverName conn
<span class="org-haskell-definition">hdbcDriverName</span> conn <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">Version of database server</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">dbServerVer</span> conn
<span class="org-string">"3.14.1"</span>
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-type">:</span>t dbServerVer conn
<span class="org-haskell-definition">dbServerVer</span> conn <span class="org-haskell-operator">::</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>

<p>
Tables metadata 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t getTables 
<span class="org-function-name">getTables</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> [<span class="org-haskell-type">String</span>]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">getTables</span> conn 
[<span class="org-string">"annotations"</span>,<span class="org-string">"baseFieldMappings"</span>,<span class="org-string">"baseFieldMappingsCombined"</span>,<span class="org-string">"charsets"</span>, <span class="org-haskell-operator">...</span>]


<span class="org-comment-delimiter">-- </span><span class="org-comment">Print all tables available </span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">getTables</span> conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ putStrLn 
annotations
baseFieldMappings
baseFieldMappingsCombined
charsets
collectionItems
collections
creatorData
creatorTypes
creators
customBaseFieldMappings
customFields
customItemTypeFields
customItemTypes
deletedItems
fieldFormats
fields
fieldsCombined
fileTypeMimeType
<span class="org-haskell-operator">...</span>
tags
transactionLog
transactionSets
transactions
translatorCache
users
version
zoteroDummyTable


<span class="org-comment-delimiter">-- </span><span class="org-comment">Show specific table metadata  </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">describeTable</span> conn <span class="org-string">"tags"</span>
[(<span class="org-string">"tagID"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlIntegerT</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>,
<span class="org-haskell-definition">colOctetLength</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})<span class="org-haskell-operator">...</span>]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">describeTable</span> conn <span class="org-string">"tags"</span> <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print

(<span class="org-string">"tagID"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlIntegerT</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
(<span class="org-string">"name"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlVarCharT</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
(<span class="org-string">"type"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlIntegerT</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
(<span class="org-string">"dateAdded"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlUnknownT</span> <span class="org-string">"timestamp"</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
(<span class="org-string">"dateModified"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlUnknownT</span> <span class="org-string">"timestamp"</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
(<span class="org-string">"clientDateModified"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlUnknownT</span> <span class="org-string">"timestamp"</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
(<span class="org-string">"libraryID"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlIntegerT</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
(<span class="org-string">"key"</span>,<span class="org-haskell-constructor">SqlColDesc</span> {colType <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">SqlVarCharT</span>, colSize <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colOctetLength <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colDecDigits <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>, colNullable <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">Nothing</span>})
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>



<p>
Quick query 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t quickQuery
<span class="org-haskell-definition">quickQuery</span>
  <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span>
     conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-type">SqlValue</span>] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> [[<span class="org-haskell-type">SqlValue</span>]]
<span class="org-haskell-operator">&gt;</span>


<span class="org-comment-delimiter">-- </span><span class="org-comment">Output: formatted manually in order to fit in the screen. </span>
<span class="org-comment-delimiter">--</span>
<span class="org-comment-delimiter">--</span>
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">quickQuery</span> conn <span class="org-string">"SELECT tagID, name FROM tags WHERE tagID &gt; 80 LIMIT 15"</span> <span class="org-haskell-constructor">[]</span>

[[<span class="org-haskell-constructor">SqlInt64</span> 81,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"excel"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 82,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"spreadsheet"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 83,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"vba"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 84,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"code"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 85,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"thermodynamics"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 86,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"mechanical"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 87,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"energy"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 88,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"catalog"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 89,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"parts"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 90,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"MVC"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 91,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"hydraulics"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 92,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"manufacturer"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 93,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"design"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 94,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"manual"</span>],
 [<span class="org-haskell-constructor">SqlInt64</span> 95,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"cable"</span>]]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [[<span class="org-haskell-type">SqlValue</span>]]


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">quickQuery</span> conn <span class="org-string">"SELECT tagID, name FROM tags WHERE tagID &gt; 80 LIMIT 15"</span> <span class="org-haskell-constructor">[]</span> <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
[<span class="org-haskell-constructor">SqlInt64</span> 81,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"excel"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 82,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"spreadsheet"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 83,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"vba"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 84,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"code"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 85,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"thermodynamics"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 86,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"mechanical"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 87,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"energy"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 88,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"catalog"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 89,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"parts"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 90,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"MVC"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 91,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"hydraulics"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 92,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"manufacturer"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 93,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"design"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 94,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"manual"</span>]
[<span class="org-haskell-constructor">SqlInt64</span> 95,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"cable"</span>]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>


<p>
Query
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">let</span> query <span class="org-haskell-operator">=</span> unlines <span class="org-haskell-operator">$</span> [
      <span class="org-string">"SELECT fieldName, value FROM itemDataValues, itemData, fields WHERE"</span>, 
      <span class="org-string">"itemDataValues.valueID = itemData.valueID"</span>, 
      <span class="org-string">"and itemData.itemID = 5805"</span>,
      <span class="org-string">"and fields.fieldID = itemData.fieldID"</span>
      ]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">putStrLn</span> query 
<span class="org-haskell-constructor">SELECT</span> fieldName, value <span class="org-haskell-constructor">FROM</span> itemDataValues, itemData, fields <span class="org-haskell-constructor">WHERE</span>
itemDataValues<span class="org-haskell-definition">.</span>valueID <span class="org-haskell-operator">=</span> itemData<span class="org-haskell-operator">.</span>valueID
<span class="org-haskell-definition">and</span> itemData<span class="org-haskell-operator">.</span>itemID <span class="org-haskell-operator">=</span> 5805
<span class="org-haskell-definition">and</span> fields<span class="org-haskell-operator">.</span>fieldID <span class="org-haskell-operator">=</span> itemData<span class="org-haskell-operator">.</span>fieldID

<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-type">:</span>t prepare 
<span class="org-function-name">prepare</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Statement</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> stmt <span class="org-haskell-operator">&lt;-</span> prepare conn query 
<span class="org-function-name">stmt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Statement</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-type">:</span>t stmt 
<span class="org-function-name">stmt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Statement</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-type">:</span>t execute
<span class="org-function-name">execute</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Statement</span> <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-type">SqlValue</span>] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-type">Integer</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> nrows <span class="org-haskell-operator">&lt;-</span> execute stmt <span class="org-haskell-constructor">[]</span>
<span class="org-function-name">nrows</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Integer</span>
<span class="org-haskell-operator">&gt;</span> nrows
0
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">getColumnNames</span> stmt
[<span class="org-string">"fieldName"</span>,<span class="org-string">"value"</span>]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">String</span>]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">========= fetchAllRows =============== -</span>


<span class="org-haskell-operator">&gt;</span> rows <span class="org-haskell-operator">&lt;-</span> fetchAllRows stmt <span class="org-comment-delimiter">-- </span><span class="org-comment">Output changed to fit on the screen.</span>
<span class="org-function-name">rows</span> <span class="org-haskell-operator">::</span> [[<span class="org-haskell-type">SqlValue</span>]]
<span class="org-haskell-operator">&gt;</span> rows
[[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"url"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"http://www.eliza.ch/doc/wadler92essence_of_FP.pdf"</span>]
  ,[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"place"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"Albuquerque, NM, USA"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"publisher"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"ACM"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"pages"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1-14"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"date"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1992-00-00 1992"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"DOI"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"10.1145/143165.143169"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"accessDate"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"2016-04-04 20:05:57"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"language"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"en"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"title"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"The essence of functional programming"</span>],
   [<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"proceedingsTitle"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"POPL '92 Proceedings of the 19th ACM SIGPLAN-SIGACT symposium on Principles of programming languages"</span>]]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [[<span class="org-haskell-type">SqlValue</span>]]

<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">mapM_</span> print rows
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"url"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"http://www.eliza.ch/doc/wadler92essence_of_FP.pdf"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"place"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"Albuquerque, NM, USA"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"publisher"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"ACM"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"pages"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1-14"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"date"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1992-00-00 1992"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"DOI"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"10.1145/143165.143169"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"accessDate"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"2016-04-04 20:05:57"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"language"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"en"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"title"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"The essence of functional programming"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"proceedingsTitle"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"POPL '92 Proceedings of the 19th ACM SIGPLAN-SIGACT symposium on Principles of programming languages"</span>]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> sqlRowToString <span class="org-haskell-operator">=</span> map (fromSql <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SqlValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>)
<span class="org-haskell-operator">-</span> 
<span class="org-function-name">sqlRowToString</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">SqlValue</span>] <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-type">String</span>]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">mapM_</span> print <span class="org-haskell-operator">$</span> map sqlRowToString rows 
[<span class="org-string">"url"</span>,<span class="org-string">"http://www.eliza.ch/doc/wadler92essence_of_FP.pdf"</span>]
[<span class="org-string">"place"</span>,<span class="org-string">"Albuquerque, NM, USA"</span>]
[<span class="org-string">"publisher"</span>,<span class="org-string">"ACM"</span>]
[<span class="org-string">"pages"</span>,<span class="org-string">"1-14"</span>]
[<span class="org-string">"date"</span>,<span class="org-string">"1992-00-00 1992"</span>]
[<span class="org-string">"DOI"</span>,<span class="org-string">"10.1145/143165.143169"</span>]
[<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-04-04 20:05:57"</span>]
[<span class="org-string">"language"</span>,<span class="org-string">"en"</span>]
[<span class="org-string">"title"</span>,<span class="org-string">"The essence of functional programming"</span>]
[<span class="org-string">"proceedingsTitle"</span>,<span class="org-string">"POPL '92 Proceedings of the 19th ACM SIGPLAN-SIGACT symposium on Principles of programming languages"</span>]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-keyword">let</span> sqlRowToLine row <span class="org-haskell-operator">=</span> unwords <span class="org-haskell-operator">$</span> map (fromSql <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SqlValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>) row
<span class="org-haskell-operator">-</span> 
<span class="org-function-name">sqlRowToLine</span> <span class="org-haskell-operator">::</span> [<span class="org-haskell-type">SqlValue</span>] <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-operator">&gt;</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">mapM_</span> putStrLn <span class="org-haskell-operator">$</span> map sqlRowToLine rows 
<span class="org-haskell-definition">url</span> http<span class="org-haskell-constructor">://</span>www<span class="org-haskell-operator">.</span>eliza<span class="org-haskell-operator">.</span>ch<span class="org-haskell-operator">/</span>doc<span class="org-haskell-operator">/</span>wadler92essence_of_FP<span class="org-haskell-operator">.</span>pdf
<span class="org-haskell-definition">place</span> <span class="org-haskell-constructor">Albuquerque</span>, <span class="org-haskell-constructor">NM</span>, <span class="org-haskell-constructor">USA</span>
<span class="org-haskell-definition">publisher</span> <span class="org-haskell-constructor">ACM</span>
<span class="org-haskell-definition">pages</span> 1<span class="org-haskell-operator">-</span>14
<span class="org-haskell-definition">date</span> 1992<span class="org-haskell-operator">-</span>00<span class="org-haskell-operator">-</span>00 1992
<span class="org-haskell-constructor">DOI</span> 10.1145<span class="org-haskell-operator">/</span>143165.143169
<span class="org-haskell-definition">accessDate</span> 2016<span class="org-haskell-operator">-</span>04<span class="org-haskell-operator">-</span>04 20<span class="org-haskell-constructor">:</span>05<span class="org-haskell-constructor">:</span>57
<span class="org-haskell-definition">language</span> en
<span class="org-haskell-definition">title</span> <span class="org-haskell-constructor">The</span> essence <span class="org-haskell-keyword">of</span> functional programming
<span class="org-haskell-definition">proceedingsTitle</span> <span class="org-haskell-constructor">POPL</span> '92 <span class="org-haskell-constructor">Proceedings</span> <span class="org-haskell-keyword">of</span> the 19th <span class="org-haskell-constructor">ACM</span> <span class="org-haskell-constructor">SIGPLAN</span><span class="org-haskell-operator">-</span><span class="org-haskell-constructor">SIGACT</span> symposium on <span class="org-haskell-constructor">Principles</span> <span class="org-haskell-keyword">of</span> programming languages
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">fetchAllRows</span> stmt 
<span class="org-haskell-constructor">[]</span>
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [[<span class="org-haskell-type">SqlValue</span>]]
<span class="org-haskell-operator">&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">================  fetchAllRowsAL  ======================= ---</span>

<span class="org-haskell-operator">&gt;</span> stmt <span class="org-haskell-operator">&lt;-</span> prepare conn query 
<span class="org-function-name">stmt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Statement</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">execute</span> stmt <span class="org-haskell-constructor">[]</span>
0
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Integer</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> rows <span class="org-haskell-operator">&lt;-</span> fetchAllRowsAL stmt
<span class="org-function-name">rows</span> <span class="org-haskell-operator">::</span> [[(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">SqlValue</span>)]]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">mapM_</span> print rows
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"url"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"http://www.eliza.ch/doc/wadler92essence_of_FP.pdf"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"place"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"Albuquerque, NM, USA"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"publisher"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"ACM"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"pages"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1-14"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"date"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1992-00-00 1992"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"DOI"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"10.1145/143165.143169"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"accessDate"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"2016-04-04 20:05:57"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"language"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"en"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"title"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"The essence of functional programming"</span>)]
[(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"proceedingsTitle"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"POPL '92 Proceedings of the 19th ACM SIGPLAN-SIGACT symposium on Principles of programming languages"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">=============== fetchAllRowsMap ================== --</span>

<span class="org-haskell-operator">&gt;</span> stmt <span class="org-haskell-operator">&lt;-</span> prepare conn query 
<span class="org-function-name">stmt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Statement</span>

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">execute</span> stmt <span class="org-haskell-constructor">[]</span>
0

<span class="org-haskell-operator">&gt;</span> rows <span class="org-haskell-operator">&lt;-</span> fetchAllRowsMap stmt
<span class="org-function-name">rows</span> <span class="org-haskell-operator">::</span> [containers<span class="org-haskell-operator">-</span>0.5<span class="org-haskell-operator">.</span>7.1<span class="org-haskell-type">:Data.Map.Base.Map</span> <span class="org-haskell-type">String</span> <span class="org-haskell-type">SqlValue</span>]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">mapM_</span> print rows
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"url"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"http://www.eliza.ch/doc/wadler92essence_of_FP.pdf"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"place"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"Albuquerque, NM, USA"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"publisher"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"ACM"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"pages"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1-14"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"date"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1992-00-00 1992"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"DOI"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"10.1145/143165.143169"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"accessDate"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"2016-04-04 20:05:57"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"language"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"en"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"title"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"The essence of functional programming"</span>)]
<span class="org-haskell-definition">fromList</span> [(<span class="org-string">"fieldName"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"proceedingsTitle"</span>),(<span class="org-string">"value"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"POPL '92 Proceedings of the 19th ACM SIGPLAN-SIGACT symposium on Principles of programming languages"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>


<p>
Query Item by ID 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-constructor">:</span>{
<span class="org-function-name">queryItemByID</span> <span class="org-haskell-operator">::</span>  <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> [[<span class="org-haskell-type">SqlValue</span>]]
<span class="org-haskell-definition">queryItemByID</span> itemID conn <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  stmt <span class="org-haskell-operator">&lt;-</span> prepare conn query
  execute stmt [toSql itemID]
  rows <span class="org-haskell-operator">&lt;-</span> fetchAllRows stmt 
  return rows 
  <span class="org-haskell-keyword">where</span>
    query <span class="org-haskell-operator">=</span> unlines <span class="org-haskell-operator">$</span> [ <span class="org-string">"SELECT fieldName, value FROM itemDataValues, itemData, fields WHERE"</span>, 
                        <span class="org-string">"itemDataValues.valueID = itemData.valueID"</span>, 
                        <span class="org-string">"and itemData.itemID = ?"</span>,
                        <span class="org-string">"and fields.fieldID = itemData.fieldID"</span>
                      ]
<span class="org-haskell-constructor">:</span>}

<span class="org-function-name">queryItemByID</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> [[<span class="org-haskell-type">SqlValue</span>]]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">queryItemByID</span> 5569 conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"title"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"From Stochastic Calculus to Mathematical Finance-Kabanov.pdf"</span>]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">queryItemByID</span> 5790 conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"url"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"http://twanvl.nl/blog/haskell/building-pipes-with-monad-transformers"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"accessDate"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"2016-04-04 16:45:25"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"title"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"Building pipes with monad transformers"</span>]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">queryItemByID</span> 5805 conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"url"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"http://www.eliza.ch/doc/wadler92essence_of_FP.pdf"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"place"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"Albuquerque, NM, USA"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"publisher"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"ACM"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"pages"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1-14"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"date"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"1992-00-00 1992"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"DOI"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"10.1145/143165.143169"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"accessDate"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"2016-04-04 20:05:57"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"language"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"en"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"title"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"The essence of functional programming"</span>]
[<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"proceedingsTitle"</span>,<span class="org-haskell-constructor">SqlByteString</span> <span class="org-string">"POPL '92 Proceedings of the 19th ACM SIGPLAN-SIGACT symposium on Principles of programming languages"</span>]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>


<p>
Disconnect 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t disconnect 
<span class="org-function-name">disconnect</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">disconnect</span> conn
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span>
</pre>
</div>
</div>
</div>





<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> Example - Datbase query with ReaderT monad transformer.</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
Note: The type of the monad is <code>ReaderT r m</code> without the parameter of
return value a.
</p>

<ul class="org-ul">
<li>Documentation: <a href="https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html">Control.Monad.Reader</a>
</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">Signature</th>
<th scope="col" class="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">ReaderT r m a</td>
<td class="left">&#xa0;</td>
<td class="left">Encapsulates a function or computation (a -&gt; m b) where m is a monad.</td>
</tr>

<tr>
<td class="left">ReaderT</td>
<td class="left">(r -&gt; m a) -&gt; ReaderT r m a</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">runReaderT</td>
<td class="left">ReaderT r m a -&gt; r -&gt; m a</td>
<td class="left">Run computation and get its value.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">return</td>
<td class="left">a -&gt; (ReaderT r m) a</td>
<td class="left">Monad return function.</td>
</tr>

<tr>
<td class="left">(&gt;&gt;=)</td>
<td class="left">a -&gt; (ReaderT r m) b -&gt; (ReaderT r m) b</td>
<td class="left">Monad bind function.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">fmap</td>
<td class="left">(a -&gt; b) -&gt; (ReaderT r m) a -&gt; (ReaderT r m) b</td>
<td class="left">Apply a function (a -&gt; b) to the result of computation Reader r a.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">ask</td>
<td class="left">m r</td>
<td class="left">Read environment or configuration.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">local</td>
<td class="left">(r -&gt; r) -&gt; m a -&gt; m a</td>
<td class="left">Modify environment by applying a function to it.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">liftIO</td>
<td class="left">MonadIO m =&gt; IO a -&gt; m a</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">liftIO</td>
<td class="left">IO a -&gt; (Reader r m) a</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Example: This example will need the database and the haskell packages
shown in  <a href="DatabaseHDBC.html">Databases - HDBC package</a>
</p>


<div class="org-src-container">

<pre class="src src-haskell"><span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad</span> (mapM_, forM_)
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Control.Monad.Reader</span> 

<span class="org-haskell-keyword">import</span> <span class="org-haskell-keyword">qualified</span> <span class="org-haskell-constructor">Database.HDBC</span> <span class="org-haskell-keyword">as</span> <span class="org-haskell-constructor">HDBC</span>
<span class="org-haskell-keyword">import</span> <span class="org-haskell-constructor">Database.HDBC.Sqlite3</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">In file add the lines</span>
<span class="org-haskell-pragma">{-# LANGUAGE OverloadedStrings #-}</span>
<span class="org-haskell-pragma">{-# LANGUAGE RankNTypes #-}</span>
<span class="org-haskell-pragma">{-# LANGUAGE FlexibleContexts #-}</span>

<span class="org-comment-delimiter">-- </span><span class="org-comment">In the REPL</span>
<span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">-</span><span class="org-haskell-constructor">XOverloadedStrings</span>
<span class="org-haskell-constructor">:</span>set <span class="org-haskell-operator">-</span><span class="org-haskell-constructor">XRankNTypes</span>

<span class="org-haskell-constructor">:</span>{
<span class="org-function-name">fromSqlToInt</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">HDBC.SqlValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">Int</span>
<span class="org-haskell-definition">fromSqlToInt</span>  sv <span class="org-haskell-operator">=</span> HDBC.fromSql sv  
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-constructor">:</span>{ 
<span class="org-function-name">fromSqlToString</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">HDBC.SqlValue</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-definition">fromSqlToString</span> sv <span class="org-haskell-operator">=</span> HDBC.fromSql sv 
<span class="org-haskell-constructor">:</span>}

<span class="org-haskell-constructor">:</span>{
<span class="org-doc">{- | Convert number to HDBC value -}</span>
<span class="org-function-name">fromIntToHDBC</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">HDBC.SqlValue</span>
<span class="org-haskell-definition">fromIntToHDBC</span> n <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">HDBC.SqlInt64</span> <span class="org-haskell-operator">$</span> fromIntegral n                 
<span class="org-haskell-constructor">:</span>}

 <span class="org-doc">{- | Convert string to HDBC string -}</span>                  
<span class="org-haskell-definition">fromStrToHDBC</span> s <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">HDBC.SqlString</span> s                 


conn <span class="org-haskell-operator">&lt;-</span> connectSqlite3 <span class="org-string">"zotero.sqlite"</span> 


<span class="org-haskell-constructor">:</span>{
<span class="org-function-name">queryItemByIDRaw</span> <span class="org-haskell-operator">::</span>  <span class="org-haskell-type">HDBC.IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">IO</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-definition">queryItemByIDRaw</span> itemID conn <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  stmt <span class="org-haskell-operator">&lt;-</span> HDBC.prepare conn query
  HDBC.execute stmt [HDBC.toSql itemID]
  rows <span class="org-haskell-operator">&lt;-</span> HDBC.fetchAllRows stmt 
  return <span class="org-haskell-operator">$</span> map projection rows 
  <span class="org-haskell-keyword">where</span>
    projection row <span class="org-haskell-operator">=</span> (fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 0, fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 1)

    query <span class="org-haskell-operator">=</span> unlines <span class="org-haskell-operator">$</span> [ <span class="org-string">"SELECT fieldName, value FROM itemDataValues, itemData, fields WHERE"</span>, 
                        <span class="org-string">"itemDataValues.valueID = itemData.valueID"</span>, 
                        <span class="org-string">"and itemData.itemID = ?"</span>,
                        <span class="org-string">"and fields.fieldID = itemData.fieldID"</span>
                      ]
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t queryItemByIDRaw 10 conn
<span class="org-haskell-definition">queryItemByIDRaw</span> 10 conn <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">queryItemByIDRaw</span> 10 conn
[(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>),(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>),(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">queryItemByIDRaw</span> 10 conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>)
(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>)
(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">queryItemByIDRaw</span> 16 conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
(<span class="org-string">"url"</span>,<span class="org-string">"http://www.digilife.be/quickreferences/QRC/LINUX%20Admin%20Quick%20Reference.pdf"</span>)
(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:06:48"</span>)
(<span class="org-string">"title"</span>,<span class="org-string">"linux_quickref.PDF - LINUX Admin Quick Reference.pdf"</span>)
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>


<span class="org-doc">{- | Transform this computation to ReaderT monad with database connection as the </span>
<span class="org-doc">     implicit parameter or configuration. </span>
<span class="org-doc"> -}</span>
<span class="org-haskell-type">:</span>{
<span class="org-function-name">queryItemByID1</span> <span class="org-haskell-operator">::</span>  <span class="org-haskell-type">HDBC.IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">ReaderT</span> conn <span class="org-haskell-type">IO</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-definition">queryItemByID1</span> itemID <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">ReaderT</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">do</span>                      
  stmt <span class="org-haskell-operator">&lt;-</span> liftIO <span class="org-haskell-operator">$</span> HDBC.prepare conn query
  liftIO <span class="org-haskell-operator">$</span> HDBC.execute stmt [HDBC.toSql itemID]
  rows <span class="org-haskell-operator">&lt;-</span> liftIO <span class="org-haskell-operator">$</span> HDBC.fetchAllRows stmt 
  return <span class="org-haskell-operator">$</span> map projection rows 
  <span class="org-haskell-keyword">where</span>
    projection row <span class="org-haskell-operator">=</span> (fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 0, fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 1)

    query <span class="org-haskell-operator">=</span> unlines <span class="org-haskell-operator">$</span> [ <span class="org-string">"SELECT fieldName, value FROM itemDataValues, itemData, fields WHERE"</span>, 
                        <span class="org-string">"itemDataValues.valueID = itemData.valueID"</span>, 
                        <span class="org-string">"and itemData.itemID = ?"</span>,
                        <span class="org-string">"and fields.fieldID = itemData.fieldID"</span>
                      ]
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t runReaderT
<span class="org-function-name">runReaderT</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">ReaderT</span> r m a <span class="org-haskell-operator">-&gt;</span> r <span class="org-haskell-operator">-&gt;</span> m a

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-type">:</span>t queryItemByID1 10
<span class="org-haskell-definition">queryItemByID1</span> 10
  <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">ReaderT</span> conn <span class="org-haskell-type">IO</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-type">:</span>t runReaderT (queryItemByID1 10) conn 
<span class="org-haskell-definition">runReaderT</span> (queryItemByID1 10) conn <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IO</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (queryItemByID1 10) conn
[(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>),(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>),(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (queryItemByID1 10) conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>)
(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>)
(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> 

<span class="org-comment-delimiter">-- </span><span class="org-comment">=======================================================================      </span>
<span class="org-doc">{- |  Variation 2 - Simplify - ReaderT conn IO [(String, String)]  -}</span>

<span class="org-doc">{- | Database Connection -&gt; DbConn a = ReaderT conn IO a = conn -&gt; IO a -}</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">DBConn</span> a <span class="org-haskell-operator">=</span> forall conn<span class="org-haskell-operator">.</span> (<span class="org-haskell-type">HDBC.IConnection</span> conn) <span class="org-haskell-operator">=&gt;</span>  <span class="org-haskell-type">ReaderT</span> conn <span class="org-haskell-type">IO</span> a


<span class="org-haskell-type">:</span>{
<span class="org-function-name">queryItemByID2</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">DBConn</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-definition">queryItemByID2</span> itemID <span class="org-haskell-operator">=</span> <span class="org-haskell-constructor">ReaderT</span> <span class="org-haskell-operator">$</span> <span class="org-haskell-operator">\</span> conn <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-keyword">do</span>                      
  stmt <span class="org-haskell-operator">&lt;-</span> liftIO <span class="org-haskell-operator">$</span> HDBC.prepare conn query
  liftIO <span class="org-haskell-operator">$</span> HDBC.execute stmt [HDBC.toSql itemID]
  rows <span class="org-haskell-operator">&lt;-</span> liftIO <span class="org-haskell-operator">$</span> HDBC.fetchAllRows stmt 
  return <span class="org-haskell-operator">$</span> map projection rows 
  <span class="org-haskell-keyword">where</span>
    projection row <span class="org-haskell-operator">=</span> (fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 0, fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 1)                    
    query <span class="org-haskell-operator">=</span> unlines <span class="org-haskell-operator">$</span> [ <span class="org-string">"SELECT fieldName, value FROM itemDataValues, itemData, fields WHERE"</span>, 
                        <span class="org-string">"itemDataValues.valueID = itemData.valueID"</span>, 
                        <span class="org-string">"and itemData.itemID = ?"</span>,
                        <span class="org-string">"and fields.fieldID = itemData.fieldID"</span>
                      ]
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-constructor">:</span>t queryItemByID2 10
<span class="org-haskell-definition">queryItemByID2</span> 10
  <span class="org-haskell-operator">::</span> <span class="org-haskell-type">IConnection</span> conn <span class="org-haskell-operator">=&gt;</span> <span class="org-haskell-type">ReaderT</span> conn <span class="org-haskell-type">IO</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (queryItemByID2 10) conn
[(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>),(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>),(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (queryItemByID2 10) conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>)
(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>)
(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 


<span class="org-comment-delimiter">-- </span><span class="org-comment">=======================================================================      </span>
<span class="org-doc">{- |  Variation 3 - It can be simplified and generalized even further. -}</span>

<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">SQL</span> <span class="org-haskell-operator">=</span> <span class="org-haskell-type">String</span>
<span class="org-haskell-keyword">type</span> <span class="org-haskell-type">DBConn</span> a <span class="org-haskell-operator">=</span> forall conn<span class="org-haskell-operator">.</span> (<span class="org-haskell-type">HDBC.IConnection</span> conn) <span class="org-haskell-operator">=&gt;</span>  <span class="org-haskell-type">ReaderT</span> conn <span class="org-haskell-type">IO</span> a

<span class="org-haskell-type">:</span>{    
<span class="org-function-name">sqlQueryAll</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">SQL</span> <span class="org-haskell-operator">-&gt;</span> [<span class="org-haskell-type">HDBC.SqlValue</span>] <span class="org-haskell-operator">-&gt;</span> ([<span class="org-haskell-type">HDBC.SqlValue</span>] <span class="org-haskell-operator">-&gt;</span> b) <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">DBConn</span> [b]     
<span class="org-haskell-definition">sqlQueryAll</span> sql sqlvals projection <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  con     <span class="org-haskell-operator">&lt;-</span> ask 
  stmt    <span class="org-haskell-operator">&lt;-</span> liftIO <span class="org-haskell-operator">$</span> HDBC.prepare con sql
  liftIO  <span class="org-haskell-operator">$</span>  HDBC.execute stmt sqlvals  
  rows    <span class="org-haskell-operator">&lt;-</span> liftIO <span class="org-haskell-operator">$</span> HDBC.fetchAllRows stmt
  return (fmap projection rows)
<span class="org-haskell-constructor">:</span>}



<span class="org-haskell-constructor">:</span>{
<span class="org-function-name">queryItemByID3</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">DBConn</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-definition">queryItemByID3</span> itemID <span class="org-haskell-operator">=</span> sqlQueryAll query [fromIntToHDBC itemID] projection
  <span class="org-haskell-keyword">where</span>
    projection row <span class="org-haskell-operator">=</span> (fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 0, fromSqlToString <span class="org-haskell-operator">$</span> row <span class="org-haskell-operator">!!</span> 1)                    
    query <span class="org-haskell-operator">=</span> unlines <span class="org-haskell-operator">$</span> [ <span class="org-string">"SELECT fieldName, value FROM itemDataValues, itemData, fields WHERE"</span>, 
                        <span class="org-string">"itemDataValues.valueID = itemData.valueID"</span>, 
                        <span class="org-string">"and itemData.itemID = ?"</span>,
                        <span class="org-string">"and fields.fieldID = itemData.fieldID"</span>
                      ]
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (queryItemByID3 10) conn
[(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>),(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>),(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [(<span class="org-haskell-type">String</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (queryItemByID3 10) conn <span class="org-haskell-operator">&gt;&gt;=</span> mapM_ print
(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>)
(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>)
(<span class="org-string">"title"</span>,<span class="org-string">"FSharpSpec-4.0-latest.pdf"</span>)
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span>

<span class="org-doc">-- | Get all tags associated with a given item</span>
<span class="org-haskell-type">:</span>{
<span class="org-function-name">getItemTags</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">DBConn</span> [(<span class="org-haskell-type">Int</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-definition">getItemTags</span> itemID <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>  
  sqlQueryAll sql [fromIntToHDBC itemID] projection
  <span class="org-haskell-keyword">where</span>
    sql <span class="org-haskell-operator">=</span> unlines [<span class="org-string">"SELECT  tags.tagID, tags.name"</span>,
                   <span class="org-string">"FROM    itemTags, tags"</span>, 
                   <span class="org-string">"WHERE   itemTags.tagID = tags.tagID"</span>, 
                   <span class="org-string">"AND     itemID = ?"</span>
                   ]

    projection xs <span class="org-haskell-operator">=</span> (fromSqlToInt (xs <span class="org-haskell-operator">!!</span> 0), fromSqlToString (xs <span class="org-haskell-operator">!!</span> 1))
<span class="org-haskell-constructor">:</span>}


<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (getItemTags 12) conn
[(2,<span class="org-string">"fp"</span>),(3,<span class="org-string">"fsharp"</span>),(4,<span class="org-string">"doc"</span>),(5,<span class="org-string">"overview"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [(<span class="org-haskell-type">Int</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (getItemTags 13) conn
[(2,<span class="org-string">"fp"</span>),(3,<span class="org-string">"fsharp"</span>),(4,<span class="org-string">"doc"</span>)]
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> [(<span class="org-haskell-type">Int</span>, <span class="org-haskell-type">String</span>)]
<span class="org-haskell-operator">&gt;</span> 


<span class="org-haskell-type">:</span>{
<span class="org-function-name">showItem</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-type">Int</span> <span class="org-haskell-operator">-&gt;</span> <span class="org-haskell-type">DBConn</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-definition">showItem</span> itemID <span class="org-haskell-operator">=</span> <span class="org-haskell-keyword">do</span>
  itemData <span class="org-haskell-operator">&lt;-</span> queryItemByID3 itemID  
  tags   <span class="org-haskell-operator">&lt;-</span> getItemTags itemID

  <span class="org-comment-delimiter">-- </span><span class="org-comment">liftIO :: IO () =&gt; DBConn ()          </span>
  liftIO <span class="org-haskell-operator">$</span> <span class="org-haskell-keyword">do</span>
    putStrLn <span class="org-string">"Item Data"</span>
    putStrLn <span class="org-string">"---------------------------"</span>             
    forM_ itemData print
    putStrLn <span class="org-string">"Item Tags"</span>
    putStrLn <span class="org-string">"---------------------------"</span>
    forM_ tags print     
<span class="org-haskell-constructor">:</span>}   

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (showItem 12) conn
<span class="org-haskell-constructor">Item</span> <span class="org-haskell-constructor">Data</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-------------------------</span>
(<span class="org-string">"url"</span>,<span class="org-string">"http://tomasp.net/articles/fsharp-i-introduction/article.pdf"</span>)
(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:01:04"</span>)
(<span class="org-string">"title"</span>,<span class="org-string">"F# Language Overview"</span>)
<span class="org-haskell-constructor">Item</span> <span class="org-haskell-constructor">Tags</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-------------------------</span>
(2,<span class="org-string">"fp"</span>)
(3,<span class="org-string">"fsharp"</span>)
(4,<span class="org-string">"doc"</span>)
(5,<span class="org-string">"overview"</span>)
<span class="org-function-name">it</span> <span class="org-haskell-operator">::</span> <span class="org-haskell-constructor">()</span>
<span class="org-haskell-operator">&gt;</span> 
<span class="org-haskell-operator">&gt;</span> 

<span class="org-haskell-operator">&gt;</span> <span class="org-haskell-definition">runReaderT</span> (showItem 13) conn
<span class="org-haskell-constructor">Item</span> <span class="org-haskell-constructor">Data</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-------------------------</span>
(<span class="org-string">"url"</span>,<span class="org-string">"http://fsharp.org/specs/language-spec/4.0/FSharpSpec-4.0-latest.pdf"</span>)
(<span class="org-string">"accessDate"</span>,<span class="org-string">"2016-11-07 22:00:06"</span>)
(<span class="org-string">"title"</span>,<span class="org-string">"The F# 4.0 Language Specification"</span>)
<span class="org-haskell-constructor">Item</span> <span class="org-haskell-constructor">Tags</span>
<span class="org-comment-delimiter">--</span><span class="org-comment">-------------------------</span>
(2,<span class="org-string">"fp"</span>)
(3,<span class="org-string">"fsharp"</span>)
(4,<span class="org-string">"doc"</span>)
<span class="org-function-name">it</span> <span class="org-haskell-definition">:</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: nobody</p>
<p class="date">Created: 2018-05-07 Mon 10:11</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
